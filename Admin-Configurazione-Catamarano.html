<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Configurazione Catamarano</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#0a5c8f',secondary:'#f8b400'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script src="catamaran-config.js"></script>
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Raleway', sans-serif;
background-color: #f9fafb;
}
h1, h2, h3, h4, h5, h6 {
font-family: 'Playfair Display', serif;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
</style>
</head>
<body class="bg-gray-50">

<!-- Header -->
<header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
<div class="flex items-center space-x-4">
<div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
<i class="ri-ship-line text-white"></i>
</div>
<h1 class="text-xl font-semibold text-gray-900">Admin Panel</h1>
</div>
<div class="flex items-center space-x-2">
<button id="save-button" class="bg-primary text-white px-4 py-2 rounded-lg flex items-center whitespace-nowrap">
<i class="ri-save-line mr-2"></i>
<span class="hidden md:inline">Salva Modifiche</span>
<span class="md:hidden">Salva</span>
</button>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

<!-- Informazioni Base -->
<div class="lg:col-span-2">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<h2 class="text-lg font-semibold text-gray-900">Informazioni Base</h2>
</div>
<div class="p-6 space-y-6">

<!-- Nome Catamarano -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Nome Catamarano</label>
<input type="text" id="admin-catamaran-name" value="Bali Catsmart - Violante" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<!-- Configurazione Badge Prezzo di Partenza -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Badge Prezzo di Partenza</h4>

<!-- Prezzo di Partenza -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Prezzo di Partenza</label>
<div class="flex items-center">
<span class="bg-gray-100 px-4 py-2 border border-r-0 border-gray-300 rounded-l text-gray-600">‚Ç¨</span>
<input type="number" id="admin-starting-price" value="2999" 
class="w-40 px-4 py-2 border border-gray-300 rounded-r focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<p class="mt-1 text-xs text-gray-500">Prezzo mostrato nel badge (solo marketing)</p>
</div>

<!-- Testo del Badge -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Testo del Badge</label>
<input type="text" id="admin-badge-text" value="A partire da" 
placeholder="es. A partire da, Da solo, Offerta da..."
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Testo che appare sopra il prezzo nel badge</p>
</div>

<!-- Colore del Badge -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Colore del Badge</label>
<div class="flex items-center space-x-3">
<input type="color" id="admin-badge-color" value="#f8b400" 
class="w-12 h-10 border border-gray-300 rounded cursor-pointer">
<input type="text" id="admin-badge-color-text" value="#f8b400" 
placeholder="#f8b400"
class="flex-1 px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<p class="mt-1 text-xs text-gray-500">Colore di sfondo del badge (in formato esadecimale)</p>
</div>

<!-- Anteprima Badge -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Anteprima</label>
<div class="flex justify-center p-4 bg-gray-200 rounded-lg">
<div id="badge-preview" class="px-4 py-2 rounded-full text-sm font-semibold shadow-lg flex flex-col items-center min-w-[120px]" style="background-color: #f8b400; color: #ffffff;">
<span class="text-xs mb-1">A partire da</span>
<span class="text-lg font-bold">‚Ç¨2.999</span>
</div>
</div>
</div>

</div>

<!-- Prezzo Base -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Prezzo Base per Questa Settimana</label>
<div class="flex items-center">
<span class="bg-gray-100 px-4 py-2 border border-r-0 border-gray-300 rounded-l text-gray-600">‚Ç¨</span>
<input type="number" id="admin-base-price" value="3499" 
class="w-40 px-4 py-2 border border-gray-300 rounded-r focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<p class="mt-1 text-xs text-gray-500">Prezzo utilizzato per i calcoli in base alle date selezionate</p>
</div>

<!-- Anno -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Anno</label>
<input type="number" id="admin-year" value="2025" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<!-- Titolo Principale -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Titolo Principale Pagina</label>
<input type="text" id="admin-main-heading" value="Prenota il tuo Catamarano" 
placeholder="Titolo che appare in cima alla pagina di prenotazione"
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Questo testo apparir√† come titolo principale della pagina di prenotazione</p>
</div>

</div>
</div>
</div>

<!-- Logo Configuration -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Logo Aziendale</h2>
    </div>
    <div class="p-6 space-y-6">
        
        <!-- Logo Upload -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Logo</label>
            <div class="flex items-center space-x-4">
                <div class="flex-1">
                    <input type="file" id="admin-logo-upload" accept="image/*" 
                           class="hidden">
                    <label for="admin-logo-upload" 
                           class="cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        <i class="ri-image-line mr-2"></i>
                        Carica Logo
                    </label>
                    <p class="mt-1 text-xs text-gray-500">PNG, JPG fino a 2MB. Dimensioni consigliate: 200x60px</p>
                </div>
                <div class="flex-shrink-0">
                    <div id="logo-preview" class="w-32 h-16 border-2 border-dashed border-gray-300 rounded flex items-center justify-center bg-gray-50">
                        <span class="text-sm text-gray-500">Anteprima</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logo Alternative Text -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Testo Alternativo</label>
            <input type="text" id="admin-logo-text" value="logo" 
                   placeholder="Testo da mostrare se il logo non √® disponibile"
                   class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
            <p class="mt-1 text-xs text-gray-500">Questo testo apparir√† se non viene caricato alcun logo</p>
        </div>

        <!-- Reset Logo -->
        <div>
            <button id="reset-logo-button" 
                    class="inline-flex items-center px-4 py-2 border border-red-300 rounded text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                <i class="ri-delete-bin-line mr-2"></i>
                Rimuovi Logo
            </button>
        </div>

    </div>
</div>

<!-- Prezzi Pacchetti -->
<div>
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<h2 class="text-lg font-semibold text-gray-900">Prezzi Pacchetti</h2>
</div>
<div class="p-6 space-y-6">

<!-- Charter -->
<div>
<h4 class="font-medium text-gray-900">Pacchetto Charter</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">‚Ç¨</span>
<input type="number" id="admin-charter-price" value="400" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

<!-- Carburante -->
<div>
<h4 class="font-medium text-gray-900">Carburante No Stress</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">‚Ç¨</span>
<input type="number" id="admin-fuel-price" value="350" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

<!-- Lenzuola -->
<div>
<h4 class="font-medium text-gray-900">Lenzuola e salviette</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo per ospite:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">‚Ç¨</span>
<input type="number" id="admin-linens-price" value="20" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

<!-- Skipper -->
<div>
<h4 class="font-medium text-gray-900">Skipper Professionale</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo al giorno:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">‚Ç¨</span>
<input type="number" id="admin-skipper-price" value="200" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

</div>
</div>
</div>

</div>

<!-- Bottom Save Button -->
<div class="mt-8 flex justify-center">
<button id="save-button-bottom" class="bg-primary text-white px-6 py-3 rounded-lg flex items-center">
<i class="ri-save-line mr-2"></i>
Salva Modifiche
</button>
</div>

</main>

<script>
// Funzioni globali per gestire la configurazione
window.saveConfiguration = function() {
    try {
        console.log('=== INIZIO SALVATAGGIO ===');
        const config = CatamaranStorage.load();
        
        // Aggiorna informazioni base
        const nameInput = document.getElementById('admin-catamaran-name');
        const startingPriceInput = document.getElementById('admin-starting-price');
        const priceInput = document.getElementById('admin-base-price');
        const yearInput = document.getElementById('admin-year');
        const mainHeadingInput = document.getElementById('admin-main-heading');
        
        console.log('Campi trovati:');
        console.log('- Nome:', nameInput ? nameInput.value : 'NON TROVATO');
        console.log('- Prezzo Partenza:', startingPriceInput ? startingPriceInput.value : 'NON TROVATO');
        console.log('- Prezzo Base:', priceInput ? priceInput.value : 'NON TROVATO');
        console.log('- Anno:', yearInput ? yearInput.value : 'NON TROVATO');
        console.log('- Titolo:', mainHeadingInput ? mainHeadingInput.value : 'NON TROVATO');
        
        if (nameInput && nameInput.value) {
            console.log('Aggiornando nome da:', config.basic.name, 'a:', nameInput.value);
            config.basic.name = nameInput.value;
        }
        if (startingPriceInput && startingPriceInput.value) {
            console.log('Aggiornando prezzo partenza da:', config.basic.startingPrice, 'a:', startingPriceInput.value);
            config.basic.startingPrice = parseInt(startingPriceInput.value);
        }
        
        // Assicurati che la struttura badge esista prima del salvataggio
        if (!config.priceBadge) {
            config.priceBadge = {
                enabled: true,
                text: "A partire da",
                color: "#f8b400",
                textColor: "#ffffff"
            };
        }
        
        // Aggiorna badge configuration
        const badgeTextInput = document.getElementById('admin-badge-text');
        const badgeColorInput = document.getElementById('admin-badge-color-text');
        
        if (badgeTextInput && badgeTextInput.value) {
            console.log('Aggiornando testo badge da:', config.priceBadge.text, 'a:', badgeTextInput.value);
            config.priceBadge.text = badgeTextInput.value;
        }
        if (badgeColorInput && badgeColorInput.value) {
            console.log('Aggiornando colore badge da:', config.priceBadge.color, 'a:', badgeColorInput.value);
            config.priceBadge.color = badgeColorInput.value;
        }
        if (priceInput && priceInput.value) {
            console.log('Aggiornando prezzo base da:', config.basic.basePrice, 'a:', priceInput.value);
            config.basic.basePrice = parseInt(priceInput.value);
        }
        if (yearInput && yearInput.value) {
            console.log('Aggiornando anno da:', config.basic.year, 'a:', yearInput.value);
            config.basic.year = parseInt(yearInput.value);
        }
        if (mainHeadingInput && mainHeadingInput.value) {
            console.log('Aggiornando titolo da:', config.ui.mainHeading, 'a:', mainHeadingInput.value);
            config.ui.mainHeading = mainHeadingInput.value;
        }
        
        // Aggiorna prezzi pacchetti
        const charterPriceInput = document.getElementById('admin-charter-price');
        const fuelPriceInput = document.getElementById('admin-fuel-price');
        const linensPriceInput = document.getElementById('admin-linens-price');
        const skipperPriceInput = document.getElementById('admin-skipper-price');
        
        if (charterPriceInput && charterPriceInput.value) {
            config.mandatoryPackages.charter.price = parseInt(charterPriceInput.value);
            console.log('Charter aggiornato:', charterPriceInput.value);
        }
        if (fuelPriceInput && fuelPriceInput.value) {
            config.mandatoryPackages.fuel.price = parseInt(fuelPriceInput.value);
            console.log('Fuel aggiornato:', fuelPriceInput.value);
        }
        if (linensPriceInput && linensPriceInput.value) {
            config.mandatoryPackages.linens.pricePerGuest = parseInt(linensPriceInput.value);
            console.log('Lenzuola aggiornate:', linensPriceInput.value);
        }
        if (skipperPriceInput && skipperPriceInput.value) {
            config.additionalServices.skipper.price = parseInt(skipperPriceInput.value);
            console.log('Skipper aggiornato:', skipperPriceInput.value);
        }
        
        // Aggiorna logo
        const logoTextInput = document.getElementById('admin-logo-text');
        if (logoTextInput && logoTextInput.value) {
            config.theme.logo.text = logoTextInput.value;
            console.log('Logo text aggiornato:', logoTextInput.value);
        }
        
        // Salva la configurazione
        const saved = CatamaranStorage.save(config);
        
        if (saved) {
            console.log('‚úì Configurazione salvata con successo!');
            showNotification('‚úì Configurazione salvata con successo!', 'success');
        } else {
            console.log('‚úó Errore nel salvataggio');
            showNotification('‚úó Errore nel salvataggio della configurazione', 'error');
        }
        
    } catch (error) {
        console.error('Errore saveConfiguration:', error);
        showNotification('‚úó Errore: ' + error.message, 'error');
    }
};

window.loadConfiguration = function() {
    try {
        const config = CatamaranStorage.load();
        
        // Migrazione della configurazione logo (da stringa a oggetto)
        if (typeof config.theme.logo === 'string') {
            console.log('üîÑ Migrazione configurazione logo da stringa a oggetto');
            const oldLogoText = config.theme.logo;
            config.theme.logo = {
                type: 'text',
                imageUrl: '',
                text: oldLogoText
            };
            // Salva la configurazione migrata
            CatamaranStorage.save(config);
        }
        
        // Assicurati che la struttura logo esista
        if (!config.theme.logo) {
            config.theme.logo = { type: 'text', imageUrl: '', text: 'logo' };
        }
        
        // Carica informazioni base
        const nameInput = document.getElementById('admin-catamaran-name');
        const startingPriceInput = document.getElementById('admin-starting-price');
        const priceInput = document.getElementById('admin-base-price');
        const yearInput = document.getElementById('admin-year');
        const mainHeadingInput = document.getElementById('admin-main-heading');
        
        if (nameInput) nameInput.value = config.basic.name;
        if (startingPriceInput) startingPriceInput.value = config.basic.startingPrice || 2999;
        if (priceInput) priceInput.value = config.basic.basePrice;
        if (yearInput) yearInput.value = config.basic.year;
        if (mainHeadingInput) mainHeadingInput.value = config.ui.mainHeading;
        
        // Carica configurazione badge
        const badgeTextInput = document.getElementById('admin-badge-text');
        const badgeColorInput = document.getElementById('admin-badge-color');
        const badgeColorTextInput = document.getElementById('admin-badge-color-text');
        
        // Assicurati che la struttura badge esista
        if (!config.priceBadge) {
            config.priceBadge = {
                enabled: true,
                text: "A partire da",
                color: "#f8b400",
                textColor: "#ffffff"
            };
        }
        
        if (badgeTextInput) badgeTextInput.value = config.priceBadge.text;
        if (badgeColorInput) badgeColorInput.value = config.priceBadge.color;
        if (badgeColorTextInput) badgeColorTextInput.value = config.priceBadge.color;
        
        // Carica prezzi pacchetti
        const charterPriceInput = document.getElementById('admin-charter-price');
        const fuelPriceInput = document.getElementById('admin-fuel-price');
        const linensPriceInput = document.getElementById('admin-linens-price');
        const skipperPriceInput = document.getElementById('admin-skipper-price');
        
        if (charterPriceInput) charterPriceInput.value = config.mandatoryPackages.charter.price;
        if (fuelPriceInput) fuelPriceInput.value = config.mandatoryPackages.fuel.price;
        if (linensPriceInput) linensPriceInput.value = config.mandatoryPackages.linens.pricePerGuest;
        if (skipperPriceInput) skipperPriceInput.value = config.additionalServices.skipper.price;
        
        // Carica logo
        const logoTextInput = document.getElementById('admin-logo-text');
        if (logoTextInput) logoTextInput.value = config.theme.logo.text;
        
        console.log('üìÇ Configurazione logo caricata:', config.theme.logo);
        
        // Aggiorna anteprima logo
        updateLogoPreview(config.theme.logo);
        
        console.log('‚úì Configurazione caricata');
        
    } catch (error) {
        console.error('Errore loadConfiguration:', error);
        showNotification('‚úó Errore nel caricamento: ' + error.message, 'error');
    }
};

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-50 ${
        type === 'error' ? 'bg-red-500' : 'bg-green-500'
    }`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Funzioni per gestire il badge
function updateBadgePreview() {
    const badgePreview = document.getElementById('badge-preview');
    const badgeTextInput = document.getElementById('admin-badge-text');
    const startingPriceInput = document.getElementById('admin-starting-price');
    const badgeColorTextInput = document.getElementById('admin-badge-color-text');
    
    if (badgePreview && badgeTextInput && startingPriceInput && badgeColorTextInput) {
        const text = badgeTextInput.value || 'A partire da';
        const price = startingPriceInput.value || '2999';
        const color = badgeColorTextInput.value || '#f8b400';
        
        badgePreview.style.backgroundColor = color;
        badgePreview.innerHTML = `
            <span class="text-xs mb-1">${text}</span>
            <span class="text-lg font-bold">‚Ç¨${parseInt(price).toLocaleString()}</span>
        `;
    }
}

function syncColorInputs() {
    const colorPicker = document.getElementById('admin-badge-color');
    const colorText = document.getElementById('admin-badge-color-text');
    
    if (colorPicker && colorText) {
        colorPicker.addEventListener('input', function() {
            colorText.value = this.value;
            updateBadgePreview();
        });
        
        colorText.addEventListener('input', function() {
            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                colorPicker.value = this.value;
                updateBadgePreview();
            }
        });
    }
}

// Funzioni per gestire il logo
function updateLogoPreview(logoConfig) {
    const preview = document.getElementById('logo-preview');
    console.log('üñºÔ∏è Aggiornamento anteprima logo:', logoConfig);
    
    if (!preview) {
        console.error('‚ùå Elemento logo-preview non trovato');
        return;
    }
    
    if (logoConfig && logoConfig.type === 'image' && logoConfig.imageUrl) {
        console.log('‚úÖ Mostrando immagine logo');
        preview.innerHTML = `<img src="${logoConfig.imageUrl}" alt="Logo Preview" class="w-full h-full object-contain">`;
    } else {
        console.log('üìù Mostrando testo logo:', logoConfig?.text || 'Anteprima');
        preview.innerHTML = `<span class="text-sm text-gray-500">${logoConfig?.text || 'Anteprima'}</span>`;
    }
}

function handleLogoUpload(file) {
    if (!file) return;
    
    console.log('üîÑ Caricamento logo:', file.name, file.size, file.type);
    
    // Verifica dimensione file (max 2MB)
    if (file.size > 2 * 1024 * 1024) {
        showNotification('‚úó Il file √® troppo grande. Massimo 2MB.', 'error');
        return;
    }
    
    // Verifica tipo file
    if (!file.type.match(/^image\/(png|jpg|jpeg)$/)) {
        showNotification('‚úó Formato non supportato. Usa PNG o JPG.', 'error');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        console.log('üìÇ File letto, caricamento configurazione...');
        const config = CatamaranStorage.load();
        
        // Assicurati che la struttura logo esista
        if (!config.theme.logo) {
            config.theme.logo = { type: 'text', imageUrl: '', text: 'logo' };
        }
        
        config.theme.logo.type = 'image';
        config.theme.logo.imageUrl = e.target.result;
        
        console.log('üíæ Configurazione logo aggiornata:', config.theme.logo.type);
        
        // Aggiorna anteprima
        updateLogoPreview(config.theme.logo);
        
        // Salva automaticamente
        const saved = CatamaranStorage.save(config);
        console.log('üíæ Salvataggio:', saved ? 'Successo' : 'Fallito');
        
        showNotification('‚úì Logo caricato con successo!', 'success');
    };
    reader.readAsDataURL(file);
}

function resetLogo() {
    const config = CatamaranStorage.load();
    config.theme.logo.type = 'text';
    config.theme.logo.imageUrl = '';
    
    // Aggiorna anteprima
    updateLogoPreview(config.theme.logo);
    
    // Salva
    CatamaranStorage.save(config);
    showNotification('‚úì Logo rimosso', 'success');
}

// Inizializzazione
window.addEventListener('load', function() {
    console.log('üöÄ Admin panel caricato');
    
    try {
        // Carica configurazione
        loadConfiguration();
        
        // Collega pulsanti
        const saveButton = document.getElementById('save-button');
        const saveButtonBottom = document.getElementById('save-button-bottom');
        
        if (saveButton) {
            saveButton.addEventListener('click', saveConfiguration);
            console.log('‚úì Pulsante save-button collegato');
        }
        
        if (saveButtonBottom) {
            saveButtonBottom.addEventListener('click', saveConfiguration);
            console.log('‚úì Pulsante save-button-bottom collegato');
        }
        
        // Collega controlli logo
        const logoUploadInput = document.getElementById('admin-logo-upload');
        const resetLogoButton = document.getElementById('reset-logo-button');
        
        if (logoUploadInput) {
            logoUploadInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleLogoUpload(file);
                }
            });
            console.log('‚úì Input logo upload collegato');
        }
        
        if (resetLogoButton) {
            resetLogoButton.addEventListener('click', resetLogo);
            console.log('‚úì Pulsante reset logo collegato');
        }
        
        // Collega controlli badge
        syncColorInputs();
        
        const badgeTextInput = document.getElementById('admin-badge-text');
        const startingPriceInput = document.getElementById('admin-starting-price');
        
        if (badgeTextInput) {
            badgeTextInput.addEventListener('input', updateBadgePreview);
        }
        if (startingPriceInput) {
            startingPriceInput.addEventListener('input', updateBadgePreview);
        }
        
        // Aggiorna anteprima iniziale
        updateBadgePreview();
        
        console.log('‚úÖ Inizializzazione completata');
        
    } catch (error) {
        console.error('‚ùå Errore inizializzazione:', error);
    }
});
</script>

</body>
</html>