<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Configurazione Catamarano</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#0a5c8f',secondary:'#f8b400'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script src="catamaran-config.js"></script>
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Raleway', sans-serif;
background-color: #f9fafb;
}
h1, h2, h3, h4, h5, h6 {
font-family: 'Playfair Display', serif;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
</style>
</head>
<body class="bg-gray-50">

<!-- Header -->
<header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
<div class="flex items-center space-x-4">
<div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
<i class="ri-ship-line text-white"></i>
</div>
<h1 class="text-xl font-semibold text-gray-900">Admin Panel</h1>
</div>
<div class="flex items-center space-x-2">
<button id="save-button" class="bg-primary text-white px-4 py-2 rounded-lg flex items-center whitespace-nowrap">
<i class="ri-save-line mr-2"></i>
<span class="hidden md:inline">Salva Modifiche</span>
<span class="md:hidden">Salva</span>
</button>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
<div class="space-y-8">

<!-- Informazioni Base -->
<div>
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<h2 class="text-lg font-semibold text-gray-900">Informazioni Base</h2>
</div>
<div class="p-6 space-y-6">

<!-- Nome Catamarano -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Nome Catamarano</label>
<input type="text" id="admin-catamaran-name" value="Bali Catsmart - Violante" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<!-- Configurazione Badge Prezzo di Partenza -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Badge Prezzo di Partenza</h4>

<!-- Prezzo di Partenza -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Prezzo di Partenza</label>
<div class="flex items-center">
<span class="bg-gray-100 px-4 py-2 border border-r-0 border-gray-300 rounded-l text-gray-600">€</span>
<input type="number" id="admin-starting-price" value="2999" 
class="w-40 px-4 py-2 border border-gray-300 rounded-r focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<p class="mt-1 text-xs text-gray-500">Prezzo mostrato nel badge (solo marketing)</p>
</div>

<!-- Testo del Badge -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Testo del Badge</label>
<input type="text" id="admin-badge-text" value="A partire da" 
placeholder="es. A partire da, Da solo, Offerta da..."
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Testo che appare sopra il prezzo nel badge</p>
</div>

<!-- Colore del Badge -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Colore del Badge</label>
<div class="flex items-center space-x-3">
<input type="color" id="admin-badge-color" value="#f8b400" 
class="w-12 h-10 border border-gray-300 rounded cursor-pointer">
<input type="text" id="admin-badge-color-text" value="#f8b400" 
placeholder="#f8b400"
class="flex-1 px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<p class="mt-1 text-xs text-gray-500">Colore di sfondo del badge (in formato esadecimale)</p>
</div>

<!-- Anteprima Badge -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Anteprima</label>
<div class="flex justify-center p-4 bg-gray-200 rounded-lg">
<div id="badge-preview" class="px-4 py-2 rounded-full text-sm font-semibold shadow-lg flex flex-col items-center min-w-[120px]" style="background-color: #f8b400; color: #ffffff;">
<span class="text-xs mb-1">A partire da</span>
<span class="text-lg font-bold">€2.999</span>
</div>
</div>
</div>

</div>

<!-- Configurazione Sconto Instagram -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Sconto Instagram</h4>

<!-- Abilita/Disabilita Sconto -->
<div class="mb-4">
<label class="flex items-center">
<input type="checkbox" id="instagram-discount-enabled" checked class="mr-2">
<span class="text-sm text-gray-700">Abilita sconto Instagram</span>
</label>
</div>

<!-- Etichetta Sconto -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Etichetta Sconto</label>
<input type="text" id="admin-discount-label" value="Sconto Instagram -10%" 
placeholder="es. Sconto Instagram -10%, Offerta Speciale -15%..."
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Testo mostrato accanto al sconto nella pagina prenotazione</p>
</div>

<!-- Percentuale Sconto -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Percentuale Sconto</label>
<div class="flex items-center">
<input type="number" id="admin-discount-percentage" value="10" min="0" max="100" step="1"
class="w-24 px-4 py-2 border border-gray-300 rounded-l focus:border-primary focus:ring-1 focus:ring-primary">
<span class="bg-gray-100 px-4 py-2 border border-l-0 border-gray-300 rounded-r text-gray-600">%</span>
</div>
<p class="mt-1 text-xs text-gray-500">Percentuale di sconto applicata al prezzo base</p>
</div>

<!-- Anteprima Sconto -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Anteprima Sconto</label>
<div class="flex justify-center p-4 bg-white border border-gray-200 rounded-lg">
<div id="discount-preview" class="flex justify-between text-green-600 w-full max-w-md">
<span id="discount-preview-label">Sconto Instagram -10%</span>
<span id="discount-preview-amount">-€ 349,90</span>
</div>
</div>
</div>

</div>

<!-- Prezzo Base -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Prezzo Base per Questa Settimana</label>
<div class="flex items-center">
<span class="bg-gray-100 px-4 py-2 border border-r-0 border-gray-300 rounded-l text-gray-600">€</span>
<input type="number" id="admin-base-price" value="3499" 
class="w-40 px-4 py-2 border border-gray-300 rounded-r focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<p class="mt-1 text-xs text-gray-500">Prezzo utilizzato per i calcoli in base alle date selezionate</p>
</div>

<!-- Anno -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Anno</label>
<input type="number" id="admin-year" value="2025" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<!-- Titolo Principale -->
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Titolo Principale Pagina</label>
<input type="text" id="admin-main-heading" value="Prenota il tuo Catamarano" 
placeholder="Titolo che appare in cima alla pagina di prenotazione"
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Questo testo apparirà come titolo principale della pagina di prenotazione</p>
</div>

</div>
</div>
</div>

<!-- Logo Configuration -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Logo Aziendale</h2>
    </div>
    <div class="p-6 space-y-6">
        
        <!-- Logo Upload -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Logo</label>
            <div class="flex items-center space-x-4">
                <div class="flex-1">
                    <input type="file" id="admin-logo-upload" accept="image/*" 
                           class="hidden">
                    <label for="admin-logo-upload" 
                           class="cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        <i class="ri-image-line mr-2"></i>
                        Carica Logo
                    </label>
                    <p class="mt-1 text-xs text-gray-500">PNG, JPG fino a 2MB. Dimensioni consigliate: 200x60px</p>
                </div>
                <div class="flex-shrink-0">
                    <div id="logo-preview" class="w-32 h-16 border-2 border-dashed border-gray-300 rounded flex items-center justify-center bg-gray-50">
                        <span class="text-sm text-gray-500">Anteprima</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logo Alternative Text -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Testo Alternativo</label>
            <input type="text" id="admin-logo-text" value="logo" 
                   placeholder="Testo da mostrare se il logo non è disponibile"
                   class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
            <p class="mt-1 text-xs text-gray-500">Questo testo apparirà se non viene caricato alcun logo</p>
        </div>

        <!-- Reset Logo -->
        <div>
            <button id="reset-logo-button" 
                    class="inline-flex items-center px-4 py-2 border border-red-300 rounded text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                <i class="ri-delete-bin-line mr-2"></i>
                Rimuovi Logo
            </button>
        </div>

    </div>
</div>

<!-- Prezzi Pacchetti -->
<div>
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<h2 class="text-lg font-semibold text-gray-900">Pacchetti Obbligatori</h2>
</div>
<div class="p-6 space-y-6">

<!-- Charter -->
<div>
<h4 class="font-medium text-gray-900">Pacchetto Charter</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">€</span>
<input type="number" id="admin-charter-price" value="400" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

<!-- Carburante -->
<div>
<h4 class="font-medium text-gray-900">Carburante No Stress</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">€</span>
<input type="number" id="admin-fuel-price" value="350" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

<!-- Lenzuola -->
<div>
<h4 class="font-medium text-gray-900">Lenzuola e salviette</h4>
<div class="flex items-center mt-1">
<span class="text-sm text-gray-600 mr-2">Prezzo per ospite:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">€</span>
<input type="number" id="admin-linens-price" value="20" 
class="w-24 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>
</div>

</div>
</div>
<!-- Servizi Aggiuntivi -->
<div class="mt-8">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<h2 class="text-lg font-semibold text-gray-900">Servizi Aggiuntivi</h2>
</div>
<div class="p-6 space-y-8">

<!-- Servizi Raccomandati -->
<div class="border border-gray-200 rounded-lg p-4 bg-green-50">
<h4 class="font-medium text-gray-900 mb-4 flex items-center">
<i class="ri-star-line text-green-600 mr-2"></i>
Servizi Raccomandati
</h4>

<!-- Skipper -->
<div class="bg-white border border-green-200 rounded-lg p-4">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i id="skipper-icon" class="ri-steering-2-line text-2xl text-green-600 mr-3"></i>
<div>
<h5 class="font-medium text-gray-900">Skipper Professionale</h5>
<p class="text-sm text-green-600">Raccomandato</p>
</div>
</div>
<label class="flex items-center">
<input type="checkbox" id="skipper-enabled" checked class="mr-2">
<span class="text-sm text-gray-700">Abilita servizio</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Nome Servizio</label>
<input type="text" id="skipper-name" value="Skipper Professionale" 
class="w-full px-3 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-3 py-2 border border-r-0 border-gray-300 rounded-l text-sm">€</span>
<input type="number" id="skipper-price" value="200" min="0"
class="w-20 px-3 py-2 border border-gray-300 text-sm focus:border-primary">
<select id="skipper-unit" class="px-3 py-2 border border-l-0 border-gray-300 rounded-r text-sm focus:border-primary">
<option value="giorno">al giorno</option>
<option value="tantum">una tantum</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Descrizione</label>
<textarea id="skipper-description" rows="3" 
class="w-full px-3 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary"
>Affidati a un capitano professionista che si occuperà della navigazione e ti guiderà alla scoperta delle baie più belle e suggestive. Con il servizio skipper, la cauzione passa da €3.500 a €1.500.</textarea>
</div>

<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Testo Raccomandazione</label>
<input type="text" id="skipper-recommended-text" 
value="Raccomandato per chi ha poca esperienza di navigazione nelle acque della Sardegna e vuole godersi la vacanza senza preoccupazioni"
class="w-full px-3 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Icona (RemixIcon)</label>
<div class="flex items-center space-x-3">
<input type="text" id="skipper-icon-input" value="ri-steering-2-line" 
class="flex-1 px-3 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<div class="flex items-center space-x-2">
<span class="text-sm text-gray-600">Anteprima:</span>
<i id="skipper-icon-preview" class="ri-steering-2-line text-xl text-primary"></i>
</div>
</div>
<p class="mt-1 text-xs text-gray-500">Es: ri-steering-2-line, ri-ship-line, ri-anchor-line</p>
</div>
</div>
</div>

<!-- Altri Servizi -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4 flex items-center">
<i class="ri-service-line text-primary mr-2"></i>
Altri Servizi Opzionali
</h4>

<div class="space-y-6" id="additional-services-container">

<!-- Wi-Fi -->
<div class="service-editor bg-white border border-gray-200 rounded-lg p-4" data-service="wifi">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i class="service-icon ri-wifi-line text-2xl text-primary mr-3"></i>
<h5 class="font-medium text-gray-900">Wi-Fi</h5>
</div>
<label class="flex items-center">
<input type="checkbox" class="service-enabled mr-2" checked>
<span class="text-sm text-gray-700">Abilita</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
<input type="text" class="service-name w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="Wi-Fi">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-xs">€</span>
<input type="number" class="service-price w-16 px-2 py-1 border border-gray-300 text-xs" value="50" min="0">
<select class="service-unit px-2 py-1 border border-l-0 border-gray-300 rounded-r text-xs">
<option value="tantum">una tantum</option>
<option value="giorno">al giorno</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
<textarea class="service-description w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" rows="2"
>Connessione internet ad alta velocità disponibile a bordo per tutta la durata del viaggio.</textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icona</label>
<div class="flex items-center space-x-2">
<input type="text" class="service-icon-input flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="ri-wifi-line">
<i class="service-icon-preview ri-wifi-line text-lg text-primary"></i>
</div>
</div>
</div>

<!-- Sport Acquatici -->
<div class="service-editor bg-white border border-gray-200 rounded-lg p-4" data-service="watersports">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i class="service-icon ri-snorkel-line text-2xl text-primary mr-3"></i>
<h5 class="font-medium text-gray-900">Attrezzature Sport Acquatici</h5>
</div>
<label class="flex items-center">
<input type="checkbox" class="service-enabled mr-2" checked>
<span class="text-sm text-gray-700">Abilita</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
<input type="text" class="service-name w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="Attrezzature Sport Acquatici">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-xs">€</span>
<input type="number" class="service-price w-16 px-2 py-1 border border-gray-300 text-xs" value="300" min="0">
<select class="service-unit px-2 py-1 border border-l-0 border-gray-300 rounded-r text-xs">
<option value="tantum">una tantum</option>
<option value="giorno">al giorno</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
<textarea class="service-description w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" rows="2"
>Set completo con due SUP, 8 set di maschere con boccaglio e pinne per snorkeling.</textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icona</label>
<div class="flex items-center space-x-2">
<input type="text" class="service-icon-input flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="ri-snorkel-line">
<i class="service-icon-preview ri-snorkel-line text-lg text-primary"></i>
</div>
</div>
</div>

<!-- Pizza Perfetta -->
<div class="service-editor bg-white border border-gray-200 rounded-lg p-4" data-service="pizza">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i class="service-icon ri-restaurant-2-line text-2xl text-primary mr-3"></i>
<h5 class="font-medium text-gray-900">Pizza Perfetta</h5>
</div>
<label class="flex items-center">
<input type="checkbox" class="service-enabled mr-2" checked>
<span class="text-sm text-gray-700">Abilita</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
<input type="text" class="service-name w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="Pizza Perfetta">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-xs">€</span>
<input type="number" class="service-price w-16 px-2 py-1 border border-gray-300 text-xs" value="150" min="0">
<select class="service-unit px-2 py-1 border border-l-0 border-gray-300 rounded-r text-xs">
<option value="tantum">una tantum</option>
<option value="giorno">al giorno</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
<textarea class="service-description w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" rows="2"
>Forno per pizza Ooni Koda con kit completo per pizza, pale, tagliere e ingredienti base per 2 serate</textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icona</label>
<div class="flex items-center space-x-2">
<input type="text" class="service-icon-input flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="ri-restaurant-2-line">
<i class="service-icon-preview ri-restaurant-2-line text-lg text-primary"></i>
</div>
</div>
</div>

<!-- Bimby -->
<div class="service-editor bg-white border border-gray-200 rounded-lg p-4" data-service="bimby">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i class="service-icon ri-blender-line text-2xl text-primary mr-3"></i>
<h5 class="font-medium text-gray-900">Bimby</h5>
</div>
<label class="flex items-center">
<input type="checkbox" class="service-enabled mr-2" checked>
<span class="text-sm text-gray-700">Abilita</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
<input type="text" class="service-name w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="Bimby">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-xs">€</span>
<input type="number" class="service-price w-16 px-2 py-1 border border-gray-300 text-xs" value="250" min="0">
<select class="service-unit px-2 py-1 border border-l-0 border-gray-300 rounded-r text-xs">
<option value="tantum">una tantum</option>
<option value="giorno">al giorno</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
<textarea class="service-description w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" rows="2"
>Robot da cucina Bimby TM7 con ricettario digitale e accessori inclusi</textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icona</label>
<div class="flex items-center space-x-2">
<input type="text" class="service-icon-input flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="ri-blender-line">
<i class="service-icon-preview ri-blender-line text-lg text-primary"></i>
</div>
</div>
</div>

<!-- Pacchetto Cucina -->
<div class="service-editor bg-white border border-gray-200 rounded-lg p-4" data-service="kitchen">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i class="service-icon ri-restaurant-line text-2xl text-primary mr-3"></i>
<h5 class="font-medium text-gray-900">Pacchetto "come la cucina di casa tua"</h5>
</div>
<label class="flex items-center">
<input type="checkbox" class="service-enabled mr-2" checked>
<span class="text-sm text-gray-700">Abilita</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
<input type="text" class="service-name w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="Pacchetto &quot;come la cucina di casa tua&quot;">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-xs">€</span>
<input type="number" class="service-price w-16 px-2 py-1 border border-gray-300 text-xs" value="150" min="0">
<select class="service-unit px-2 py-1 border border-l-0 border-gray-300 rounded-r text-xs">
<option value="tantum">una tantum</option>
<option value="giorno">al giorno</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
<textarea class="service-description w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" rows="2"
>Macchina Nespresso con 100 capsule incluse, microonde, tostapane, frullatore ad immersione</textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icona</label>
<div class="flex items-center space-x-2">
<input type="text" class="service-icon-input flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="ri-restaurant-line">
<i class="service-icon-preview ri-restaurant-line text-lg text-primary"></i>
</div>
</div>
</div>

<!-- Attrezzatura Pesca -->
<div class="service-editor bg-white border border-gray-200 rounded-lg p-4" data-service="fishing">
<div class="flex items-start justify-between mb-3">
<div class="flex items-center">
<i class="service-icon ri-fish-line text-2xl text-primary mr-3"></i>
<h5 class="font-medium text-gray-900">Attrezzatura per la pesca</h5>
</div>
<label class="flex items-center">
<input type="checkbox" class="service-enabled mr-2" checked>
<span class="text-sm text-gray-700">Abilita</span>
</label>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
<input type="text" class="service-name w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="Attrezzatura per la pesca">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Prezzo</label>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-xs">€</span>
<input type="number" class="service-price w-16 px-2 py-1 border border-gray-300 text-xs" value="75" min="0">
<select class="service-unit px-2 py-1 border border-l-0 border-gray-300 rounded-r text-xs">
<option value="tantum">una tantum</option>
<option value="giorno">al giorno</option>
<option value="settimana">a settimana</option>
</select>
</div>
</div>
</div>

<div class="mb-3">
<label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
<textarea class="service-description w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" rows="2"
>Una canna da pesca con esche, retino e una cassetta attrezzi per la pesca</textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Icona</label>
<div class="flex items-center space-x-2">
<input type="text" class="service-icon-input flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary" value="ri-fish-line">
<i class="service-icon-preview ri-fish-line text-lg text-primary"></i>
</div>
</div>
</div>

</div>
</div>

</div>
</div>
</div>

<!-- Configurazione Email & Call-to-Action -->
<div class="mt-8">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<h2 class="text-lg font-semibold text-gray-900">Email & Call-to-Action</h2>
</div>
<div class="p-6 space-y-8">

<!-- Configurazione EmailJS -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Configurazione EmailJS</h4>

<!-- Abilita Sistema Email -->
<div class="mb-4">
<label class="flex items-center">
<input type="checkbox" id="email-system-enabled" checked class="mr-2">
<span class="text-sm text-gray-700">Abilita sistema invio email</span>
</label>
<p class="mt-1 text-xs text-gray-500">Disattiva per testare senza inviare email reali</p>
</div>

<!-- Service ID -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">EmailJS Service ID</label>
<input type="text" id="emailjs-service-id" placeholder="service_xxxxxxx" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">ID del servizio email configurato su EmailJS</p>
</div>

<!-- Template ID -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">EmailJS Template ID</label>
<input type="text" id="emailjs-template-id" placeholder="template_xxxxxxx" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">ID del template email configurato su EmailJS</p>
</div>

<!-- Public Key -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">EmailJS Public Key</label>
<input type="text" id="emailjs-public-key" placeholder="user_xxxxxxxxxxxxxxxx" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Chiave pubblica del tuo account EmailJS</p>
</div>

<!-- Email Admin -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Email Destinatario</label>
<input type="email" id="admin-email" value="prenotazioni@eliteescape.it" 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Email dove ricevere le richieste di prenotazione</p>
</div>

</div>

<!-- Configurazione Template Email -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Template Email</h4>

<!-- Oggetto Email -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Oggetto Email</label>
<input type="text" id="email-subject" value="Nuova Richiesta Prenotazione Catamarano - {catamaran_name}" 
placeholder="Oggetto dell'email inviata al cliente"
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
<p class="mt-1 text-xs text-gray-500">Usa {catamaran_name} per inserire automaticamente il nome del catamarano</p>
</div>

<!-- Campi da Includere -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-3">Campi da Includere nell'Email</label>
<div class="grid grid-cols-2 gap-3">
<label class="flex items-center">
<input type="checkbox" id="include-personal-data" checked class="mr-2">
<span class="text-sm text-gray-700">Dati Personali</span>
</label>
<label class="flex items-center">
<input type="checkbox" id="include-contact-info" checked class="mr-2">
<span class="text-sm text-gray-700">Info Contatto</span>
</label>
<label class="flex items-center">
<input type="checkbox" id="include-booking-details" checked class="mr-2">
<span class="text-sm text-gray-700">Dettagli Prenotazione</span>
</label>
<label class="flex items-center">
<input type="checkbox" id="include-selected-services" checked class="mr-2">
<span class="text-sm text-gray-700">Servizi Selezionati</span>
</label>
<label class="flex items-center">
<input type="checkbox" id="include-pricing-breakdown" checked class="mr-2">
<span class="text-sm text-gray-700">Riepilogo Prezzi</span>
</label>
<label class="flex items-center">
<input type="checkbox" id="include-special-notes" checked class="mr-2">
<span class="text-sm text-gray-700">Note Speciali</span>
</label>
<label class="flex items-center">
<input type="checkbox" id="include-navigation-experience" checked class="mr-2">
<span class="text-sm text-gray-700">Esperienza Navigazione</span>
</label>
</div>
</div>

<!-- Risposta Automatica -->
<div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
<label class="flex items-center mb-3">
<input type="checkbox" id="enable-auto-reply" checked class="mr-2">
<span class="text-sm font-medium text-gray-900">Abilita Risposta Automatica al Cliente</span>
</label>

<div id="auto-reply-config" class="space-y-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Oggetto Risposta Automatica</label>
<input type="text" id="auto-reply-subject" value="Conferma Ricezione Richiesta Prenotazione" 
class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Messaggio Risposta Automatica</label>
<textarea id="auto-reply-message" rows="3" 
class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary"
>Grazie per la tua richiesta di prenotazione. Ti ricontatteremo entro 24 ore per confermare la disponibilità e procedere con la prenotazione.</textarea>
</div>
</div>
</div>

</div>

<!-- Configurazione Call-to-Action -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Call-to-Action</h4>

<!-- Testo Pulsante -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Testo Pulsante</label>
<input type="text" id="cta-button-text" value="Invia Richiesta di Prenotazione" 
placeholder="Testo che appare sul pulsante principale"
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<!-- Sottotesto -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Sottotesto</label>
<textarea id="cta-subtext" rows="2" 
placeholder="Testo che appare sotto il pulsante"
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary"
>Sarai ricontattato da Cagliari Sailing Charter entro 24h per confermare e procedere al pagamento dell'anticipo</textarea>
</div>

<!-- Anteprima CTA -->
<div class="mb-4">
<label class="block text-sm font-medium text-gray-700 mb-2">Anteprima Call-to-Action</label>
<div class="p-4 bg-white border border-gray-200 rounded-lg">
<button id="cta-preview" class="w-full bg-primary text-white py-3 rounded-lg font-medium flex items-center justify-center transition-colors">
<i class="ri-mail-send-line mr-2"></i>
<span id="cta-preview-text">Invia Richiesta di Prenotazione</span>
</button>
<p id="cta-preview-subtext" class="mt-4 text-sm text-gray-600 text-center">Sarai ricontattato da Cagliari Sailing Charter entro 24h per confermare e procedere al pagamento dell'anticipo</p>
</div>
</div>

</div>

<!-- Messaggi di Notifica -->
<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
<h4 class="font-medium text-gray-900 mb-4">Messaggi di Notifica</h4>

<div class="space-y-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Messaggio di Successo</label>
<input type="text" id="success-message" value="✓ Richiesta inviata con successo! Ti ricontatteremo entro 24 ore." 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Messaggio di Errore</label>
<input type="text" id="error-message" value="✗ Errore nell'invio. Riprova o contattaci direttamente." 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Messaggio di Caricamento</label>
<input type="text" id="loading-message" value="Invio richiesta in corso..." 
class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary">
</div>
</div>

</div>

</div>
</div>
</div>

<!-- Calendario Prezzi Settimanali -->
<div class="mt-8">
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
<div class="px-6 py-4 border-b border-gray-200">
<div class="flex justify-between items-center">
<h2 class="text-lg font-semibold text-gray-900">Calendario Prezzi Settimanali</h2>
<div class="flex items-center space-x-2">
<label class="flex items-center">
<input type="checkbox" id="weekly-pricing-enabled" checked class="mr-2">
<span class="text-sm text-gray-600">Abilita prezzi dinamici</span>
</label>
</div>
</div>
</div>
<div class="p-6">

<!-- Controlli Navigazione -->
<div class="flex justify-between items-center mb-6">
<div class="flex items-center space-x-4">
<select id="calendar-year" class="px-3 py-2 border border-gray-300 rounded focus:border-primary">
<option value="2025">2025</option>
<option value="2026">2026</option>
</select>
<div class="flex items-center space-x-2">
<button id="prev-month" class="p-2 hover:bg-gray-100 rounded-full">
<i class="ri-arrow-left-s-line"></i>
</button>
<span id="current-month-display" class="text-lg font-medium min-w-[120px] text-center">Maggio 2025</span>
<button id="next-month" class="p-2 hover:bg-gray-100 rounded-full">
<i class="ri-arrow-right-s-line"></i>
</button>
</div>
</div>
<div class="flex items-center space-x-2">
<span class="text-sm text-gray-600">Prezzo default:</span>
<div class="flex items-center">
<span class="bg-gray-100 px-2 py-1 border border-r-0 border-gray-300 rounded-l text-sm">€</span>
<input type="number" id="default-weekly-price" value="3999" 
class="w-20 px-2 py-1 border border-gray-300 rounded-r text-sm focus:border-primary">
</div>
</div>
</div>

<!-- Template Stagionali -->
<div class="mb-6 p-4 bg-gray-50 rounded-lg">
<h4 class="font-medium text-gray-900 mb-3">Template Stagionali</h4>
<div class="flex flex-wrap gap-2">
<button class="template-btn px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm hover:bg-blue-200" data-price="2999">
Bassa Stagione (€2.999)
</button>
<button class="template-btn px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm hover:bg-green-200" data-price="3999">
Media Stagione (€3.999)
</button>
<button class="template-btn px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm hover:bg-red-200" data-price="4999">
Alta Stagione (€4.999)
</button>
</div>
</div>

<!-- Calendario -->
<div class="border border-gray-200 rounded-lg overflow-hidden">
<div class="grid grid-cols-8 text-center border-b border-gray-200 bg-gray-50">
<div class="py-3 text-xs font-medium text-gray-500">Settimana</div>
<div class="py-3 text-xs font-medium text-gray-500">Dom</div>
<div class="py-3 text-xs font-medium text-gray-500">Lun</div>
<div class="py-3 text-xs font-medium text-gray-500">Mar</div>
<div class="py-3 text-xs font-medium text-gray-500">Mer</div>
<div class="py-3 text-xs font-medium text-gray-500">Gio</div>
<div class="py-3 text-xs font-medium text-gray-500">Ven</div>
<div class="py-3 text-xs font-medium text-gray-500">Sab</div>
</div>
<div id="pricing-calendar" class="divide-y divide-gray-200">
<!-- Le righe del calendario verranno generate dinamicamente -->
</div>
</div>

<!-- Editor Prezzo Settimana -->
<div id="week-price-editor" class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
<div class="flex justify-between items-start">
<div>
<h4 class="font-medium text-gray-900 mb-2">Modifica Prezzo Settimana</h4>
<p class="text-sm text-gray-600" id="selected-week-info">Settimana selezionata</p>
</div>
<button id="close-editor" class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line"></i>
</button>
</div>
<div class="mt-4 flex items-center space-x-4">
<div class="flex items-center">
<span class="bg-gray-100 px-3 py-2 border border-r-0 border-gray-300 rounded-l text-sm">€</span>
<input type="number" id="week-price-input" value="3999" 
class="w-24 px-3 py-2 border border-gray-300 text-sm focus:border-primary">
</div>
<input type="text" id="week-note-input" placeholder="Note (opzionale)" 
class="flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:border-primary">
<button id="save-week-price" class="bg-primary text-white px-4 py-2 rounded text-sm hover:bg-opacity-90">
Salva
</button>
</div>
</div>

</div>
</div>
</div>

<!-- Bottom Save Button -->
<div class="mt-8 flex justify-center">
<button id="save-button-bottom" class="bg-primary text-white px-6 py-3 rounded-lg flex items-center">
<i class="ri-save-line mr-2"></i>
Salva Modifiche
</button>
</div>

</main>

<script>
// Funzioni globali per gestire la configurazione
window.saveConfiguration = function() {
    try {
        console.log('=== INIZIO SALVATAGGIO ===');
        const config = CatamaranStorage.load();
        
        // Aggiorna informazioni base
        const nameInput = document.getElementById('admin-catamaran-name');
        const startingPriceInput = document.getElementById('admin-starting-price');
        const priceInput = document.getElementById('admin-base-price');
        const yearInput = document.getElementById('admin-year');
        const mainHeadingInput = document.getElementById('admin-main-heading');
        
        console.log('Campi trovati:');
        console.log('- Nome:', nameInput ? nameInput.value : 'NON TROVATO');
        console.log('- Prezzo Partenza:', startingPriceInput ? startingPriceInput.value : 'NON TROVATO');
        console.log('- Prezzo Base:', priceInput ? priceInput.value : 'NON TROVATO');
        console.log('- Anno:', yearInput ? yearInput.value : 'NON TROVATO');
        console.log('- Titolo:', mainHeadingInput ? mainHeadingInput.value : 'NON TROVATO');
        
        if (nameInput && nameInput.value) {
            console.log('Aggiornando nome da:', config.basic.name, 'a:', nameInput.value);
            config.basic.name = nameInput.value;
        }
        if (startingPriceInput && startingPriceInput.value) {
            console.log('Aggiornando prezzo partenza da:', config.basic.startingPrice, 'a:', startingPriceInput.value);
            config.basic.startingPrice = parseInt(startingPriceInput.value);
        }
        
        // Assicurati che la struttura badge esista prima del salvataggio
        if (!config.priceBadge) {
            config.priceBadge = {
                enabled: true,
                text: "A partire da",
                color: "#f8b400",
                textColor: "#ffffff"
            };
        }
        
        // Aggiorna badge configuration
        const badgeTextInput = document.getElementById('admin-badge-text');
        const badgeColorInput = document.getElementById('admin-badge-color-text');
        
        if (badgeTextInput && badgeTextInput.value) {
            console.log('Aggiornando testo badge da:', config.priceBadge.text, 'a:', badgeTextInput.value);
            config.priceBadge.text = badgeTextInput.value;
        }
        if (badgeColorInput && badgeColorInput.value) {
            console.log('Aggiornando colore badge da:', config.priceBadge.color, 'a:', badgeColorInput.value);
            config.priceBadge.color = badgeColorInput.value;
        }
        if (priceInput && priceInput.value) {
            console.log('Aggiornando prezzo base da:', config.basic.basePrice, 'a:', priceInput.value);
            config.basic.basePrice = parseInt(priceInput.value);
        }
        if (yearInput && yearInput.value) {
            console.log('Aggiornando anno da:', config.basic.year, 'a:', yearInput.value);
            config.basic.year = parseInt(yearInput.value);
        }
        if (mainHeadingInput && mainHeadingInput.value) {
            console.log('Aggiornando titolo da:', config.ui.mainHeading, 'a:', mainHeadingInput.value);
            config.ui.mainHeading = mainHeadingInput.value;
        }
        
        // Aggiorna prezzi pacchetti obbligatori
        const charterPriceInput = document.getElementById('admin-charter-price');
        const fuelPriceInput = document.getElementById('admin-fuel-price');
        const linensPriceInput = document.getElementById('admin-linens-price');
        
        if (charterPriceInput && charterPriceInput.value) {
            config.mandatoryPackages.charter.price = parseInt(charterPriceInput.value);
            console.log('Charter aggiornato:', charterPriceInput.value);
        }
        if (fuelPriceInput && fuelPriceInput.value) {
            config.mandatoryPackages.fuel.price = parseInt(fuelPriceInput.value);
            console.log('Fuel aggiornato:', fuelPriceInput.value);
        }
        if (linensPriceInput && linensPriceInput.value) {
            config.mandatoryPackages.linens.pricePerGuest = parseInt(linensPriceInput.value);
            console.log('Lenzuola aggiornate:', linensPriceInput.value);
        }
        
        // Aggiorna servizi aggiuntivi
        saveAdditionalServices(config);
        
        // Aggiorna logo
        const logoTextInput = document.getElementById('admin-logo-text');
        if (logoTextInput && logoTextInput.value) {
            config.theme.logo.text = logoTextInput.value;
            console.log('Logo text aggiornato:', logoTextInput.value);
        }
        
        // Aggiorna impostazioni calendario prezzi settimanali
        const weeklyPricingEnabled = document.getElementById('weekly-pricing-enabled');
        const defaultWeeklyPriceInput = document.getElementById('default-weekly-price');
        
        // Assicurati che la struttura weeklyPricing esista
        if (!config.weeklyPricing) {
            config.weeklyPricing = {
                enabled: true,
                defaultPrice: 3999,
                weeks: {},
                templates: {
                    "alta_stagione": 4999,
                    "media_stagione": 3999,
                    "bassa_stagione": 2999
                }
            };
        }
        
        if (weeklyPricingEnabled) {
            config.weeklyPricing.enabled = weeklyPricingEnabled.checked;
            console.log('Prezzi settimanali abilitati:', weeklyPricingEnabled.checked);
        }
        
        if (defaultWeeklyPriceInput && defaultWeeklyPriceInput.value) {
            config.weeklyPricing.defaultPrice = parseInt(defaultWeeklyPriceInput.value);
            console.log('Prezzo default settimanale aggiornato:', defaultWeeklyPriceInput.value);
        }
        
        // Aggiorna impostazioni sconto Instagram
        const discountEnabled = document.getElementById('instagram-discount-enabled');
        const discountLabel = document.getElementById('admin-discount-label');
        const discountPercentage = document.getElementById('admin-discount-percentage');
        
        // Assicurati che la struttura pricing esista
        if (!config.pricing) {
            config.pricing = {};
        }
        if (!config.pricing.instagramDiscount) {
            config.pricing.instagramDiscount = {
                enabled: true,
                percentage: 10,
                amount: 349.90,
                label: "Sconto Instagram -10%"
            };
        }
        
        if (discountEnabled) {
            config.pricing.instagramDiscount.enabled = discountEnabled.checked;
            console.log('Sconto Instagram abilitato:', discountEnabled.checked);
        }
        
        if (discountLabel && discountLabel.value) {
            config.pricing.instagramDiscount.label = discountLabel.value;
            console.log('Etichetta sconto aggiornata:', discountLabel.value);
        }
        
        if (discountPercentage && discountPercentage.value) {
            const percentage = parseFloat(discountPercentage.value);
            config.pricing.instagramDiscount.percentage = percentage;
            // Calcola l'importo basato sul prezzo base corrente
            const basePrice = config.basic.basePrice || 3499;
            config.pricing.instagramDiscount.amount = (basePrice * percentage) / 100;
            console.log('Percentuale sconto aggiornata:', percentage + '%', 'Importo:', config.pricing.instagramDiscount.amount);
        }
        
        // Aggiorna configurazioni email e CTA
        saveEmailConfiguration(config);
        
        // Salva la configurazione
        const saved = CatamaranStorage.save(config);
        
        if (saved) {
            console.log('✓ Configurazione salvata con successo!');
            showNotification('✓ Configurazione salvata con successo!', 'success');
        } else {
            console.log('✗ Errore nel salvataggio');
            showNotification('✗ Errore nel salvataggio della configurazione', 'error');
        }
        
    } catch (error) {
        console.error('Errore saveConfiguration:', error);
        showNotification('✗ Errore: ' + error.message, 'error');
    }
};

window.loadConfiguration = function() {
    try {
        const config = CatamaranStorage.load();
        
        // Migrazione della configurazione logo (da stringa a oggetto)
        if (typeof config.theme.logo === 'string') {
            console.log('🔄 Migrazione configurazione logo da stringa a oggetto');
            const oldLogoText = config.theme.logo;
            config.theme.logo = {
                type: 'text',
                imageUrl: '',
                text: oldLogoText
            };
            // Salva la configurazione migrata
            CatamaranStorage.save(config);
        }
        
        // Assicurati che la struttura logo esista
        if (!config.theme.logo) {
            config.theme.logo = { type: 'text', imageUrl: '', text: 'logo' };
        }
        
        // Carica informazioni base
        const nameInput = document.getElementById('admin-catamaran-name');
        const startingPriceInput = document.getElementById('admin-starting-price');
        const priceInput = document.getElementById('admin-base-price');
        const yearInput = document.getElementById('admin-year');
        const mainHeadingInput = document.getElementById('admin-main-heading');
        
        if (nameInput) nameInput.value = config.basic.name;
        if (startingPriceInput) startingPriceInput.value = config.basic.startingPrice || 2999;
        if (priceInput) priceInput.value = config.basic.basePrice;
        if (yearInput) yearInput.value = config.basic.year;
        if (mainHeadingInput) mainHeadingInput.value = config.ui.mainHeading;
        
        // Carica configurazione badge
        const badgeTextInput = document.getElementById('admin-badge-text');
        const badgeColorInput = document.getElementById('admin-badge-color');
        const badgeColorTextInput = document.getElementById('admin-badge-color-text');
        
        // Assicurati che la struttura badge esista
        if (!config.priceBadge) {
            config.priceBadge = {
                enabled: true,
                text: "A partire da",
                color: "#f8b400",
                textColor: "#ffffff"
            };
        }
        
        if (badgeTextInput) badgeTextInput.value = config.priceBadge.text;
        if (badgeColorInput) badgeColorInput.value = config.priceBadge.color;
        if (badgeColorTextInput) badgeColorTextInput.value = config.priceBadge.color;
        
        // Carica prezzi pacchetti obbligatori
        const charterPriceInput = document.getElementById('admin-charter-price');
        const fuelPriceInput = document.getElementById('admin-fuel-price');
        const linensPriceInput = document.getElementById('admin-linens-price');
        
        if (charterPriceInput) charterPriceInput.value = config.mandatoryPackages.charter.price;
        if (fuelPriceInput) fuelPriceInput.value = config.mandatoryPackages.fuel.price;
        if (linensPriceInput) linensPriceInput.value = config.mandatoryPackages.linens.pricePerGuest;
        
        // Carica servizi aggiuntivi
        loadAdditionalServices(config);
        
        // Carica logo
        const logoTextInput = document.getElementById('admin-logo-text');
        if (logoTextInput) logoTextInput.value = config.theme.logo.text;
        
        console.log('📂 Configurazione logo caricata:', config.theme.logo);
        
        // Aggiorna anteprima logo
        updateLogoPreview(config.theme.logo);
        
        // Carica impostazioni calendario prezzi settimanali
        const weeklyPricingEnabled = document.getElementById('weekly-pricing-enabled');
        const defaultWeeklyPriceInput = document.getElementById('default-weekly-price');
        
        // Assicurati che la struttura weeklyPricing esista
        if (!config.weeklyPricing) {
            config.weeklyPricing = {
                enabled: true,
                defaultPrice: 3999,
                weeks: {},
                templates: {
                    "alta_stagione": 4999,
                    "media_stagione": 3999,
                    "bassa_stagione": 2999
                }
            };
        }
        
        if (weeklyPricingEnabled) {
            weeklyPricingEnabled.checked = config.weeklyPricing.enabled !== false;
        }
        
        if (defaultWeeklyPriceInput) {
            defaultWeeklyPriceInput.value = config.weeklyPricing.defaultPrice || 3999;
        }
        
        console.log('📅 Configurazione calendario prezzi caricata');
        
        // Carica impostazioni sconto Instagram
        const discountEnabled = document.getElementById('instagram-discount-enabled');
        const discountLabel = document.getElementById('admin-discount-label');
        const discountPercentage = document.getElementById('admin-discount-percentage');
        
        // Assicurati che la struttura pricing esista
        if (!config.pricing) {
            config.pricing = {
                instagramDiscount: {
                    enabled: true,
                    percentage: 10,
                    amount: 349.90,
                    label: "Sconto Instagram -10%"
                }
            };
        }
        if (!config.pricing.instagramDiscount) {
            config.pricing.instagramDiscount = {
                enabled: true,
                percentage: 10,
                amount: 349.90,
                label: "Sconto Instagram -10%"
            };
        }
        
        if (discountEnabled) {
            discountEnabled.checked = config.pricing.instagramDiscount.enabled !== false;
        }
        
        if (discountLabel) {
            discountLabel.value = config.pricing.instagramDiscount.label || "Sconto Instagram -10%";
        }
        
        if (discountPercentage) {
            discountPercentage.value = config.pricing.instagramDiscount.percentage || 10;
        }
        
        console.log('💰 Configurazione sconto Instagram caricata:', config.pricing.instagramDiscount);
        
        // Aggiorna anteprima sconto dopo il caricamento
        updateDiscountPreview();
        
        // Carica configurazioni email e CTA
        loadEmailConfiguration(config);
        
        console.log('✓ Configurazione caricata');
        
    } catch (error) {
        console.error('Errore loadConfiguration:', error);
        showNotification('✗ Errore nel caricamento: ' + error.message, 'error');
    }
};

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-50 ${
        type === 'error' ? 'bg-red-500' : 'bg-green-500'
    }`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Funzioni per gestire il badge
function updateBadgePreview() {
    const badgePreview = document.getElementById('badge-preview');
    const badgeTextInput = document.getElementById('admin-badge-text');
    const startingPriceInput = document.getElementById('admin-starting-price');
    const badgeColorTextInput = document.getElementById('admin-badge-color-text');
    
    if (badgePreview && badgeTextInput && startingPriceInput && badgeColorTextInput) {
        const text = badgeTextInput.value || 'A partire da';
        const price = startingPriceInput.value || '2999';
        const color = badgeColorTextInput.value || '#f8b400';
        
        badgePreview.style.backgroundColor = color;
        badgePreview.innerHTML = `
            <span class="text-xs mb-1">${text}</span>
            <span class="text-lg font-bold">€${parseInt(price).toLocaleString()}</span>
        `;
    }
}

function syncColorInputs() {
    const colorPicker = document.getElementById('admin-badge-color');
    const colorText = document.getElementById('admin-badge-color-text');
    
    if (colorPicker && colorText) {
        colorPicker.addEventListener('input', function() {
            colorText.value = this.value;
            updateBadgePreview();
        });
        
        colorText.addEventListener('input', function() {
            if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                colorPicker.value = this.value;
                updateBadgePreview();
            }
        });
    }
}

// === GESTIONE SCONTO INSTAGRAM ===
function updateDiscountPreview() {
    const discountLabel = document.getElementById('admin-discount-label');
    const discountPercentage = document.getElementById('admin-discount-percentage');
    const basePriceInput = document.getElementById('admin-base-price');
    const discountEnabled = document.getElementById('instagram-discount-enabled');
    
    const previewLabel = document.getElementById('discount-preview-label');
    const previewAmount = document.getElementById('discount-preview-amount');
    const discountPreview = document.getElementById('discount-preview');
    
    if (discountLabel && discountPercentage && basePriceInput && previewLabel && previewAmount && discountPreview) {
        const enabled = discountEnabled ? discountEnabled.checked : true;
        const label = discountLabel.value || 'Sconto Instagram -10%';
        const percentage = parseFloat(discountPercentage.value) || 10;
        const basePrice = parseFloat(basePriceInput.value) || 3499;
        
        const discountAmount = (basePrice * percentage) / 100;
        
        previewLabel.textContent = label;
        previewAmount.textContent = `-€ ${discountAmount.toFixed(2).replace('.', ',')}`;
        
        // Gestisci visibilità dell'anteprima
        if (enabled) {
            discountPreview.style.opacity = '1';
            discountPreview.style.color = '#16a34a'; // text-green-600
        } else {
            discountPreview.style.opacity = '0.5';
            discountPreview.style.color = '#6b7280'; // text-gray-500
        }
        
        console.log('📊 Anteprima sconto aggiornata:', {
            enabled,
            label,
            percentage: percentage + '%',
            basePrice: '€' + basePrice,
            discountAmount: '€' + discountAmount.toFixed(2)
        });
    }
}

function toggleDiscountSection() {
    const discountEnabled = document.getElementById('instagram-discount-enabled');
    const discountInputs = document.querySelectorAll('#admin-discount-label, #admin-discount-percentage');
    
    if (discountEnabled && discountInputs.length > 0) {
        const enabled = discountEnabled.checked;
        
        discountInputs.forEach(input => {
            input.disabled = !enabled;
            if (enabled) {
                input.classList.remove('bg-gray-100', 'text-gray-400');
            } else {
                input.classList.add('bg-gray-100', 'text-gray-400');
            }
        });
        
        updateDiscountPreview();
    }
}

// === GESTIONE EMAIL E CALL-TO-ACTION ===

function saveEmailConfiguration(config) {
    try {
        console.log('💌 Salvando configurazioni email e CTA...');
        
        // Assicurati che la struttura email esista
        if (!config.email) {
            config.email = {
                enabled: true,
                service: "emailjs",
                emailjs: { serviceId: "", templateId: "", publicKey: "" },
                template: {
                    subject: "Nuova Richiesta Prenotazione Catamarano - {catamaran_name}",
                    adminEmail: "prenotazioni@eliteescape.it",
                    includeFields: {
                        personalData: true,
                        contactInfo: true,
                        bookingDetails: true,
                        selectedServices: true,
                        pricingBreakdown: true,
                        specialNotes: true,
                        navigationExperience: true
                    },
                    autoReply: {
                        enabled: true,
                        subject: "Conferma Ricezione Richiesta Prenotazione",
                        message: "Grazie per la tua richiesta di prenotazione. Ti ricontatteremo entro 24 ore per confermare la disponibilità e procedere con la prenotazione."
                    }
                },
                notifications: {
                    successMessage: "✓ Richiesta inviata con successo! Ti ricontatteremo entro 24 ore.",
                    errorMessage: "✗ Errore nell'invio. Riprova o contattaci direttamente.",
                    loadingMessage: "Invio richiesta in corso..."
                }
            };
        }
        
        // Salva configurazioni EmailJS
        const emailSystemEnabled = document.getElementById('email-system-enabled');
        const serviceId = document.getElementById('emailjs-service-id');
        const templateId = document.getElementById('emailjs-template-id');
        const publicKey = document.getElementById('emailjs-public-key');
        const adminEmail = document.getElementById('admin-email');
        
        if (emailSystemEnabled) config.email.enabled = emailSystemEnabled.checked;
        if (serviceId && serviceId.value) config.email.emailjs.serviceId = serviceId.value;
        if (templateId && templateId.value) config.email.emailjs.templateId = templateId.value;
        if (publicKey && publicKey.value) config.email.emailjs.publicKey = publicKey.value;
        if (adminEmail && adminEmail.value) config.email.template.adminEmail = adminEmail.value;
        
        // Salva configurazioni template
        const emailSubject = document.getElementById('email-subject');
        if (emailSubject && emailSubject.value) {
            config.email.template.subject = emailSubject.value;
        }
        
        // Salva campi da includere
        const includeFields = {
            personalData: document.getElementById('include-personal-data')?.checked || false,
            contactInfo: document.getElementById('include-contact-info')?.checked || false,
            bookingDetails: document.getElementById('include-booking-details')?.checked || false,
            selectedServices: document.getElementById('include-selected-services')?.checked || false,
            pricingBreakdown: document.getElementById('include-pricing-breakdown')?.checked || false,
            specialNotes: document.getElementById('include-special-notes')?.checked || false,
            navigationExperience: document.getElementById('include-navigation-experience')?.checked || false
        };
        config.email.template.includeFields = includeFields;
        
        // Salva risposta automatica
        const autoReplyEnabled = document.getElementById('enable-auto-reply');
        const autoReplySubject = document.getElementById('auto-reply-subject');
        const autoReplyMessage = document.getElementById('auto-reply-message');
        
        if (autoReplyEnabled) config.email.template.autoReply.enabled = autoReplyEnabled.checked;
        if (autoReplySubject && autoReplySubject.value) config.email.template.autoReply.subject = autoReplySubject.value;
        if (autoReplyMessage && autoReplyMessage.value) config.email.template.autoReply.message = autoReplyMessage.value;
        
        // Salva configurazioni CTA
        const ctaButtonText = document.getElementById('cta-button-text');
        const ctaSubtext = document.getElementById('cta-subtext');
        
        if (ctaButtonText && ctaButtonText.value) config.ui.bookingButton = ctaButtonText.value;
        if (ctaSubtext && ctaSubtext.value) config.ui.bookingSubtext = ctaSubtext.value;
        
        // Salva messaggi di notifica
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const loadingMessage = document.getElementById('loading-message');
        
        if (successMessage && successMessage.value) config.email.notifications.successMessage = successMessage.value;
        if (errorMessage && errorMessage.value) config.email.notifications.errorMessage = errorMessage.value;
        if (loadingMessage && loadingMessage.value) config.email.notifications.loadingMessage = loadingMessage.value;
        
        console.log('✓ Configurazioni email e CTA salvate');
        
    } catch (error) {
        console.error('❌ Errore salvataggio email config:', error);
    }
}

function loadEmailConfiguration(config) {
    try {
        console.log('📧 Caricando configurazioni email e CTA...');
        
        // Assicurati che la struttura email esista
        if (!config.email) {
            config.email = {
                enabled: true,
                service: "emailjs",
                emailjs: { serviceId: "", templateId: "", publicKey: "" },
                template: {
                    subject: "Nuova Richiesta Prenotazione Catamarano - {catamaran_name}",
                    adminEmail: "prenotazioni@eliteescape.it",
                    includeFields: {
                        personalData: true,
                        contactInfo: true,
                        bookingDetails: true,
                        selectedServices: true,
                        pricingBreakdown: true,
                        specialNotes: true,
                        navigationExperience: true
                    },
                    autoReply: {
                        enabled: true,
                        subject: "Conferma Ricezione Richiesta Prenotazione",
                        message: "Grazie per la tua richiesta di prenotazione. Ti ricontatteremo entro 24 ore per confermare la disponibilità e procedere con la prenotazione."
                    }
                },
                notifications: {
                    successMessage: "✓ Richiesta inviata con successo! Ti ricontatteremo entro 24 ore.",
                    errorMessage: "✗ Errore nell'invio. Riprova o contattaci direttamente.",
                    loadingMessage: "Invio richiesta in corso..."
                }
            };
        }
        
        // Carica configurazioni EmailJS
        const emailSystemEnabled = document.getElementById('email-system-enabled');
        const serviceId = document.getElementById('emailjs-service-id');
        const templateId = document.getElementById('emailjs-template-id');
        const publicKey = document.getElementById('emailjs-public-key');
        const adminEmail = document.getElementById('admin-email');
        
        if (emailSystemEnabled) emailSystemEnabled.checked = config.email.enabled !== false;
        if (serviceId) serviceId.value = config.email.emailjs.serviceId || "";
        if (templateId) templateId.value = config.email.emailjs.templateId || "";
        if (publicKey) publicKey.value = config.email.emailjs.publicKey || "";
        if (adminEmail) adminEmail.value = config.email.template.adminEmail || "prenotazioni@eliteescape.it";
        
        // Carica configurazioni template
        const emailSubject = document.getElementById('email-subject');
        if (emailSubject) {
            emailSubject.value = config.email.template.subject || "Nuova Richiesta Prenotazione Catamarano - {catamaran_name}";
        }
        
        // Carica campi da includere
        if (config.email.template.includeFields) {
            const fields = config.email.template.includeFields;
            document.getElementById('include-personal-data').checked = fields.personalData !== false;
            document.getElementById('include-contact-info').checked = fields.contactInfo !== false;
            document.getElementById('include-booking-details').checked = fields.bookingDetails !== false;
            document.getElementById('include-selected-services').checked = fields.selectedServices !== false;
            document.getElementById('include-pricing-breakdown').checked = fields.pricingBreakdown !== false;
            document.getElementById('include-special-notes').checked = fields.specialNotes !== false;
            document.getElementById('include-navigation-experience').checked = fields.navigationExperience !== false;
        }
        
        // Carica risposta automatica
        const autoReplyEnabled = document.getElementById('enable-auto-reply');
        const autoReplySubject = document.getElementById('auto-reply-subject');
        const autoReplyMessage = document.getElementById('auto-reply-message');
        
        if (autoReplyEnabled && config.email.template.autoReply) {
            autoReplyEnabled.checked = config.email.template.autoReply.enabled !== false;
        }
        if (autoReplySubject && config.email.template.autoReply) {
            autoReplySubject.value = config.email.template.autoReply.subject || "Conferma Ricezione Richiesta Prenotazione";
        }
        if (autoReplyMessage && config.email.template.autoReply) {
            autoReplyMessage.value = config.email.template.autoReply.message || "Grazie per la tua richiesta di prenotazione. Ti ricontatteremo entro 24 ore per confermare la disponibilità e procedere con la prenotazione.";
        }
        
        // Carica configurazioni CTA
        const ctaButtonText = document.getElementById('cta-button-text');
        const ctaSubtext = document.getElementById('cta-subtext');
        
        if (ctaButtonText) ctaButtonText.value = config.ui.bookingButton || "Invia Richiesta di Prenotazione";
        if (ctaSubtext) ctaSubtext.value = config.ui.bookingSubtext || "Sarai ricontattato da Cagliari Sailing Charter entro 24h per confermare e procedere al pagamento dell'anticipo";
        
        // Carica messaggi di notifica
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const loadingMessage = document.getElementById('loading-message');
        
        if (successMessage && config.email.notifications) {
            successMessage.value = config.email.notifications.successMessage || "✓ Richiesta inviata con successo! Ti ricontatteremo entro 24 ore.";
        }
        if (errorMessage && config.email.notifications) {
            errorMessage.value = config.email.notifications.errorMessage || "✗ Errore nell'invio. Riprova o contattaci direttamente.";
        }
        if (loadingMessage && config.email.notifications) {
            loadingMessage.value = config.email.notifications.loadingMessage || "Invio richiesta in corso...";
        }
        
        // Aggiorna anteprima CTA
        updateCTAPreview();
        
        console.log('✓ Configurazioni email e CTA caricate');
        
    } catch (error) {
        console.error('❌ Errore caricamento email config:', error);
    }
}

function updateCTAPreview() {
    const ctaButtonText = document.getElementById('cta-button-text');
    const ctaSubtext = document.getElementById('cta-subtext');
    const ctaPreviewText = document.getElementById('cta-preview-text');
    const ctaPreviewSubtext = document.getElementById('cta-preview-subtext');
    
    if (ctaPreviewText && ctaButtonText) {
        ctaPreviewText.textContent = ctaButtonText.value || 'Invia Richiesta di Prenotazione';
    }
    
    if (ctaPreviewSubtext && ctaSubtext) {
        ctaPreviewSubtext.textContent = ctaSubtext.value || 'Sarai ricontattato da Cagliari Sailing Charter entro 24h per confermare e procedere al pagamento dell\'anticipo';
    }
    
    console.log('🔄 Anteprima CTA aggiornata');
}

function toggleAutoReplyConfig() {
    const autoReplyEnabled = document.getElementById('enable-auto-reply');
    const autoReplyConfig = document.getElementById('auto-reply-config');
    
    if (autoReplyEnabled && autoReplyConfig) {
        if (autoReplyEnabled.checked) {
            autoReplyConfig.style.display = 'block';
            autoReplyConfig.style.opacity = '1';
        } else {
            autoReplyConfig.style.opacity = '0.5';
        }
    }
}

// === GESTIONE CALENDARIO PREZZI SETTIMANALI ===
let currentCalendarMonth = new Date().getMonth() + 1; // Gennaio = 1
let currentCalendarYear = new Date().getFullYear();
let selectedWeek = null;

// Genera il calendario dei prezzi per il mese corrente
function generatePricingCalendar(month, year) {
    console.log(`🗓️ Generando calendario per ${month}/${year}`);
    const calendar = document.getElementById('pricing-calendar');
    if (!calendar) {
        console.error('❌ Elemento pricing-calendar non trovato');
        return;
    }
    
    const config = CatamaranStorage.load();
    
    // Assicurati che la struttura weeklyPricing esista
    if (!config.weeklyPricing) {
        config.weeklyPricing = {
            enabled: true,
            defaultPrice: 3999,
            weeks: {},
            templates: {
                "alta_stagione": 4999,
                "media_stagione": 3999,
                "bassa_stagione": 2999
            }
        };
    }
    
    const monthNames = ['', 'Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                       'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
    
    // Aggiorna display mese corrente
    const monthDisplay = document.getElementById('current-month-display');
    if (monthDisplay) {
        monthDisplay.textContent = `${monthNames[month]} ${year}`;
    }
    
    // Calcola le settimane del mese
    const weeks = getWeeksInMonth(month, year);
    
    // Pulisci calendario esistente
    calendar.innerHTML = '';
    
    // Genera le righe per ogni settimana
    weeks.forEach((week, weekIndex) => {
        const weekKey = `${year}-W${week.weekNumber.toString().padStart(2, '0')}`;
        const weekData = config.weeklyPricing.weeks[weekKey] || {
            price: config.weeklyPricing.defaultPrice,
            note: ''
        };
        
        
        const row = document.createElement('div');
        row.className = 'grid grid-cols-8 border-b border-gray-100 hover:bg-gray-50 cursor-pointer week-row';
        row.dataset.weekKey = weekKey;
        row.dataset.weekNumber = week.weekNumber;
        
        // Colonna settimana (numero + prezzo)
        const weekCell = document.createElement('div');
        weekCell.className = 'p-3 text-center border-r border-gray-100';
        weekCell.innerHTML = `
            <div class="text-sm font-medium text-gray-900">W${week.weekNumber}</div>
            <div class="text-xs text-primary font-bold">€${weekData.price.toLocaleString()}</div>
            ${weekData.note ? `<div class="text-xs text-gray-500 mt-1">${weekData.note}</div>` : ''}
        `;
        row.appendChild(weekCell);
        
        // Colonne giorni della settimana
        week.days.forEach(day => {
            const dayCell = document.createElement('div');
            dayCell.className = 'p-3 text-center text-sm';
            
            if (day.date) {
                const isCurrentMonth = day.date.getMonth() + 1 === month;
                dayCell.className += isCurrentMonth ? ' text-gray-900' : ' text-gray-400';
                dayCell.textContent = day.date.getDate();
            }
            
            row.appendChild(dayCell);
        });
        
        // Aggiungi evento click per modifica
        row.addEventListener('click', () => openWeekEditor(weekKey, week.weekNumber, weekData));
        
        calendar.appendChild(row);
    });
    
    console.log(`✅ Calendario generato con ${weeks.length} settimane`);
}

// Calcola le settimane di un mese
function getWeeksInMonth(month, year) {
    const weeks = [];
    const firstDay = new Date(year, month - 1, 1);
    const lastDay = new Date(year, month, 0);
    
    console.log(`📅 Generando settimane per ${month}/${year}: dal ${firstDay.toISOString().slice(0,10)} al ${lastDay.toISOString().slice(0,10)}`);
    
    // Trova il lunedì della settimana che contiene il primo giorno del mese
    let startDate = new Date(firstDay);
    const dayOfWeek = startDate.getDay();
    const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
    startDate.setDate(startDate.getDate() + mondayOffset);
    
    console.log(`🗓️ Prima settimana inizia lunedì: ${startDate.toISOString().slice(0,10)}`);
    
    let currentDate = new Date(startDate);
    
    // Genera tutte le settimane che toccano il mese
    while (true) {
        const weekNumber = getWeekNumber(currentDate);
        const days = [];
        
        console.log(`🔄 Processando settimana W${weekNumber} che inizia ${currentDate.toISOString().slice(0,10)}`);
        
        // Genera i 7 giorni della settimana (Dom-Lun-Mar-Mer-Gio-Ven-Sab)
        for (let i = 0; i < 7; i++) {
            const dayDate = new Date(currentDate);
            if (i === 0) {
                // Domenica: vai indietro di 1 giorno dal lunedì
                dayDate.setDate(currentDate.getDate() - 1);
            } else {
                // Lun-Sab: currentDate + (i-1)
                dayDate.setDate(currentDate.getDate() + (i - 1));
            }
            
            days.push({
                date: dayDate,
                isCurrentMonth: dayDate.getMonth() + 1 === month
            });
        }
        
        // Controlla se questa settimana tocca il mese corrente
        const weekTouchesMonth = days.some(day => day.isCurrentMonth);
        
        if (weekTouchesMonth) {
            weeks.push({
                weekNumber: weekNumber,
                days: days,
                startDate: new Date(currentDate)
            });
            console.log(`✅ Settimana W${weekNumber} aggiunta: giorni [${days.map(d => d.date.getDate()).join(', ')}]`);
        }
        
        // Vai alla settimana successiva
        currentDate.setDate(currentDate.getDate() + 7);
        
        // Stop se siamo andati troppo oltre il mese corrente
        if (currentDate.getMonth() > month - 1 && currentDate.getDate() > 7) {
            break;
        }
        
        // Sicurezza per evitare loop infinito
        if (weeks.length > 6) {
            console.warn('⚠️ Limite di 6 settimane raggiunto');
            break;
        }
    }
    
    console.log(`✅ Totale settimane generate: ${weeks.length}`);
    return weeks;
}

// Calcola il numero della settimana ISO
function getWeekNumber(date) {
    const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
    const dayNum = d.getUTCDay() || 7;
    d.setUTCDate(d.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
    return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}

// Apre l'editor per modificare il prezzo di una settimana
function openWeekEditor(weekKey, weekNumber, weekData) {
    selectedWeek = weekKey;
    const editor = document.getElementById('week-price-editor');
    const weekInfo = document.getElementById('selected-week-info');
    const priceInput = document.getElementById('week-price-input');
    const noteInput = document.getElementById('week-note-input');
    
    if (editor && weekInfo && priceInput && noteInput) {
        weekInfo.textContent = `Settimana ${weekNumber} (${weekKey})`;
        priceInput.value = weekData.price;
        noteInput.value = weekData.note || '';
        editor.classList.remove('hidden');
        
        // Evidenzia la riga selezionata
        document.querySelectorAll('.week-row').forEach(row => {
            row.classList.remove('bg-blue-100');
        });
        const selectedRow = document.querySelector(`[data-week-key="${weekKey}"]`);
        if (selectedRow) {
            selectedRow.classList.add('bg-blue-100');
        }
    }
}

// Chiude l'editor prezzi
function closeWeekEditor() {
    const editor = document.getElementById('week-price-editor');
    if (editor) {
        editor.classList.add('hidden');
    }
    
    // Rimuovi evidenziazione
    document.querySelectorAll('.week-row').forEach(row => {
        row.classList.remove('bg-blue-100');
    });
    
    selectedWeek = null;
}

// Salva il prezzo della settimana
function saveWeekPrice() {
    if (!selectedWeek) return;
    
    const priceInput = document.getElementById('week-price-input');
    const noteInput = document.getElementById('week-note-input');
    
    if (!priceInput) return;
    
    const price = parseInt(priceInput.value) || 0;
    const note = noteInput ? noteInput.value.trim() : '';
    
    // Aggiorna configurazione
    const config = CatamaranStorage.load();
    if (!config.weeklyPricing.weeks) {
        config.weeklyPricing.weeks = {};
    }
    
    config.weeklyPricing.weeks[selectedWeek] = {
        price: price,
        note: note
    };
    
    // Salva la configurazione
    const saved = CatamaranStorage.save(config);
    
    if (saved) {
        showNotification('✓ Prezzo settimana salvato!', 'success');
        // Rigenera calendario per mostrare le modifiche
        generatePricingCalendar(currentCalendarMonth, currentCalendarYear);
        closeWeekEditor();
    } else {
        showNotification('✗ Errore nel salvataggio', 'error');
    }
}

// Applica un template stagionale alle settimane selezionate
function applySeasonalTemplate(templatePrice) {
    if (!selectedWeek) {
        showNotification('Seleziona prima una settimana', 'error');
        return;
    }
    
    const priceInput = document.getElementById('week-price-input');
    if (priceInput) {
        priceInput.value = templatePrice;
    }
}

// Naviga al mese precedente
function navigateToPreviousMonth() {
    currentCalendarMonth--;
    if (currentCalendarMonth < 1) {
        currentCalendarMonth = 12;
        currentCalendarYear--;
    }
    generatePricingCalendar(currentCalendarMonth, currentCalendarYear);
    closeWeekEditor();
}

// Naviga al mese successivo
function navigateToNextMonth() {
    currentCalendarMonth++;
    if (currentCalendarMonth > 12) {
        currentCalendarMonth = 1;
        currentCalendarYear++;
    }
    generatePricingCalendar(currentCalendarMonth, currentCalendarYear);
    closeWeekEditor();
}

// Cambia anno del calendario
function changeCalendarYear(year) {
    currentCalendarYear = parseInt(year);
    generatePricingCalendar(currentCalendarMonth, currentCalendarYear);
    closeWeekEditor();
}

// Aggiorna il prezzo di default per tutte le settimane future
function updateDefaultPrice() {
    const defaultPriceInput = document.getElementById('default-weekly-price');
    if (!defaultPriceInput) return;
    
    const newDefaultPrice = parseInt(defaultPriceInput.value) || 3999;
    
    const config = CatamaranStorage.load();
    config.weeklyPricing.defaultPrice = newDefaultPrice;
    
    const saved = CatamaranStorage.save(config);
    if (saved) {
        showNotification('✓ Prezzo default aggiornato!', 'success');
        generatePricingCalendar(currentCalendarMonth, currentCalendarYear);
    }
}

// Funzioni per gestire il logo
function updateLogoPreview(logoConfig) {
    const preview = document.getElementById('logo-preview');
    console.log('🖼️ Aggiornamento anteprima logo:', logoConfig);
    
    if (!preview) {
        console.error('❌ Elemento logo-preview non trovato');
        return;
    }
    
    if (logoConfig && logoConfig.type === 'image' && logoConfig.imageUrl) {
        console.log('✅ Mostrando immagine logo');
        preview.innerHTML = `<img src="${logoConfig.imageUrl}" alt="Logo Preview" class="w-full h-full object-contain">`;
    } else {
        console.log('📝 Mostrando testo logo:', logoConfig?.text || 'Anteprima');
        preview.innerHTML = `<span class="text-sm text-gray-500">${logoConfig?.text || 'Anteprima'}</span>`;
    }
}

function handleLogoUpload(file) {
    if (!file) return;
    
    console.log('🔄 Caricamento logo:', file.name, file.size, file.type);
    
    // Verifica dimensione file (max 2MB)
    if (file.size > 2 * 1024 * 1024) {
        showNotification('✗ Il file è troppo grande. Massimo 2MB.', 'error');
        return;
    }
    
    // Verifica tipo file
    if (!file.type.match(/^image\/(png|jpg|jpeg)$/)) {
        showNotification('✗ Formato non supportato. Usa PNG o JPG.', 'error');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        console.log('📂 File letto, caricamento configurazione...');
        const config = CatamaranStorage.load();
        
        // Assicurati che la struttura logo esista
        if (!config.theme.logo) {
            config.theme.logo = { type: 'text', imageUrl: '', text: 'logo' };
        }
        
        config.theme.logo.type = 'image';
        config.theme.logo.imageUrl = e.target.result;
        
        console.log('💾 Configurazione logo aggiornata:', config.theme.logo.type);
        
        // Aggiorna anteprima
        updateLogoPreview(config.theme.logo);
        
        // Salva automaticamente
        const saved = CatamaranStorage.save(config);
        console.log('💾 Salvataggio:', saved ? 'Successo' : 'Fallito');
        
        showNotification('✓ Logo caricato con successo!', 'success');
    };
    reader.readAsDataURL(file);
}

function resetLogo() {
    const config = CatamaranStorage.load();
    config.theme.logo.type = 'text';
    config.theme.logo.imageUrl = '';
    
    // Aggiorna anteprima
    updateLogoPreview(config.theme.logo);
    
    // Salva
    CatamaranStorage.save(config);
    showNotification('✓ Logo rimosso', 'success');
}

// === GESTIONE SERVIZI AGGIUNTIVI ===

function saveAdditionalServices(config) {
    try {
        console.log('🛠️ Salvando servizi aggiuntivi...');
        
        // Assicurati che la struttura servizi aggiuntivi esista
        if (!config.additionalServices) {
            config.additionalServices = {};
        }
        
        // Gestisce lo skipper separatamente (ha struttura diversa)
        const skipperPrice = document.getElementById('skipper-price');
        const skipperName = document.getElementById('skipper-name');
        const skipperDescription = document.getElementById('skipper-description');
        const skipperUnit = document.getElementById('skipper-unit');
        const skipperIcon = document.getElementById('skipper-icon-input');
        
        if (skipperPrice) {
            if (!config.additionalServices.skipper) {
                config.additionalServices.skipper = {
                    name: "Skipper Professionale",
                    price: 200,
                    unit: "giorno",
                    description: "",
                    recommended: true,
                    icon: "ri-steering-2-line"
                };
            }
            config.additionalServices.skipper.price = parseInt(skipperPrice.value) || 200;
            if (skipperName && skipperName.value) config.additionalServices.skipper.name = skipperName.value;
            if (skipperDescription && skipperDescription.value) config.additionalServices.skipper.description = skipperDescription.value;
            if (skipperUnit && skipperUnit.value) config.additionalServices.skipper.unit = skipperUnit.value;
            if (skipperIcon && skipperIcon.value) config.additionalServices.skipper.icon = skipperIcon.value;
        }
        
        // Gestisce tutti gli altri servizi con struttura generica
        const serviceEditors = document.querySelectorAll('.service-editor[data-service]');
        console.log(`📋 Trovati ${serviceEditors.length} service editors`);
        
        serviceEditors.forEach(editor => {
            const serviceKey = editor.dataset.service;
            if (!serviceKey || serviceKey === 'skipper') return; // Skipper già gestito sopra
            
            const nameInput = editor.querySelector('.service-name');
            const priceInput = editor.querySelector('.service-price');
            const unitSelect = editor.querySelector('.service-unit');
            const descriptionInput = editor.querySelector('.service-description');
            const iconInput = editor.querySelector('.service-icon-input');
            const enabledInput = editor.querySelector('.service-enabled');
            
            console.log(`🔧 Processando servizio: ${serviceKey}`);
            
            // Inizializza il servizio se non esiste
            if (!config.additionalServices[serviceKey]) {
                config.additionalServices[serviceKey] = {
                    name: nameInput ? nameInput.value : serviceKey,
                    price: 0,
                    unit: "tantum",
                    description: "",
                    recommended: false,
                    icon: "ri-service-line"
                };
            }
            
            // Aggiorna i valori
            if (nameInput && nameInput.value) {
                config.additionalServices[serviceKey].name = nameInput.value;
            }
            if (priceInput && priceInput.value) {
                config.additionalServices[serviceKey].price = parseInt(priceInput.value) || 0;
            }
            if (unitSelect && unitSelect.value) {
                config.additionalServices[serviceKey].unit = unitSelect.value;
            }
            if (descriptionInput && descriptionInput.value) {
                config.additionalServices[serviceKey].description = descriptionInput.value;
            }
            if (iconInput && iconInput.value) {
                config.additionalServices[serviceKey].icon = iconInput.value;
            }
            if (enabledInput !== null) {
                config.additionalServices[serviceKey].enabled = enabledInput.checked;
            }
            
            console.log(`✅ Servizio ${serviceKey} aggiornato:`, {
                name: config.additionalServices[serviceKey].name,
                price: config.additionalServices[serviceKey].price,
                unit: config.additionalServices[serviceKey].unit
            });
        });
        
        console.log('✅ Servizi aggiuntivi salvati:', Object.keys(config.additionalServices));
        
    } catch (error) {
        console.error('❌ Errore salvataggio servizi aggiuntivi:', error);
        throw error;
    }
}

function loadAdditionalServices(config) {
    try {
        console.log('🔄 Caricando servizi aggiuntivi...');
        
        // Assicurati che la struttura servizi aggiuntivi esista
        if (!config.additionalServices) {
            config.additionalServices = {};
        }
        
        // Gestisce lo skipper separatamente (ha struttura diversa)
        if (config.additionalServices.skipper) {
            const skipperPrice = document.getElementById('skipper-price');
            const skipperName = document.getElementById('skipper-name');
            const skipperDescription = document.getElementById('skipper-description');
            const skipperUnit = document.getElementById('skipper-unit');
            const skipperIcon = document.getElementById('skipper-icon-input');
            
            if (skipperPrice) skipperPrice.value = config.additionalServices.skipper.price || 200;
            if (skipperName) skipperName.value = config.additionalServices.skipper.name || "Skipper Professionale";
            if (skipperDescription) skipperDescription.value = config.additionalServices.skipper.description || "";
            if (skipperUnit) skipperUnit.value = config.additionalServices.skipper.unit || "giorno";
            if (skipperIcon) skipperIcon.value = config.additionalServices.skipper.icon || "ri-steering-2-line";
        }
        
        // Gestisce tutti gli altri servizi con struttura generica
        const serviceEditors = document.querySelectorAll('.service-editor[data-service]');
        console.log(`📋 Caricando ${serviceEditors.length} service editors`);
        
        serviceEditors.forEach(editor => {
            const serviceKey = editor.dataset.service;
            if (!serviceKey || serviceKey === 'skipper') return; // Skipper già gestito sopra
            
            const serviceConfig = config.additionalServices[serviceKey];
            if (!serviceConfig) return; // Servizio non configurato
            
            const nameInput = editor.querySelector('.service-name');
            const priceInput = editor.querySelector('.service-price');
            const unitSelect = editor.querySelector('.service-unit');
            const descriptionInput = editor.querySelector('.service-description');
            const iconInput = editor.querySelector('.service-icon-input');
            const enabledInput = editor.querySelector('.service-enabled');
            
            console.log(`🔧 Caricando servizio: ${serviceKey}`, serviceConfig);
            
            // Carica i valori negli input
            if (nameInput) nameInput.value = serviceConfig.name || '';
            if (priceInput) priceInput.value = serviceConfig.price || 0;
            if (unitSelect) unitSelect.value = serviceConfig.unit || 'tantum';
            if (descriptionInput) descriptionInput.value = serviceConfig.description || '';
            if (iconInput) iconInput.value = serviceConfig.icon || 'ri-service-line';
            if (enabledInput) enabledInput.checked = serviceConfig.enabled !== false;
            
            // Aggiorna anche l'anteprima dell'icona se esiste
            const iconPreview = editor.querySelector('.service-icon-preview');
            if (iconPreview && serviceConfig.icon) {
                iconPreview.className = `service-icon-preview ${serviceConfig.icon} text-lg text-primary`;
            }
            
            console.log(`✅ Servizio ${serviceKey} caricato nell'interfaccia`);
        });
        
        console.log('✅ Servizi aggiuntivi caricati');
        
    } catch (error) {
        console.error('❌ Errore caricamento servizi aggiuntivi:', error);
        throw error;
    }
}

// Inizializzazione
window.addEventListener('load', function() {
    console.log('🚀 Admin panel caricato');
    
    try {
        // Carica configurazione
        loadConfiguration();
        
        // Collega pulsanti
        const saveButton = document.getElementById('save-button');
        const saveButtonBottom = document.getElementById('save-button-bottom');
        
        if (saveButton) {
            saveButton.addEventListener('click', saveConfiguration);
            console.log('✓ Pulsante save-button collegato');
        }
        
        if (saveButtonBottom) {
            saveButtonBottom.addEventListener('click', saveConfiguration);
            console.log('✓ Pulsante save-button-bottom collegato');
        }
        
        // Collega controlli logo
        const logoUploadInput = document.getElementById('admin-logo-upload');
        const resetLogoButton = document.getElementById('reset-logo-button');
        
        if (logoUploadInput) {
            logoUploadInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleLogoUpload(file);
                }
            });
            console.log('✓ Input logo upload collegato');
        }
        
        if (resetLogoButton) {
            resetLogoButton.addEventListener('click', resetLogo);
            console.log('✓ Pulsante reset logo collegato');
        }
        
        // Collega controlli badge
        syncColorInputs();
        
        const badgeTextInput = document.getElementById('admin-badge-text');
        const startingPriceInput = document.getElementById('admin-starting-price');
        
        if (badgeTextInput) {
            badgeTextInput.addEventListener('input', updateBadgePreview);
        }
        if (startingPriceInput) {
            startingPriceInput.addEventListener('input', updateBadgePreview);
        }
        
        // Aggiorna anteprima iniziale
        updateBadgePreview();
        
        // === INIZIALIZZAZIONE CONTROLLI SCONTO INSTAGRAM ===
        
        // Collega controlli sconto Instagram
        const discountEnabledCheckbox = document.getElementById('instagram-discount-enabled');
        const discountLabelInput = document.getElementById('admin-discount-label');
        const discountPercentageInput = document.getElementById('admin-discount-percentage');
        const basePriceInput = document.getElementById('admin-base-price');
        
        if (discountEnabledCheckbox) {
            discountEnabledCheckbox.addEventListener('change', function() {
                toggleDiscountSection();
                updateDiscountPreview();
            });
            console.log('✓ Checkbox abilita sconto collegato');
        }
        
        if (discountLabelInput) {
            discountLabelInput.addEventListener('input', updateDiscountPreview);
            console.log('✓ Input etichetta sconto collegato');
        }
        
        if (discountPercentageInput) {
            discountPercentageInput.addEventListener('input', updateDiscountPreview);
            console.log('✓ Input percentuale sconto collegato');
        }
        
        if (basePriceInput) {
            basePriceInput.addEventListener('input', updateDiscountPreview);
            console.log('✓ Input prezzo base collegato');
        }
        
        // Aggiorna anteprima sconto iniziale
        updateDiscountPreview();
        console.log('💰 Controlli sconto Instagram inizializzati');
        
        // === INIZIALIZZAZIONE CONTROLLI EMAIL E CTA ===
        
        // Collega controlli email
        const ctaButtonTextInput = document.getElementById('cta-button-text');
        const ctaSubtextInput = document.getElementById('cta-subtext');
        const autoReplyEnabledCheckbox = document.getElementById('enable-auto-reply');
        
        if (ctaButtonTextInput) {
            ctaButtonTextInput.addEventListener('input', updateCTAPreview);
            console.log('✓ Input testo CTA collegato');
        }
        
        if (ctaSubtextInput) {
            ctaSubtextInput.addEventListener('input', updateCTAPreview);
            console.log('✓ Input sottotesto CTA collegato');
        }
        
        if (autoReplyEnabledCheckbox) {
            autoReplyEnabledCheckbox.addEventListener('change', toggleAutoReplyConfig);
            console.log('✓ Checkbox risposta automatica collegato');
        }
        
        // Aggiorna anteprima CTA iniziale
        updateCTAPreview();
        console.log('📧 Controlli email e CTA inizializzati');
        
        // === INIZIALIZZAZIONE CALENDARIO PREZZI SETTIMANALI ===
        
        // Imposta il mese corrente (Maggio 2025 come da configurazione)
        const config = CatamaranStorage.load();
        if (config.calendar && config.calendar.defaultDate) {
            const defaultDate = new Date(config.calendar.defaultDate);
            currentCalendarMonth = defaultDate.getMonth() + 1;
            currentCalendarYear = defaultDate.getFullYear();
        } else {
            currentCalendarMonth = 5; // Maggio
            currentCalendarYear = 2025;
        }
        
        // Genera calendario iniziale
        generatePricingCalendar(currentCalendarMonth, currentCalendarYear);
        
        // Collega controlli navigazione calendario
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const calendarYearSelect = document.getElementById('calendar-year');
        
        if (prevMonthBtn) {
            prevMonthBtn.addEventListener('click', navigateToPreviousMonth);
            console.log('✓ Pulsante mese precedente collegato');
        }
        
        if (nextMonthBtn) {
            nextMonthBtn.addEventListener('click', navigateToNextMonth);
            console.log('✓ Pulsante mese successivo collegato');
        }
        
        if (calendarYearSelect) {
            calendarYearSelect.value = currentCalendarYear;
            calendarYearSelect.addEventListener('change', function() {
                changeCalendarYear(this.value);
            });
            console.log('✓ Selettore anno collegato');
        }
        
        // Collega editor settimana
        const closeEditorBtn = document.getElementById('close-editor');
        const saveWeekBtn = document.getElementById('save-week-price');
        
        if (closeEditorBtn) {
            closeEditorBtn.addEventListener('click', closeWeekEditor);
            console.log('✓ Pulsante chiudi editor collegato');
        }
        
        if (saveWeekBtn) {
            saveWeekBtn.addEventListener('click', saveWeekPrice);
            console.log('✓ Pulsante salva settimana collegato');
        }
        
        // Collega template stagionali
        const templateBtns = document.querySelectorAll('.template-btn');
        templateBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const price = parseInt(this.dataset.price);
                applySeasonalTemplate(price);
            });
        });
        console.log(`✓ ${templateBtns.length} template stagionali collegati`);
        
        // Collega input prezzo default
        const defaultPriceInput = document.getElementById('default-weekly-price');
        if (defaultPriceInput) {
            defaultPriceInput.addEventListener('change', updateDefaultPrice);
            console.log('✓ Input prezzo default collegato');
        }
        
        // Collega event listeners per servizi aggiuntivi
        // Skipper (ha ID specifici)
        const skipperInputs = ['skipper-price', 'skipper-name', 'skipper-description', 'skipper-unit', 'skipper-icon-input'];
        let serviceInputsFound = 0;
        
        skipperInputs.forEach(inputId => {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('input', function() {
                    // Auto-save per i servizi aggiuntivi - salva automaticamente quando si modifica un campo
                    const config = CatamaranStorage.load();
                    saveAdditionalServices(config);
                    CatamaranStorage.save(config);
                });
                serviceInputsFound++;
            }
        });
        
        // Altri servizi (usano classi generiche)
        const serviceClassInputs = document.querySelectorAll('.service-name, .service-price, .service-unit, .service-description, .service-icon-input, .service-enabled');
        serviceClassInputs.forEach(input => {
            input.addEventListener('input', function() {
                // Auto-save per i servizi aggiuntivi - salva automaticamente quando si modifica un campo
                const config = CatamaranStorage.load();
                saveAdditionalServices(config);
                CatamaranStorage.save(config);
            });
            serviceInputsFound++;
        });
        
        console.log(`✓ ${serviceInputsFound} campi servizi aggiuntivi collegati con auto-save`);
        
        console.log('📅 Calendario prezzi settimanali inizializzato');
        console.log('✅ Inizializzazione completata');
        
    } catch (error) {
        console.error('❌ Errore inizializzazione:', error);
    }
});
</script>

</body>
</html>