<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔗 Test Integrazione Fase 3 - Admin → Prenotazione</title>
    <script src="catamaran-config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-ok { color: #4caf50; font-weight: bold; }
        .test-error { color: #f44336; font-weight: bold; }
        .test-warning { color: #ff9800; font-weight: bold; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #ffeaea; border-color: #f44336; }
        .warning { background: #fff8e1; border-color: #ff9800; }
        pre { background: #f8f8f8; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto; }
        button { background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976D2; }
        .step { margin: 10px 0; padding: 10px; border-left: 4px solid #2196f3; background: #f9f9f9; }
    </style>
</head>
<body>

<div class="container">
    <h1>🔗 Test Integrazione Fase 3 - Admin ↔ Prenotazione</h1>
    
    <div class="test-section">
        <h2>📋 Obiettivo del Test</h2>
        <p>Verificare che le modifiche ai campi Fase 3 nell'admin panel vengano correttamente visualizzate nella pagina prenotazione.</p>
        <div class="step">
            <strong>1.</strong> Simula modifiche admin (immagini, descrizione, caratteristiche, dotazioni)
        </div>
        <div class="step">
            <strong>2.</strong> Salva configurazione con i nuovi dati
        </div>
        <div class="step">
            <strong>3.</strong> Simula caricamento pagina prenotazione
        </div>
        <div class="step">
            <strong>4.</strong> Verifica che i contenuti siano aggiornati correttamente
        </div>
        <button onclick="runIntegrationTest()">▶️ Avvia Test Integrazione</button>
    </div>

    <div id="test-results" class="test-section">
        <h2>📊 Risultati Test</h2>
        <div id="results-content">Clicca "Avvia Test" per iniziare...</div>
    </div>

    <div id="config-display" class="test-section">
        <h2>🔧 Configurazione Salvata</h2>
        <pre id="config-content">...</pre>
    </div>
</div>

<script>
function runIntegrationTest() {
    console.log('🔗 Avviando test integrazione Fase 3...');
    
    try {
        // STEP 1: Simula modifiche admin
        const config = CatamaranStorage.load();
        
        const testData = {
            images: {
                main: 'https://test-image-main-' + Date.now() + '.jpg',
                summary: 'https://test-image-summary-' + Date.now() + '.jpg'
            },
            description: `Violante TEST INTEGRAZIONE - Modificato alle ${new Date().toLocaleTimeString()}.
            
Questo è un test per verificare che le modifiche dall'admin panel vengano recepite nella pagina di prenotazione.

Le caratteristiche e dotazioni sono state aggiornate dinamicamente dall'admin panel.`,
            
            mainFeatures: [
                "✅ Caratteristica TEST 1 - Aggiunta dall'admin",
                "✅ Caratteristica TEST 2 - Modificata alle " + new Date().toLocaleTimeString(),
                "✅ Caratteristica TEST 3 - Integrazione Fase 3",
                "✅ Caratteristica TEST 4 - Admin → Prenotazione",
                "✅ Caratteristica TEST 5 - Funzionante!"
            ],
            
            includedEquipment: [
                "🔧 Dotazione TEST 1 - Aggiunta dall'admin",
                "🔧 Dotazione TEST 2 - Modificata alle " + new Date().toLocaleTimeString(),
                "🔧 Dotazione TEST 3 - Integrazione Fase 3",
                "🔧 Dotazione TEST 4 - Admin → Prenotazione",
                "🔧 Dotazione TEST 5 - Sync funzionante",
                "🔧 Dotazione TEST 6 - Tutti i campi integrati!"
            ]
        };
        
        // STEP 2: Applica le modifiche alla configurazione
        config.images = testData.images;
        config.description = testData.description;
        config.mainFeatures = testData.mainFeatures;
        config.includedEquipment = testData.includedEquipment;
        
        // STEP 3: Salva la configurazione
        const saveResult = CatamaranStorage.save(config);
        
        if (!saveResult) {
            throw new Error('Errore nel salvataggio della configurazione');
        }
        
        // STEP 4: Verifica ricaricamento
        const reloadedConfig = CatamaranStorage.load();
        
        // STEP 5: Testa sincronizzazione
        const syncTests = {
            imagesSynced: reloadedConfig.images.main === testData.images.main,
            descriptionSynced: reloadedConfig.description === testData.description,
            featuresSynced: JSON.stringify(reloadedConfig.mainFeatures) === JSON.stringify(testData.mainFeatures),
            equipmentSynced: JSON.stringify(reloadedConfig.includedEquipment) === JSON.stringify(testData.includedEquipment)
        };
        
        const passedTests = Object.values(syncTests).filter(Boolean).length;
        const totalTests = Object.keys(syncTests).length;
        const success = passedTests === totalTests;
        
        // STEP 6: Mostra risultati
        const resultsDiv = document.getElementById('results-content');
        const configDiv = document.getElementById('config-content');
        const testSection = document.getElementById('test-results');
        
        if (success) {
            testSection.className = 'test-section success';
            resultsDiv.innerHTML = `
                <div class="test-ok">✅ INTEGRAZIONE FASE 3 FUNZIONANTE!</div>
                <p><strong>Test superati: ${passedTests}/${totalTests}</strong></p>
                <div style="margin-top: 15px;">
                    <strong>Dettagli Sincronizzazione:</strong><br>
                    🖼️ Immagini: ${syncTests.imagesSynced ? '✅' : '❌'}<br>
                    📝 Descrizione: ${syncTests.descriptionSynced ? '✅' : '❌'}<br>
                    🔧 Caratteristiche (${testData.mainFeatures.length}): ${syncTests.featuresSynced ? '✅' : '❌'}<br>
                    🛠️ Dotazioni (${testData.includedEquipment.length}): ${syncTests.equipmentSynced ? '✅' : '❌'}
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 4px;">
                    <strong>🎉 I campi Fase 3 sono completamente integrati!</strong><br>
                    Le modifiche nell'admin panel verranno ora visualizzate correttamente nella pagina di prenotazione.
                </div>
            `;
        } else {
            testSection.className = 'test-section error';
            resultsDiv.innerHTML = `
                <div class="test-error">❌ PROBLEMI INTEGRAZIONE</div>
                <p><strong>Test superati: ${passedTests}/${totalTests}</strong></p>
                <div style="margin-top: 15px;">
                    <strong>Dettagli Problemi:</strong><br>
                    🖼️ Immagini: ${syncTests.imagesSynced ? '✅' : '❌'}<br>
                    📝 Descrizione: ${syncTests.descriptionSynced ? '✅' : '❌'}<br>
                    🔧 Caratteristiche: ${syncTests.featuresSynced ? '✅' : '❌'}<br>
                    🛠️ Dotazioni: ${syncTests.equipmentSynced ? '✅' : '❌'}
                </div>
            `;
        }
        
        // Mostra configurazione salvata
        configDiv.textContent = JSON.stringify({
            fase3Fields: {
                images: reloadedConfig.images,
                description: reloadedConfig.description?.substring(0, 100) + '...',
                mainFeaturesCount: reloadedConfig.mainFeatures?.length,
                equipmentCount: reloadedConfig.includedEquipment?.length
            },
            syncResults: syncTests,
            timestamp: new Date().toLocaleString('it-IT')
        }, null, 2);
        
        console.log('✅ Test integrazione completato:', {
            success,
            passedTests,
            totalTests,
            syncTests
        });
        
    } catch (error) {
        console.error('❌ Errore test integrazione:', error);
        const resultsDiv = document.getElementById('results-content');
        const testSection = document.getElementById('test-results');
        
        testSection.className = 'test-section error';
        resultsDiv.innerHTML = `
            <div class="test-error">❌ ERRORE TEST INTEGRAZIONE</div>
            <p><strong>Errore:</strong> ${error.message}</p>
            <p>Controlla la console del browser per maggiori dettagli.</p>
        `;
    }
}

// Auto-start dopo caricamento pagina
window.addEventListener('load', function() {
    console.log('🔗 Test integrazione Fase 3 pronto');
    setTimeout(() => {
        document.getElementById('results-content').innerHTML = `
            <p>Test pronto per verificare l'integrazione dei campi Fase 3.</p>
            <p><strong>Campi da testare:</strong></p>
            <ul>
                <li>🖼️ Immagine principale del catamarano</li>
                <li>📝 Descrizione del catamarano</li>
                <li>🔧 Caratteristiche principali (lista dinamica)</li>
                <li>🛠️ Dotazioni incluse (lista dinamica)</li>
            </ul>
        `;
    }, 500);
});
</script>

</body>
</html>