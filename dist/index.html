<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prenota il tuo Catamarano - Elite Escape</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#0a5c8f',secondary:'#f8b400'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="catamaran-config.js"></script>
<script src="supabase-client.js"></script>
<script src="storage-wrapper.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<!-- üö® SOLUZIONE IMMEDIATA LOADING SCREEN - BYPASS TOTALE -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.warn('üö® ATTIVANDO BYPASS LOADING SCREEN');
    
    // Timeout di emergenza di 1 secondo - rimuove loading screen indipendentemente da tutto
    setTimeout(() => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            console.warn('üî• RIMOZIONE FORZATA LOADING SCREEN');
            loadingScreen.style.display = 'none !important';
            loadingScreen.style.visibility = 'hidden !important';
            loadingScreen.style.opacity = '0 !important';
            loadingScreen.style.zIndex = '-9999 !important';
            loadingScreen.remove();
            
            // Mostra contenuto principale
            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.style.visibility = 'visible !important';
                mainContent.style.opacity = '1 !important';
                mainContent.style.display = 'block !important';
            }
            
            // Mostra body se nascosto
            document.body.style.visibility = 'visible';
            document.body.style.opacity = '1';
        }
    }, 1000);
    
    // Timeout aggressivo di 500ms per test immediato
    setTimeout(() => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            console.warn('‚ö° RIMOZIONE ULTRA-RAPIDA LOADING SCREEN');
            loadingScreen.remove();
        }
        
        // üö® FORZA VISUALIZZAZIONE DI TUTTO
        console.warn('üî• FORZANDO VISUALIZZAZIONE COMPLETA PAGINA');
        
        // Rimuovi content-hidden da tutti gli elementi
        document.querySelectorAll('.content-hidden').forEach(el => {
            el.classList.remove('content-hidden');
            el.classList.add('content-visible');
            el.style.visibility = 'visible !important';
            el.style.opacity = '1 !important';
            el.style.display = 'block !important';
        });
        
        // Forza visualizzazione main-content
        const mainContent = document.getElementById('main-content');
        if (mainContent) {
            mainContent.style.visibility = 'visible !important';
            mainContent.style.opacity = '1 !important';
            mainContent.style.display = 'block !important';
            mainContent.classList.remove('content-hidden');
            mainContent.classList.add('content-visible');
        }
        
        // Forza visualizzazione body e html
        document.body.style.visibility = 'visible !important';
        document.body.style.opacity = '1 !important';
        document.documentElement.style.visibility = 'visible !important';
        
        // Rimuovi tutti gli stili che potrebbero nascondere il contenuto
        const allElements = document.querySelectorAll('*');
        allElements.forEach(el => {
            const computed = window.getComputedStyle(el);
            if (computed.display === 'none' && el.id !== 'loading-screen') {
                el.style.display = 'block !important';
            }
        });
        
    }, 500);
});
</script>
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }

/* === LOADING SCREEN === */
#loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0a5c8f 0%, #1e3a8a 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    
    /* üö® AUTO-NASCONDIMENTO CSS DOPO 3 SECONDI */
    animation: autoHide 3s forwards;
}

/* === PREVENZIONE FLASH CONTENUTO DEFAULT === */
.price-loading {
    opacity: 0 !important;
    transition: opacity 0.3s ease-in-out;
}

.price-loaded {
    opacity: 1 !important;
}

/* Nasconde elementi specifici che causano flash */
#badge-price, #base-price, #skipper-price, 
#catamaran-name, #catamaran-year, #catamaran-length, 
#catamaran-cabins, #catamaran-bathrooms, #catamaran-guests {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

/* Classe per mostrare elementi dopo caricamento config */
.config-loaded {
    opacity: 1 !important;
}

@keyframes autoHide {
    0%, 90% { 
        opacity: 1; 
        visibility: visible; 
    }
    100% { 
        opacity: 0; 
        visibility: hidden; 
        display: none !important;
    }
}

#loading-screen.hidden {
    opacity: 0;
    visibility: hidden;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #f8b400;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1.5rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-logo {
    color: white;
    font-family: 'Pacifico', cursive;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    opacity: 0.9;
}

.loading-text {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    text-align: center;
    max-width: 280px;
}

.loading-dots {
    display: inline-block;
    width: 20px;
}

.loading-dots::after {
    content: '';
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    80%, 100% { content: '...'; }
}

/* Nasconde contenuto principale durante loading */
.content-hidden {
    visibility: hidden;
    opacity: 0;
}

.content-visible {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.3s ease-in;
}

/* üö® FORZA VISUALIZZAZIONE CONTENUTO DOPO 2 SECONDI */
#main-content {
    animation: forceShow 2s forwards;
}

@keyframes forceShow {
    0%, 60% { 
        /* Mantieni stato iniziale per i primi 1.2 secondi */
    }
    100% { 
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
    }
}

/* üö® FALLBACK GLOBALE - FORZA TUTTO VISIBILE DOPO 3 SECONDI */
body {
    animation: globalForceShow 3s forwards;
}

@keyframes globalForceShow {
    0%, 80% { 
        /* Mantieni per i primi 2.4 secondi */
    }
    100% { 
        visibility: visible !important;
        opacity: 1 !important;
    }
}

/* Assicurati che questi elementi siano sempre visibili dopo 3 secondi */
body > *:not(#loading-screen) {
    animation: elementForceShow 3s forwards;
}

@keyframes elementForceShow {
    0%, 80% { 
        /* Aspetta */
    }
    100% { 
        visibility: visible !important;
        opacity: 1 !important;
        display: block !important;
    }
}
@media (max-width: 768px) {
.container {
padding-left: 1rem;
padding-right: 1rem;
}
main {
padding-top: 5rem;
}
h1 {
font-size: 1.875rem;
line-height: 2.25rem;
}
.swiper-container {
height: 240px;
}
.custom-checkbox, .custom-radio {
margin-bottom: 0.5rem;
}
input, select, textarea {
font-size: 16px;
}
}
body {
font-family: 'Raleway', sans-serif;
}
h1, h2, h3, h4, h5, h6 {
font-family: 'Playfair Display', serif;
}
input[type="date"]::-webkit-calendar-picker-indicator {
filter: invert(0.5);
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
.custom-checkbox {
position: relative;
padding-left: 28px;
cursor: pointer;
user-select: none;
}
.custom-checkbox input {
position: absolute;
opacity: 0;
cursor: pointer;
}
.checkmark {
position: absolute;
top: 0;
left: 0;
height: 20px;
width: 20px;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 4px;
}
.custom-checkbox:hover input ~ .checkmark {
background-color: #f0f9ff;
}
.custom-checkbox input:checked ~ .checkmark {
background-color: #0a5c8f;
border-color: #0a5c8f;
}
.checkmark:after {
content: "";
position: absolute;
display: none;
}
.custom-checkbox input:checked ~ .checkmark:after {
display: block;
}
.custom-checkbox .checkmark:after {
left: 7px;
top: 3px;
width: 6px;
height: 11px;
border: solid white;
border-width: 0 2px 2px 0;
transform: rotate(45deg);
}
.progress-step {
position: relative;
}
.progress-step:not(:last-child)::after {
content: "";
position: absolute;
top: 50%;
right: -50%;
transform: translate(0, -50%);
width: 100%;
height: 2px;
background-color: #e5e7eb;
z-index: 0;
}
.progress-step.active:not(:last-child)::after {
background-color: #0a5c8f;
}
.custom-radio {
position: relative;
padding-left: 28px;
cursor: pointer;
user-select: none;
}
.custom-radio input {
position: absolute;
opacity: 0;
cursor: pointer;
}
.radio-mark {
position: absolute;
top: 0;
left: 0;
height: 20px;
width: 20px;
background-color: #fff;
border: 1px solid #ddd;
border-radius: 50%;
}
.custom-radio:hover input ~ .radio-mark {
background-color: #f0f9ff;
}
.custom-radio input:checked ~ .radio-mark {
background-color: #fff;
border-color: #0a5c8f;
}
.radio-mark:after {
content: "";
position: absolute;
display: none;
top: 4px;
left: 4px;
width: 10px;
height: 10px;
border-radius: 50%;
background: #0a5c8f;
}
.custom-radio input:checked ~ .radio-mark:after {
display: block;
}
.custom-switch {
position: relative;
display: inline-block;
width: 50px;
height: 24px;
}
.custom-switch input {
opacity: 0;
width: 0;
height: 0;
}
.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: .4s;
border-radius: 24px;
}
.slider:before {
position: absolute;
content: "";
height: 16px;
width: 16px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
border-radius: 50%;
}
input:checked + .slider {
background-color: #0a5c8f;
}
input:checked + .slider:before {
transform: translateX(26px);
}
</style>

<!-- SSG Build Info -->
<meta name="ssg-build-time" content="2025-07-06T10:44:50.120Z">
<meta name="ssg-config-version" content="1751793614329">
<meta name="ssg-generator" content="Elite Escape SSG v1.0">

<!-- Enhanced SEO with dynamic content -->
<meta name="description" content="Prenota Violante - Catamarano 11.8m per vacanze in Sardegna. 4 cabine, a partire da ‚Ç¨2.999.">
<meta property="og:title" content="Prenota il tuo Catamarano - Elite Escape">
<meta property="og:description" content="Catamarano Violante per vacanze indimenticabili in Sardegna. Prenota ora!">
<meta property="og:type" content="website">
</head>
<body class="bg-gray-50">

<!-- Loading Screen -->
<div id="loading-screen">
    <div class="loading-spinner"></div>
    <div class="loading-logo">Elite Escape</div>
    <div class="loading-text">
        Caricamento configurazione<span class="loading-dots"></span>
    </div>
</div>

<!-- Main Content (nascosto inizialmente) -->
<div id="main-content" class="content-hidden">

<!-- Header -->
<header class="fixed top-0 left-0 right-0 bg-white shadow-md z-50">
<div class="container mx-auto px-4 py-3 flex items-center justify-between">
<div class="flex items-center">
<a href="#" id="site-logo" class="text-3xl font-['Pacifico'] text-primary">logo</a>
<div class="flex items-center">
<div class="w-10 h-10 flex items-center justify-center md:hidden cursor-pointer">
<i class="ri-menu-line ri-lg"></i>
</div>
</div>
</div>
</header>
<!-- Main Content -->
<main class="container mx-auto px-4 pt-24 pb-8">
<div class="flex flex-col gap-8">
<!-- Left Column - Catamaran Details -->
<div class="w-full">
<h1 id="page-main-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">Prenota il tuo Catamarano</h1>
<!-- Catamaran Card -->
<div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
<div class="relative">
<div class="swiper-container h-80">
<img id="catamaran-main-image" src="https://readdy.ai/api/search-image?query=luxury%2520catamaran%2520Fountaine%2520Pajot%252045%2520sailing%2520in%2520crystal%2520clear%2520turquoise%2520waters%2520near%2520Sardinia%2520coast%252C%2520Italy.%2520The%2520catamaran%2520is%2520white%2520with%2520elegant%2520lines%252C%2520spacious%2520deck%2520and%2520modern%2520design.%2520Beautiful%2520coastal%2520scenery%2520with%2520rocky%2520cliffs%2520and%2520sandy%2520beaches%2520visible%2520in%2520the%2520background.%2520Bright%2520sunny%2520day%2520with%2520deep%2520blue%2520sky.&width=1200&height=600&seq=10001&orientation=landscape" alt="Fountaine Pajot 45" class="w-full h-full object-cover object-top">
</div>

<!-- Badge Prezzo di Partenza -->
<div id="price-badge" class="absolute top-4 right-4 px-4 py-2 rounded-full text-sm font-semibold shadow-lg flex flex-col items-center min-w-[120px]" style="background-color: #f8b400; color: #ffffff;">
<span id="badge-text" class="text-xs mb-1">A partire da</span>
<span id="badge-price" class="text-lg font-bold">‚Ç¨2.999</span>
</div>

<div class="absolute bottom-4 right-4 bg-white bg-opacity-90 px-3 py-1 rounded-full text-sm font-medium text-primary flex items-center">
<span class="w-4 h-4 flex items-center justify-center mr-1">
<i class="ri-image-line"></i>
</span>
Altre foto
</div>
</div>
<div class="p-6">
<div class="mb-4">
<h2 class="text-2xl font-bold text-gray-900" id="catamaran-name">Bali Catsmart - Violante</h2>
</div>
<!-- üîß Caratteristiche Tecniche (grid responsivo 2-3-4 colonne) -->
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
<!-- Anno -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-ship-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-year">Anno 2025</span>
</div>

<!-- Lunghezza -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-ruler-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-length">13,61 m</span>
</div>

<!-- Cabine -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-hotel-bed-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-cabins">4 cabine +1 skipper</span>
</div>

<!-- Bagni -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-drop-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-bathrooms">4 bagni +1 skipper</span>
</div>

<!-- üÜï Larghezza (NUOVO) -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-expand-width-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-width">7,32 m larghezza</span>
</div>

<!-- üÜï Pescaggio (NUOVO) -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-anchor-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-draft">1,15 m pescaggio</span>
</div>

<!-- üÜï Potenza Motori -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-settings-4-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-engine">60 HP</span>
</div>

<!-- üÜï Dislocamento (NUOVO) -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-scales-3-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-displacement">11,2 t dislocamento</span>
</div>

<!-- üÜï Serbatoio Acqua (NUOVO) -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-water-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-water-tank">400 L acqua</span>
</div>

<!-- üÜï Serbatoio Gasolio (NUOVO) -->
<div class="flex flex-col items-center p-3 bg-gray-50 rounded-lg">
<div class="w-8 h-8 flex items-center justify-center text-primary mb-2">
<i class="ri-gas-station-line ri-lg"></i>
</div>
<span class="text-sm font-medium text-gray-900" id="catamaran-fuel-tank">150 L gasolio</span>
</div>
</div>
<div class="border-t border-gray-200 pt-6">
<h3 class="text-lg font-semibold text-gray-900 mb-3">Descrizione</h3>
<p id="catamaran-description" class="text-gray-600 mb-4">Violante √® il nostro Bali Catsmart, varato nel 2025, pensato per vivere il mare in modo confortevole e autentico. Ogni mattina pu√≤ iniziare in una caletta tranquilla, con il comfort di casa a portata di mano.
La dinette si apre sul pozzetto grazie a un portellone posteriore, creando uno spazio conviviale unico. A prua, un prendisole con tavolino sostituisce la classica rete, ideale per aperitivi e relax.
Grazie al dissalatore da 200 litri/ora e all‚Äôenergia garantita da pannelli solari e batterie a 220V, Violante offre piena autonomia. Il tender da 6 posti con motore da 9 cavalli consente di raggiungere facilmente la costa.
Senza fly bridge, la randa pi√π ampia garantisce prestazioni a vela superiori. Navigare con Violante √® silenzioso, sostenibile e in armonia con la natura.
Salpa e vivi il mare con uno spirito libero e consapevole.</p>
<div class="grid grid-cols-1 gap-4">
<div>
<h4 class="font-medium text-gray-900 mb-2">Caratteristiche principali:</h4>
<ul id="main-features-list" class="space-y-1">
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">4 cabine doppie per gli ospiti ed una cabina aggiuntiva per lo skipper</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Cucina attrezzata e ampia dinette con portellone apribile</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Piena autonomia: nessuna necessit√† di sosta per acqua, carburante ed energia elettrica</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Ampio prendisole a prua al posto della rete, con tavolino per aperitivi indimenticabili</span>
</li>
</ul>
</div>
<div>
<h4 class="font-medium text-gray-900 mb-2">Dotazioni incluse:</h4>
<ul id="included-equipment-list" class="space-y-1">
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Tender 8 posti con motore fuoribordo da 9hp</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Dissalatore per acqua dolce da 200 l/h</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Casse acustiche bluetooth di alta qualit√†</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Pannelli solari e pacco batterie</span>
</li>
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
<i class="ri-check-line"></i>
</div>
<span class="text-gray-700">Barbecue a gas</span>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<!-- Date and Guests Section -->
<div class="bg-white rounded-lg shadow-lg p-6 mb-8">
<h3 class="text-xl font-semibold text-gray-900 mb-4">Date e Ospiti</h3>
<div class="mb-6">
<div class="flex justify-between items-center mb-4">
<h4 class="text-sm font-medium text-gray-700">Seleziona la settimana</h4>
<div class="flex space-x-2">
<button id="prevMonth" class="p-2 hover:bg-gray-100 rounded-full">
<i class="ri-arrow-left-s-line"></i>
</button>
<span id="currentMonth" class="text-sm font-medium py-2"></span>
<button id="nextMonth" class="p-2 hover:bg-gray-100 rounded-full">
<i class="ri-arrow-right-s-line"></i>
</button>
</div>
</div>
<div class="border border-gray-200 rounded-lg overflow-hidden">
<div class="grid grid-cols-7 text-center border-b border-gray-200">
<div class="py-2 text-xs font-medium text-gray-500">Dom</div>
<div class="py-2 text-xs font-medium text-gray-500">Lun</div>
<div class="py-2 text-xs font-medium text-gray-500">Mar</div>
<div class="py-2 text-xs font-medium text-gray-500">Mer</div>
<div class="py-2 text-xs font-medium text-gray-500">Gio</div>
<div class="py-2 text-xs font-medium text-gray-500">Ven</div>
<div class="py-2 text-xs font-medium text-gray-500">Sab</div>
</div>
<div id="calendarDays" class="grid grid-cols-7"></div>
</div>
<div class="mt-4 flex items-center justify-between text-sm text-gray-600">
<div>
<span id="selectedWeek">Nessuna settimana selezionata</span>
<p class="text-xs text-gray-500 mt-1" id="boardingTimes">Check-in: Sabato ore 16:00 | Check-out: Sabato ore 10:00</p>
</div>
<button id="clearSelection" class="text-primary hover:underline hidden">Cancella selezione</button>
</div>
</div>
<div class="mb-6">
<label class="block text-sm font-medium text-gray-700 mb-2">Numero di ospiti</label>
<div class="flex items-center">
<button class="w-10 h-10 flex items-center justify-center border border-gray-300 rounded-l bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" id="decreaseGuests">
<i class="ri-subtract-line"></i>
</button>
<input type="number" id="guestsCount" min="1" max="8" value="6" class="w-16 h-10 border-y border-gray-300 text-center focus:outline-none text-gray-700">
<button class="w-10 h-10 flex items-center justify-center border border-gray-300 rounded-r bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" id="increaseGuests">
<i class="ri-add-line"></i>
</button>
<span class="ml-3 text-sm text-gray-500">Massimo 8 ospiti</span>
</div>
</div>

<!-- Prezzo Base (visibile solo quando √® selezionata una settimana) -->
<div id="week-price-section" class="mt-6 p-4 bg-primary bg-opacity-5 rounded-lg border-l-4 border-primary hidden">
<div class="flex justify-between items-center">
<div>
<span class="text-sm text-gray-700">Prezzo base per questa settimana</span>
<p class="text-xs text-gray-500 mt-1" id="week-details">7 giorni selezionati</p>
<p class="text-xs text-primary font-medium mt-1" id="week-note"></p>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-primary" id="base-price">‚Ç¨ 3,499</p>
<span class="text-gray-600 text-xs">per settimana</span>
</div>
</div>
</div>

</div>
<!-- Additional Services -->
<div class="bg-white rounded-lg shadow-lg p-6 mb-8">
<h3 class="text-xl font-semibold text-gray-900 mb-4">Servizi Aggiuntivi</h3>
<div class="border-2 border-primary rounded-lg p-4 hover:bg-primary hover:bg-opacity-5 transition-colors mb-6">
<div class="flex justify-between items-start mb-3">
<div class="flex items-start">
<div class="w-10 h-10 flex items-center justify-center bg-primary bg-opacity-10 rounded-full text-primary mr-3">
<i class="ri-steering-2-line"></i>
</div>
<div>
<h4 class="font-medium text-gray-900">Skipper Professionale</h4>
<p class="text-sm text-gray-600" id="skipper-price">‚Ç¨200/giorno</p>
</div>
</div>
<label class="custom-switch">
<input type="checkbox" class="service-checkbox" data-price="200" data-name="Skipper">
<span class="slider"></span>
</label>
</div>
<p class="text-sm text-gray-600">Affidati a un capitano professionista che si occuper√† della navigazione e ti guider√† alla scoperta delle baie pi√π belle e suggestive. Con il servizio skipper, la cauzione passa da ‚Ç¨3.500 a ‚Ç¨1.500.</p>
<div class="mt-3 pt-3 border-t border-gray-100">
<p class="text-sm font-medium text-primary flex items-center">
<i class="ri-thumb-up-line mr-2"></i>
Raccomandato per chi ha poca esperienza di navigazione nelle acque della Sardegna e vuole godersi la vacanza senza preoccupazioni
</p>
</div>
</div>
<div id="additional-services-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- I servizi verranno generati dinamicamente -->
</div>
</div>
</div>
<!-- Right Column - Booking Summary -->
<div class="w-full">
<div class="bg-white rounded-lg shadow-lg p-6">
<h3 class="text-xl font-semibold text-gray-900 mb-4">Riepilogo Prenotazione</h3>
<div class="flex items-center mb-4 pb-4 border-b border-gray-200">
<img src="https://readdy.ai/api/search-image?query=luxury%2520catamaran%2520Fountaine%2520Pajot%252045%2520sailing%2520in%2520crystal%2520clear%2520turquoise%2520waters%252C%2520close-up%2520view%2520of%2520the%2520elegant%2520white%2520hull%2520and%2520modern%2520design.%2520Professional%2520product%2520photography%2520with%2520clean%2520background.&width=100&height=100&seq=20001&orientation=squarish" alt="Fountaine Pajot 45" class="w-16 h-16 object-cover rounded-md mr-3">
<div>
<h4 class="font-medium text-gray-900">Bali Catsmart "Violante"</h4>
<p class="text-sm text-gray-600">Cagliari, Sardegna</p>
</div>
</div>
<div class="space-y-3 mb-6">
<div class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3 mt-0.5">
<i class="ri-calendar-line"></i>
</div>
<div>
<p class="text-sm font-medium text-gray-900">Date</p>
<p class="text-sm text-gray-600" id="booking-dates">23 Maggio - 30 Maggio 2025</p>
</div>
</div>
<div class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3 mt-0.5">
<i class="ri-time-line"></i>
</div>
<div>
<p class="text-sm font-medium text-gray-900">Durata</p>
<p class="text-sm text-gray-600">7 giorni</p>
</div>
</div>
<div class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3 mt-0.5">
<i class="ri-user-line"></i>
</div>
<div>
<p class="text-sm font-medium text-gray-900">Ospiti</p>
<p class="text-sm text-gray-600" id="booking-guests">6 persone</p>
</div>
</div>
<div class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3 mt-0.5">
<i class="ri-map-pin-line"></i>
</div>
<div>
<p class="text-sm font-medium text-gray-900">Partenza</p>
<p class="text-sm text-gray-600">Cagliari, ore 16:00</p>
</div>
</div>
</div>
<div class="border-t border-gray-200 pt-4 mb-6">
<h4 class="font-medium text-gray-900 mb-4">Riepilogo Costi</h4>
<div class="space-y-2">
<div class="flex justify-between">
<span class="text-gray-600">Prezzo base per questa settimana (7 giorni)</span>
<span class="font-medium" id="summary-base-price">‚Ç¨ 3,499</span>
</div>
<div id="instagram-discount-section" class="flex justify-between text-green-600">
<span id="discount-label">Sconto Instagram -10%</span>
<span id="discount-amount">-‚Ç¨ 349,90</span>
</div>
<div class="bg-gray-50 p-4 rounded-lg">
<div class="mb-4">
<h5 class="text-gray-700 font-medium mb-4">Servizi obbligatori</h5>
</div>
<div class="space-y-4 text-sm text-gray-600">
<div>
<div class="flex justify-between items-start mb-2">
<span class="font-medium">Pacchetto Charter obbligatorio:</span>
<span class="font-medium">‚Ç¨ <span id="charter-detail-price">400</span></span>
</div>
<ul class="list-disc ml-4 space-y-1 text-xs">
<li>Pulizie finali</li>
<li>Tender + motore fuoribordo</li>
<li>Bombola del gas</li>
</ul>
</div>
<div>
<div class="flex justify-between items-start mb-2">
<span class="font-medium">Pacchetto carburante no-stress:</span>
<span class="font-medium">‚Ç¨ <span id="fuel-detail-price">350</span></span>
</div>
<ul class="list-disc ml-4 space-y-1 text-xs">
<li>Nessun obbligo di pieno al rientro, nessuna coda al distributore</li>
<li>Goditi la vacanza fino all'ultimo secondo</li>
<li>Rifornimento gratuito illimitato al distributore convenzionato in porto</li>
</ul>
</div>
<div>
<div class="flex justify-between items-start mb-2">
<span class="font-medium">Pacchetto Toilette:</span>
<span class="font-medium">‚Ç¨ <span id="linens-detail-price">120</span></span>
</div>
<ul class="list-disc ml-4 space-y-1 text-xs">
<li>Lenzuola e salviette toilette (‚Ç¨20 a persona)</li>
</ul>
</div>
</div>
<div class="border-t border-gray-300 mt-4 pt-3">
<div class="flex justify-between items-center">
<span class="font-semibold text-gray-700">TOTALE SERVIZI OBBLIGATORI:</span>
<span class="font-semibold text-gray-700" id="mandatory-services-total">‚Ç¨ 870</span>
</div>
</div>
</div>
<div class="bg-gray-50 p-4 rounded-lg" id="services-total-container" style="display: none;">
<div class="mb-4">
<h5 class="text-gray-700 font-medium mb-4">Servizi aggiuntivi</h5>
</div>
<div class="space-y-4 text-sm text-gray-600" id="selected-services-list">
<!-- Servizi selezionati verranno inseriti qui dinamicamente -->
</div>
<div class="border-t border-gray-300 mt-4 pt-3">
<div class="flex justify-between items-center">
<span class="font-semibold text-gray-700">TOTALE SERVIZI AGGIUNTIVI:</span>
<span class="font-semibold text-gray-700" id="services-total">‚Ç¨0</span>
</div>
</div>
</div>
<div class="flex justify-between pt-3 border-t border-gray-200 font-semibold text-lg">
<span>Totale</span>
<span class="text-primary" id="total-price">‚Ç¨7.340</span>
</div>
</div>
</div>
<script>
// === SISTEMA INVIO EMAIL E GESTIONE CTA ===

// Inizializza EmailJS e configura interfaccia
document.addEventListener('DOMContentLoaded', function() {
    initializeEmailSystem();
});

function initializeEmailSystem() {
    try {
        console.log('üöÄ Inizializzando sistema email...');
        
        // Carica configurazione
        const config = CatamaranStorage.load();
        
        // Aggiorna testi CTA dalla configurazione
        updateCTATexts(config);
        
        // Inizializza EmailJS se configurato
        if (config.email && config.email.enabled && config.email.emailjs.publicKey) {
            emailjs.init(config.email.emailjs.publicKey);
            console.log('‚úì EmailJS inizializzato');
        }
        
        // Setup controlli form
        setupFormControls();
        
        console.log('‚úÖ Sistema email inizializzato con successo');
        
    } catch (error) {
        console.error('‚ùå Errore inizializzazione sistema email:', error);
    }
}

function updateCTATexts(config) {
    const buttonText = document.getElementById('booking-button-text');
    const subtext = document.getElementById('booking-subtext');
    
    if (buttonText && config.ui && config.ui.bookingButton) {
        buttonText.textContent = config.ui.bookingButton;
    }
    
    if (subtext && config.ui && config.ui.bookingSubtext) {
        subtext.textContent = config.ui.bookingSubtext;
    }
    
    console.log('üîÑ Testi CTA aggiornati dalla configurazione');
}

function setupFormControls() {
    const termsCheckbox = document.getElementById('terms-checkbox');
    const submitButton = document.getElementById('submit-booking');
    
    if (!termsCheckbox || !submitButton) {
        console.error('‚ùå Elementi form non trovati');
        return;
    }
    
    // Gestione abilitazione pulsante
    termsCheckbox.addEventListener('change', function() {
        if (this.checked) {
            submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            submitButton.disabled = false;
        } else {
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            submitButton.disabled = true;
        }
    });
    
    // Gestione click submit
    submitButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        if (!termsCheckbox.checked) {
            showNotification('Devi accettare i termini e condizioni per procedere', 'error');
            return;
        }
        
        handleBookingSubmit();
    });
    
    console.log('‚úì Controlli form configurati');
}

async function handleBookingSubmit() {
    const config = CatamaranStorage.load();
    
    try {
        // Controlla se il sistema email √® abilitato
        if (!config.email || !config.email.enabled) {
            showNotification('Sistema di invio email non configurato', 'error');
            return;
        }
        
        // Mostra loading
        showSubmitLoading(true);
        
        // Raccogli dati
        const bookingData = collectBookingData();
        
        if (!bookingData) {
            showSubmitLoading(false);
            return;
        }
        
        // Invia email
        await sendBookingEmail(bookingData, config);
        
        // Successo
        showSubmitLoading(false);
        showNotification(config.email.notifications.successMessage || 'Richiesta inviata con successo!', 'success');
        
        // Opzionale: resetta form o reindirizza
        // resetForm();
        
    } catch (error) {
        console.error('‚ùå Errore invio prenotazione:', error);
        showSubmitLoading(false);
        showNotification(config.email.notifications.errorMessage || 'Errore nell\'invio. Riprova.', 'error');
    }
}

function collectBookingData() {
    try {
        console.log('üìã Raccogliendo dati prenotazione...');
        
        // Dati personali
        const personalData = {
            firstName: document.getElementById('first-name')?.value || '',
            lastName: document.getElementById('last-name')?.value || '',
            email: document.getElementById('email')?.value || '',
            phone: document.getElementById('phone')?.value || '',
            nationality: document.getElementById('nationality')?.value || '',
            navigationExperience: document.querySelector('input[name="navigation-experience"]:checked')?.value || 'Non specificata',
            specialNotes: document.getElementById('special-requests')?.value || ''
        };
        
        // Validazione campi obbligatori
        const requiredFields = ['firstName', 'lastName', 'email', 'phone'];
        for (const field of requiredFields) {
            if (!personalData[field]) {
                showNotification(`Il campo ${field} √® obbligatorio`, 'error');
                return null;
            }
        }
        
        // Validazione email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(personalData.email)) {
            showNotification('Inserisci un indirizzo email valido', 'error');
            return null;
        }
        
        // Date e ospiti
        const selectedDateElement = document.querySelector('.selected-week');
        const bookingDetails = {
            selectedWeek: selectedDateElement ? selectedDateElement.textContent : 'Non selezionata',
            numberOfGuests: document.getElementById('guests')?.value || '1',
            checkinDate: 'Sabato ore 16:00',
            checkoutDate: 'Sabato ore 10:00'
        };
        
        // Servizi selezionati
        const selectedServices = [];
        const serviceCheckboxes = document.querySelectorAll('.service-checkbox:checked');
        serviceCheckboxes.forEach(checkbox => {
            const serviceCard = checkbox.closest('.service-card, .border');
            if (serviceCard) {
                const nameElement = serviceCard.querySelector('h4, .font-medium');
                const priceElement = serviceCard.querySelector('[id*="price"]');
                
                selectedServices.push({
                    name: nameElement ? nameElement.textContent.trim() : 'Servizio non identificato',
                    price: priceElement ? priceElement.textContent.trim() : 'Prezzo non disponibile'
                });
            }
        });
        
        // Calcolo prezzi
        const basePrice = document.getElementById('summary-base-price')?.textContent || '‚Ç¨ 0';
        const servicesTotal = document.getElementById('services-total')?.textContent || '‚Ç¨ 0';
        const finalTotal = document.getElementById('total-price')?.textContent || '‚Ç¨ 0';
        
        // Sconto Instagram
        const discountSection = document.getElementById('instagram-discount-section');
        const discountLabel = document.getElementById('discount-label')?.textContent || '';
        const discountAmount = document.getElementById('discount-amount')?.textContent || '';
        const hasDiscount = discountSection && discountSection.style.display !== 'none';
        
        const pricingBreakdown = {
            basePrice,
            servicesTotal,
            finalTotal,
            discount: hasDiscount ? {
                label: discountLabel,
                amount: discountAmount
            } : null
        };
        
        // Configurazione catamarano
        const config = CatamaranStorage.load();
        const catamaranInfo = {
            name: config.basic.name || 'Catamarano',
            year: config.basic.year || 2025,
            length: config.basic.length || '11.8 metri',
            cabins: config.basic.cabins || '4 cabine',
            maxGuests: config.basic.maxGuests || 8,
            location: config.basic.location || 'Sardegna'
        };
        
        // Consensi
        const newsletter = document.getElementById('newsletter-checkbox')?.checked || false;
        
        const bookingData = {
            personalData,
            bookingDetails,
            selectedServices,
            pricingBreakdown,
            catamaranInfo,
            newsletter,
            timestamp: new Date().toLocaleString('it-IT'),
            source: 'Sito Web Elite Escape'
        };
        
        console.log('‚úì Dati raccolti:', bookingData);
        return bookingData;
        
    } catch (error) {
        console.error('‚ùå Errore raccolta dati:', error);
        showNotification('Errore nella raccolta dei dati. Controlla i campi inseriti.', 'error');
        return null;
    }
}

async function sendBookingEmail(bookingData, config) {
    console.log('üìß Inviando email prenotazione...');
    
    // Verifica configurazione EmailJS
    if (!config.email.emailjs.serviceId || !config.email.emailjs.templateId) {
        throw new Error('Configurazione EmailJS incompleta');
    }
    
    // Prepara template parameters per EmailJS
    const templateParams = {
        // Informazioni catamarano
        catamaran_name: bookingData.catamaranInfo.name,
        catamaran_year: bookingData.catamaranInfo.year,
        catamaran_details: `${bookingData.catamaranInfo.length}, ${bookingData.catamaranInfo.cabins}, max ${bookingData.catamaranInfo.maxGuests} ospiti`,
        
        // Dati cliente
        client_name: `${bookingData.personalData.firstName} ${bookingData.personalData.lastName}`,
        client_email: bookingData.personalData.email,
        client_phone: bookingData.personalData.phone,
        client_nationality: bookingData.personalData.nationality,
        
        // Dettagli prenotazione
        selected_week: bookingData.bookingDetails.selectedWeek,
        number_of_guests: bookingData.bookingDetails.numberOfGuests,
        checkin_info: bookingData.bookingDetails.checkinDate,
        checkout_info: bookingData.bookingDetails.checkoutDate,
        
        // Servizi
        selected_services: bookingData.selectedServices.length > 0 
            ? bookingData.selectedServices.map(s => `‚Ä¢ ${s.name} - ${s.price}`).join('\n')
            : 'Nessun servizio aggiuntivo selezionato',
        
        // Prezzi
        base_price: bookingData.pricingBreakdown.basePrice,
        services_total: bookingData.pricingBreakdown.servicesTotal,
        discount_info: bookingData.pricingBreakdown.discount 
            ? `${bookingData.pricingBreakdown.discount.label}: ${bookingData.pricingBreakdown.discount.amount}`
            : 'Nessuno sconto applicato',
        final_total: bookingData.pricingBreakdown.finalTotal,
        
        // Extra info
        navigation_experience: bookingData.personalData.navigationExperience,
        special_notes: bookingData.personalData.specialNotes || 'Nessuna nota speciale',
        newsletter_subscription: bookingData.newsletter ? 'S√¨' : 'No',
        
        // Metadati
        booking_timestamp: bookingData.timestamp,
        booking_source: bookingData.source,
        
        // Email destinatario
        to_email: config.email.template.adminEmail
    };
    
    console.log('üìß Parametri template preparati');
    
    // Invia email tramite EmailJS
    const response = await emailjs.send(
        config.email.emailjs.serviceId,
        config.email.emailjs.templateId,
        templateParams
    );
    
    console.log('‚úÖ Email inviata con successo:', response);
    return response;
}

function showSubmitLoading(isLoading) {
    const submitButton = document.getElementById('submit-booking');
    const buttonText = document.getElementById('booking-button-text');
    
    if (!submitButton || !buttonText) return;
    
    if (isLoading) {
        submitButton.disabled = true;
        submitButton.classList.add('opacity-75');
        buttonText.innerHTML = '<i class="ri-loader-4-line animate-spin mr-2"></i>Invio in corso...';
    } else {
        submitButton.disabled = false;
        submitButton.classList.remove('opacity-75');
        
        // Ripristina testo originale
        const config = CatamaranStorage.load();
        buttonText.textContent = (config.ui && config.ui.bookingButton) || 'Invia Richiesta di Prenotazione';
    }
}

function showNotification(message, type = 'info') {
    // Rimuovi notifiche esistenti
    const existingNotifications = document.querySelectorAll('.booking-notification');
    existingNotifications.forEach(n => n.remove());
    
    // Crea nuova notifica
    const notification = document.createElement('div');
    notification.className = `booking-notification fixed top-4 right-4 px-6 py-4 rounded-lg text-white z-50 max-w-md shadow-lg transform transition-all duration-300 translate-x-full`;
    
    // Stili per tipo
    if (type === 'success') {
        notification.classList.add('bg-green-600');
    } else if (type === 'error') {
        notification.classList.add('bg-red-600');
    } else {
        notification.classList.add('bg-blue-600');
    }
    
    notification.innerHTML = `
        <div class="flex items-center">
            <span class="flex-1">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                <i class="ri-close-line"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animazione entrata
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Auto rimozione dopo 5 secondi
    setTimeout(() => {
        if (notification.parentElement) {
            notification.classList.add('translate-x-full');
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}
</script>
</div>
</div>
<!-- Personal Details -->
<div class="bg-white rounded-lg shadow-lg p-6 mb-8">
<h3 class="text-xl font-semibold text-gray-900 mb-4">Dati Personali</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Nome*</label>
<input type="text" class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary" placeholder="Inserisci il tuo nome">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Cognome*</label>
<input type="text" class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary" placeholder="Inserisci il tuo cognome">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Email*</label>
<input type="email" class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary" placeholder="esempio@email.com">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Telefono*</label>
<input type="tel" class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary" placeholder="+39 123 456 7890">
</div>
</div>
<div class="mb-6">
<label class="block text-sm font-medium text-gray-700 mb-2">Nazionalit√†*</label>
<div class="relative">
<select class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary appearance-none pr-8">
<option value="">Seleziona la tua nazionalit√†</option>
<option value="IT">Italia</option>
<option value="FR">Francia</option>
<option value="DE">Germania</option>
<option value="UK">Regno Unito</option>
<option value="ES">Spagna</option>
<option value="CH">Svizzera</option>
<option value="US">Stati Uniti</option>
<option value="other">Altro</option>
</select>
<div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
<i class="ri-arrow-down-s-line text-gray-400"></i>
</div>
</div>
</div>
<div class="mb-6">
<label class="block text-sm font-medium text-gray-700 mb-2">Note speciali o richieste</label>
<textarea class="w-full px-4 py-2 border border-gray-300 rounded focus:border-primary focus:ring-1 focus:ring-primary h-32" placeholder="Inserisci eventuali richieste speciali, allergie, o altre informazioni utili..."></textarea>
</div>
<div class="mb-6">
<label class="block text-sm font-medium text-gray-700 mb-2">Esperienza di navigazione</label>
<div class="space-y-3">
<label class="custom-radio block">
<input type="radio" name="experience" value="none">
<span class="radio-mark"></span>
<span class="ml-2">Nessuna esperienza</span>
</label>
<label class="custom-radio block">
<input type="radio" name="experience" value="basic">
<span class="radio-mark"></span>
<span class="ml-2">Esperienza base</span>
</label>
<label class="custom-radio block">
<input type="radio" name="experience" value="intermediate">
<span class="radio-mark"></span>
<span class="ml-2">Esperienza intermedia</span>
</label>
<label class="custom-radio block">
<input type="radio" name="experience" value="advanced">
<span class="radio-mark"></span>
<span class="ml-2">Esperienza avanzata</span>
</label>
</div>

<div class="bg-gray-50 p-4 rounded-lg mb-4">
<h4 class="font-medium text-gray-900 mb-2">Politica di pagamento trasparente</h4>
<p class="text-sm text-gray-600 mb-2">
‚Ä¢ 50% alla prenotazione, 50% 15 giorni prima dell'imbarco
</p>
<p class="text-sm text-gray-600 mb-2">
‚Ä¢ Cauzione di ‚Ç¨3.500 da versare prima dell'imbarco, rimborsabile in assenza di danni
</p>
<p class="text-sm text-gray-600">
‚Ä¢ Cauzione ridotta a ‚Ç¨1.500 se si sceglie il servizio skipper
</p>
</div>
<div class="bg-gray-50 p-4 rounded-lg mb-6">
<h4 class="font-medium text-gray-900 mb-2">Politica di cancellazione</h4>
<p class="text-sm text-gray-600 mb-2">
‚Ä¢ Cancellazione gratuita fino a 30 giorni prima della partenza
</p>
<p class="text-sm text-gray-600 mb-2">
‚Ä¢ 50% di rimborso fino a 15 giorni prima della partenza
</p>
<p class="text-sm text-gray-600">
‚Ä¢ Nessun rimborso per cancellazioni a meno di 15 giorni dalla partenza
</p>
</div>
<label class="custom-checkbox block mb-2">
<input type="checkbox" id="terms-checkbox">
<span class="checkmark"></span>
<span class="ml-2">Accetto i <a href="#" class="text-primary hover:underline">termini e condizioni</a> e la <a href="#" class="text-primary hover:underline">Privacy Policy</a>*</span>
</label>
<label class="custom-checkbox block mb-4">
<input type="checkbox" id="newsletter-checkbox">
<span class="checkmark"></span>
<span class="ml-2">Desidero ricevere offerte speciali e aggiornamenti via email</span>
</label>
<button id="submit-booking" class="w-full bg-primary text-white py-3 !rounded-button font-medium hover:bg-opacity-90 transition-colors whitespace-nowrap flex items-center justify-center opacity-50 cursor-not-allowed">
<i class="ri-mail-send-line mr-2"></i>
<span id="booking-button-text">Invia Richiesta di Prenotazione</span>
</button>
<p id="booking-subtext" class="mt-4 text-sm text-gray-600 text-center">Sarai ricontattato da Cagliari Sailing Charter entro 24h per confermare e procedere al pagamento dell'anticipo</p>
</div>
</div>
</div>
</div>
</main>
<!-- Footer -->
<footer class="bg-gray-900 text-white pt-12 pb-6 mt-12">
<div class="container mx-auto px-4">
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
<div>
<a href="#" class="text-3xl font-['Pacifico'] text-white mb-4 block">logo</a>
<p class="text-gray-400 mb-4">Offriamo indimenticabili vacanze in catamarano nelle acque cristalline della Sardegna, combinando lusso, avventura e relax.</p>
</div>
<div>
<h3 class="text-lg font-semibold mb-4">Contatti</h3>
<ul class="space-y-2">
<li class="flex items-start">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3 mt-1">
<i class="ri-map-pin-line"></i>
</div>
<span class="text-gray-400">Via del Porto 123, 07026 Olbia (SS), Sardegna</span>
</li>
<li class="flex items-center">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3">
<i class="ri-phone-line"></i>
</div>
<span class="text-gray-400">+39 0789 123456</span>
</li>
<li class="flex items-center">
<div class="w-5 h-5 flex items-center justify-center text-primary mr-3">
<i class="ri-mail-line"></i>
</div>
<span class="text-gray-400">info@catamaranisardegna.it</span>
</li>
</ul>
</div>
<div>
<h3 class="text-lg font-semibold mb-4">Informazioni</h3>
<ul class="space-y-2">
<li><a href="#" class="text-gray-400 hover:text-white transition-colors">Chi siamo</a></li>
<li><a href="#" class="text-gray-400 hover:text-white transition-colors">Termini e Condizioni</a></li>
<li><a href="#" class="text-gray-400 hover:text-white transition-colors">Privacy Policy</a></li>
<li><a href="#" class="text-gray-400 hover:text-white transition-colors">Cookie Policy</a></li>
<li><a href="#" class="text-gray-400 hover:text-white transition-colors">FAQ</a></li>
</ul>
</div>
<div>
<h3 class="text-lg font-semibold mb-4">Metodi di Pagamento</h3>
<div class="flex flex-wrap gap-3">
<div class="w-10 h-10 flex items-center justify-center bg-gray-800 rounded">
<i class="ri-visa-fill ri-lg"></i>
</div>
<div class="w-10 h-10 flex items-center justify-center bg-gray-800 rounded">
<i class="ri-mastercard-fill ri-lg"></i>
</div>
<div class="w-10 h-10 flex items-center justify-center bg-gray-800 rounded">
<i class="ri-paypal-fill ri-lg"></i>
</div>
<div class="w-10 h-10 flex items-center justify-center bg-gray-800 rounded">
<i class="ri-bank-card-fill ri-lg"></i>
</div>
</div>
<div class="mt-4">
<h3 class="text-lg font-semibold mb-4">Seguici</h3>
<div class="flex space-x-3">
<a href="#" class="w-8 h-8 flex items-center justify-center bg-gray-800 rounded-full hover:bg-primary transition-colors">
<i class="ri-facebook-fill"></i>
</a>
<a href="#" class="w-8 h-8 flex items-center justify-center bg-gray-800 rounded-full hover:bg-primary transition-colors">
<i class="ri-instagram-line"></i>
</a>
<a href="#" class="w-8 h-8 flex items-center justify-center bg-gray-800 rounded-full hover:bg-primary transition-colors">
<i class="ri-twitter-x-line"></i>
</a>
</div>
</div>
</div>
</div>
<div class="border-t border-gray-800 pt-6">
<p class="text-gray-500 text-sm text-center">¬© 2025 Catamarani Sardegna. Tutti i diritti riservati.</p>
</div>
</div>
</footer>
<script id="logo-loader-script">
// Carica e mostra il logo dalla configurazione
document.addEventListener('DOMContentLoaded', function() {
    try {
        console.log('üîÑ Caricamento logo per pagina prenotazione...');
        const config = CatamaranStorage.load();
        const logoElement = document.getElementById('site-logo');
        
        console.log('üìÇ Configurazione caricata:', config.theme);
        console.log('üéØ Elemento logo trovato:', !!logoElement);
        
        if (logoElement) {
            // Migrazione della configurazione logo (da stringa a oggetto)
            if (typeof config.theme.logo === 'string') {
                console.log('üîÑ Migrazione configurazione logo da stringa a oggetto');
                const oldLogoText = config.theme.logo;
                config.theme.logo = {
                    type: 'text',
                    imageUrl: '',
                    text: oldLogoText
                };
            }
            
            // Assicurati che la struttura logo esista
            if (!config.theme.logo) {
                config.theme.logo = { type: 'text', imageUrl: '', text: 'logo' };
            }
            
            console.log('üñºÔ∏è Configurazione logo:', config.theme.logo);
            
            if (config.theme.logo.type === 'image' && config.theme.logo.imageUrl) {
                console.log('‚úÖ Mostrando immagine logo');
                // Mostra immagine logo
                logoElement.innerHTML = `<img src="${config.theme.logo.imageUrl}" alt="${config.theme.logo.text}" class="h-8 w-auto">`;
                logoElement.className = 'block';
            } else {
                console.log('üìù Mostrando testo logo:', config.theme.logo.text);
                // Mostra testo logo
                logoElement.textContent = config.theme.logo.text;
                logoElement.className = 'text-3xl font-["Pacifico"] text-primary';
            }
        }
        
        // Carica titolo principale
        const titleElement = document.getElementById('page-main-title');
        if (titleElement && config.ui && config.ui.mainHeading) {
            console.log('üìù Aggiornando titolo principale:', config.ui.mainHeading);
            titleElement.textContent = config.ui.mainHeading;
        }
        
        // Carica badge prezzo di partenza
        const priceBadge = document.getElementById('price-badge');
        const badgeText = document.getElementById('badge-text');
        const badgePrice = document.getElementById('badge-price');
        
        // Assicurati che la struttura badge esista
        if (!config.priceBadge) {
            config.priceBadge = {
                enabled: true,
                text: "A partire da",
                color: "#f8b400",
                textColor: "#ffffff"
            };
        }
        
        if (priceBadge && badgeText && badgePrice && config.priceBadge.enabled) {
            console.log('üè∑Ô∏è Aggiornando badge prezzo:', config.priceBadge);
            
            // Aggiorna il testo del badge
            badgeText.textContent = config.priceBadge.text || 'A partire da';
            
            // Aggiorna il prezzo del badge
            if (config.basic && config.basic.startingPrice) {
                badgePrice.textContent = `‚Ç¨${config.basic.startingPrice.toLocaleString()}`;
            }
            
            // Aggiorna i colori del badge
            priceBadge.style.backgroundColor = config.priceBadge.color || '#f8b400';
            priceBadge.style.color = config.priceBadge.textColor || '#ffffff';
            
            // Mostra il badge
            priceBadge.style.display = 'flex';
        } else if (priceBadge) {
            // Nascondi il badge se disabilitato
            priceBadge.style.display = 'none';
        }
        
        // Carica prezzi
        const basePriceElement = document.getElementById('base-price');
        const summaryBasePriceElement = document.getElementById('summary-base-price');
        
        if (basePriceElement && config.basic && config.basic.basePrice) {
            console.log('üí∞ Aggiornando prezzo base:', config.basic.basePrice);
            basePriceElement.textContent = `‚Ç¨ ${config.basic.basePrice.toLocaleString()}`;
        }
        
        if (summaryBasePriceElement && config.basic && config.basic.basePrice) {
            summaryBasePriceElement.textContent = `‚Ç¨ ${config.basic.basePrice.toLocaleString()}`;
        }
        
    } catch (error) {
        console.error('‚ùå Errore nel caricamento del logo:', error);
    }
});
</script>
<script id="calendar-script">
document.addEventListener('DOMContentLoaded', function() {
let currentDate = new Date(2025, 4, 23); // 2025-05-23
let selectedStartDate = null;
let selectedEndDate = null;
const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
const calendarDays = document.getElementById('calendarDays');
const currentMonthElement = document.getElementById('currentMonth');
const selectedWeekElement = document.getElementById('selectedWeek');
const clearSelectionButton = document.getElementById('clearSelection');
const bookingDatesElement = document.getElementById('booking-dates');
function getSunday(date) {
const day = date.getDay();
return new Date(date.setDate(date.getDate() - day));
}

// Funzione per ottenere il luned√¨ della settimana ISO (per compatibilit√† con admin)
function getMondayISO(date) {
const day = date.getDay();
const mondayOffset = day === 0 ? -6 : 1 - day; // Se domenica (-6), altrimenti (1 - day)
const monday = new Date(date);
monday.setDate(date.getDate() + mondayOffset);
return monday;
}
function formatDate(date) {
const day = date.getDate().toString().padStart(2, '0');
const month = monthNames[date.getMonth()];
return `${day} ${month}`;
}
function formatDateWithTime(date, time) {
return `${formatDate(date)} ore ${time}`;
}
function renderCalendar() {
const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
const startingDay = getSunday(new Date(firstDay));
currentMonthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
calendarDays.innerHTML = '';
const today = new Date(2025, 4, 23);
const minDate = today;
for (let i = 0; i < 42; i++) {
const date = new Date(startingDay);
date.setDate(startingDay.getDate() + i);
const dayElement = document.createElement('div');
dayElement.className = 'relative py-3 text-sm text-center';
if (date < minDate) {
dayElement.className += ' text-gray-300 cursor-not-allowed';
} else {
dayElement.className += ' hover:bg-gray-50 cursor-pointer';
dayElement.setAttribute('data-date', date.toISOString());
if (selectedStartDate && selectedEndDate) {
if (date >= selectedStartDate && date <= selectedEndDate) {
dayElement.className += ' bg-primary bg-opacity-10';
}
if (date.toDateString() === selectedStartDate.toDateString()) {
dayElement.className += ' bg-primary text-white rounded-l-lg';
}
if (date.toDateString() === selectedEndDate.toDateString()) {
dayElement.className += ' bg-primary text-white rounded-r-lg';
}
// Add red dot for boarding day (Saturday before start)
const boardingDate = new Date(selectedStartDate);
boardingDate.setDate(selectedStartDate.getDate() - 1);
if (date.toDateString() === boardingDate.toDateString()) {
const dot = document.createElement('div');
dot.className = 'absolute -top-1 right-1 w-2 h-2 bg-red-500 rounded-full';
dayElement.appendChild(dot);
}
}
}
dayElement.textContent = date.getDate();
calendarDays.appendChild(dayElement);
}
attachDayClickHandlers();
}
function attachDayClickHandlers() {
const dayElements = calendarDays.querySelectorAll('[data-date]');
dayElements.forEach(dayElement => {
dayElement.addEventListener('click', () => {
const clickedDate = new Date(dayElement.dataset.date);

// Per la visualizzazione: usa domenica-sabato (tradizionale)
const weekStart = getSunday(new Date(clickedDate));
const weekEnd = new Date(weekStart);
weekEnd.setDate(weekStart.getDate() + 6);

// Per il calcolo prezzi: usa luned√¨ ISO (compatibile con admin)
const mondayISO = getMondayISO(new Date(clickedDate));

console.log('üìÖ Click calendario:', {
    clickedDate: clickedDate.toISOString().slice(0,10),
    weekStart_domenica: weekStart.toISOString().slice(0,10),
    mondayISO: mondayISO.toISOString().slice(0,10),
    weekNumber_domenica: getWeekNumber(weekStart),
    weekNumber_mondayISO: getWeekNumber(mondayISO)
});

selectedStartDate = weekStart;
selectedEndDate = weekEnd;
const boardingDate = new Date(weekStart);
boardingDate.setDate(weekStart.getDate() - 1);
selectedWeekElement.textContent = `${formatDate(weekStart)} - ${formatDate(weekEnd)}`;
document.getElementById('boardingTimes').textContent = `Check-in: ${formatDateWithTime(boardingDate, '16:00')} | Check-out: ${formatDateWithTime(weekEnd, '10:00')}`;
bookingDatesElement.textContent = `${formatDate(weekStart)} - ${formatDate(weekEnd)} 2025`;
clearSelectionButton.classList.remove('hidden');

// Mostra la sezione prezzo quando viene selezionata una settimana
const weekPriceSection = document.getElementById('week-price-section');
if (weekPriceSection) {
    weekPriceSection.classList.remove('hidden');
}

// Aggiorna il prezzo base per la settimana selezionata (usa luned√¨ ISO)
updateBasePriceForWeek(mondayISO);

renderCalendar();
});
});
}
document.getElementById('prevMonth').addEventListener('click', () => {
currentDate.setMonth(currentDate.getMonth() - 1);
renderCalendar();
});
document.getElementById('nextMonth').addEventListener('click', () => {
currentDate.setMonth(currentDate.getMonth() + 1);
renderCalendar();
});
clearSelectionButton.addEventListener('click', () => {
selectedStartDate = null;
selectedEndDate = null;
selectedWeekElement.textContent = 'Nessuna settimana selezionata';
bookingDatesElement.textContent = '23 Maggio - 30 Maggio 2025';
clearSelectionButton.classList.add('hidden');

// Nascondi la sezione prezzo quando viene cancellata la selezione
const weekPriceSection = document.getElementById('week-price-section');
if (weekPriceSection) {
    weekPriceSection.classList.add('hidden');
}

// Ripristina il prezzo base default
const config = CatamaranStorage.load();
currentBasePrice = config.basic.basePrice || 3499;

// Aggiorna la visualizzazione del prezzo base
const basePriceElement = document.getElementById('base-price');
const summaryBasePriceElement = document.getElementById('summary-base-price');

if (basePriceElement) {
    basePriceElement.textContent = `‚Ç¨ ${currentBasePrice.toLocaleString()}`;
}
if (summaryBasePriceElement) {
    summaryBasePriceElement.textContent = `‚Ç¨ ${currentBasePrice.toLocaleString()}`;
}

// Aggiorna i totali
if (typeof window.updateTotals === 'function') {
    window.updateTotals();
}

renderCalendar();
});
renderCalendar();
});
</script>
<script id="guest-counter-script">
document.addEventListener('DOMContentLoaded', function() {
const decreaseBtn = document.getElementById('decreaseGuests');
const increaseBtn = document.getElementById('increaseGuests');
const guestsInput = document.getElementById('guestsCount');
const bookingGuests = document.getElementById('booking-guests');
const linensDetailElement = document.getElementById('linens-detail-price');
function updateCleaningFee(guests) {
const cleaningFee = guests * 20;
if (linensDetailElement) {
    linensDetailElement.textContent = cleaningFee;
    console.log(`üí∞ Aggiornato prezzo lenzuola: ‚Ç¨${cleaningFee} per ${guests} ospiti`);
} else {
    console.error('‚ùå Elemento linens-detail-price non trovato');
}
updatePartialTotal();
updateTotalPrice();
}
function updatePartialTotal() {
const basePrice = 3499;
const charterPackage = 400;
const fuelPackage = 350;
const linensElement = document.getElementById('linens-detail-price');
const cleaningFee = linensElement ? parseInt(linensElement.textContent) : 120;
const partialTotal = basePrice + charterPackage + fuelPackage + cleaningFee;

// Fix: controlla se l'elemento esiste prima di aggiornarlo
const partialTotalElement = document.getElementById('partial-total');
if (partialTotalElement) {
    partialTotalElement.textContent = `‚Ç¨${partialTotal}`;
    console.log(`üí∞ Partial total aggiornato: ‚Ç¨${partialTotal}`);
} else {
    console.warn('‚ö†Ô∏è Elemento partial-total non trovato nell HTML');
}
}
function updateTotalPrice() {
const basePrice = 3500;
const charterPackage = 400;
const linensElement = document.getElementById('linens-detail-price');
const cleaningFee = linensElement ? parseInt(linensElement.textContent) : 120;
const servicesTotal = parseInt(document.getElementById('services-total')?.textContent?.replace('‚Ç¨', '') || 0);
const total = basePrice + charterPackage + cleaningFee + servicesTotal;
const totalElement = document.getElementById('total-price');
if (totalElement) {
    totalElement.textContent = `‚Ç¨${total}`;
    console.log(`üí∞ Prezzo totale aggiornato: ‚Ç¨${total}`);
} else {
    console.warn('‚ö†Ô∏è Elemento total-price non trovato');
}
}
decreaseBtn.addEventListener('click', function() {
let currentValue = parseInt(guestsInput.value);
if (currentValue > 1) {
guestsInput.value = currentValue - 1;
bookingGuests.textContent = `${currentValue - 1} persone`;
updateCleaningFee(currentValue - 1);
}
});
increaseBtn.addEventListener('click', function() {
let currentValue = parseInt(guestsInput.value);
if (currentValue < 8) {
guestsInput.value = currentValue + 1;
bookingGuests.textContent = `${currentValue + 1} persone`;
updateCleaningFee(currentValue + 1);
}
});
guestsInput.addEventListener('change', function() {
let currentValue = parseInt(guestsInput.value);
if (currentValue < 1) {
guestsInput.value = 1;
currentValue = 1;
} else if (currentValue > 8) {
guestsInput.value = 8;
currentValue = 8;
}
bookingGuests.textContent = `${currentValue} persone`;
updateCleaningFee(currentValue);
});
updateCleaningFee(parseInt(guestsInput.value));
});
</script>
<script id="dynamic-pricing-script">
// === SISTEMA PREZZI DINAMICI GLOBALE ===
let currentBasePrice = 3499; // Prezzo dinamico basato sulla settimana selezionata

// Funzione per calcolare il numero della settimana ISO
function getWeekNumber(date) {
    const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
    const dayNum = d.getUTCDay() || 7;
    d.setUTCDate(d.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
    return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}

// Funzione per ottenere il prezzo per una settimana specifica
function getWeeklyPrice(date) {
    const config = CatamaranStorage.load();
    
    console.log('üîç getWeeklyPrice chiamata per data:', date.toISOString().slice(0,10));
    console.log('üìä Config weeklyPricing:', config.weeklyPricing);
    
    if (!config.weeklyPricing || !config.weeklyPricing.enabled) {
        console.log('‚ö†Ô∏è Prezzi settimanali disabilitati, uso basePrice:', config.basic.basePrice);
        return config.basic.basePrice || 3499;
    }
    
    const weekNumber = getWeekNumber(date);
    const year = date.getFullYear();
    const weekKey = `${year}-W${weekNumber.toString().padStart(2, '0')}`;
    
    console.log(`üìÖ Settimana calcolata: ${weekKey} (numero ${weekNumber})`);
    console.log('üí∞ Settimane configurate:', config.weeklyPricing.weeks);
    
    // Controlla se esiste un prezzo specifico per questa settimana
    if (config.weeklyPricing.weeks && config.weeklyPricing.weeks[weekKey]) {
        const price = config.weeklyPricing.weeks[weekKey].price;
        console.log(`‚úÖ Prezzo specifico trovato per ${weekKey}: ‚Ç¨${price}`);
        return price;
    }
    
    // Altrimenti usa il prezzo default del calendario
    const defaultPrice = config.weeklyPricing.defaultPrice || config.basic.basePrice || 3499;
    console.log(`üìã Uso prezzo default: ‚Ç¨${defaultPrice}`);
    return defaultPrice;
}

// Funzione per aggiornare il prezzo base quando viene selezionata una settimana
function updateBasePriceForWeek(startDate) {
    if (startDate) {
        console.log('üí∞ updateBasePriceForWeek chiamata per:', startDate.toISOString().slice(0,10));
        const config = CatamaranStorage.load();
        currentBasePrice = getWeeklyPrice(startDate);
        console.log('üìä Nuovo currentBasePrice:', currentBasePrice);
        
        // Ottieni informazioni sulla settimana
        const weekNumber = getWeekNumber(startDate);
        const year = startDate.getFullYear();
        const weekKey = `${year}-W${weekNumber.toString().padStart(2, '0')}`;
        const weekData = config.weeklyPricing?.weeks?.[weekKey];
        
        // Aggiorna la visualizzazione del prezzo base
        const basePriceElement = document.getElementById('base-price');
        const summaryBasePriceElement = document.getElementById('summary-base-price');
        
        if (basePriceElement) {
            basePriceElement.textContent = `‚Ç¨ ${currentBasePrice.toLocaleString()}`;
        }
        if (summaryBasePriceElement) {
            summaryBasePriceElement.textContent = `‚Ç¨ ${currentBasePrice.toLocaleString()}`;
        }
        
        // Aggiorna le informazioni della settimana
        const weekDetailsElement = document.getElementById('week-details');
        const weekNoteElement = document.getElementById('week-note');
        
        if (weekDetailsElement) {
            weekDetailsElement.textContent = `Settimana ${weekNumber} (${weekKey}) - 7 giorni selezionati`;
        }
        
        if (weekNoteElement && weekData?.note) {
            weekNoteElement.textContent = weekData.note;
            weekNoteElement.style.display = 'block';
        } else if (weekNoteElement) {
            weekNoteElement.style.display = 'none';
        }
        
        // Aggiorna anche i totali se la funzione esiste
        if (typeof window.updateTotals === 'function') {
            window.updateTotals();
        }
    }
}
</script>

<script id="services-calculator-script">
document.addEventListener('DOMContentLoaded', function() {
const serviceCheckboxes = document.querySelectorAll('.service-checkbox');
const servicesTotalContainer = document.getElementById('services-total-container');
const servicesTotalElement = document.getElementById('services-total');
const selectedServicesList = document.getElementById('selected-services-list');
const totalPriceElement = document.getElementById('total-price');
let servicesTotal = 0;

// Funzione per aggiornare il display del sconto Instagram
function updateInstagramDiscountDisplay(discountConfig, discountAmount) {
    const discountSection = document.getElementById('instagram-discount-section');
    const discountLabel = document.getElementById('discount-label');
    const discountAmountElement = document.getElementById('discount-amount');
    
    if (!discountSection || !discountLabel || !discountAmountElement) {
        console.error('‚ùå Elementi sconto Instagram non trovati');
        return;
    }
    
    if (discountConfig.enabled && discountAmount > 0) {
        // Mostra il sconto
        discountSection.style.display = 'flex';
        discountLabel.textContent = discountConfig.label || 'Sconto Instagram';
        discountAmountElement.textContent = `-‚Ç¨ ${discountAmount.toFixed(2).replace('.', ',')}`;
        console.log('üí∞ Sconto Instagram aggiornato:', {
            label: discountConfig.label,
            amount: discountAmount,
            percentage: discountConfig.percentage
        });
    } else {
        // Nascondi il sconto se disabilitato
        discountSection.style.display = 'none';
        console.log('üí∞ Sconto Instagram disabilitato');
    }
}

// Rende updateTotals globale per il sistema di prezzi dinamici
window.updateTotals = function() {
console.log('üîÑ updateTotals chiamata');

// Verifica esistenza elementi DOM
if (!servicesTotalContainer) {
    console.error('‚ùå servicesTotalContainer non trovato');
    return;
}
if (!servicesTotalElement) {
    console.error('‚ùå servicesTotalElement non trovato');
    return;
}
if (!selectedServicesList) {
    console.error('‚ùå selectedServicesList non trovato');
    return;
}
if (!totalPriceElement) {
    console.error('‚ùå totalPriceElement non trovato');
    return;
}

const selectedServices = Array.from(serviceCheckboxes).filter(checkbox => checkbox.checked);
console.log('üìã Servizi selezionati:', selectedServices.length);

if (selectedServices.length === 0) {
servicesTotalContainer.style.display = 'none';
} else {
servicesTotalContainer.style.display = 'block';
selectedServicesList.innerHTML = '';
let dailyTotal = 0;
let onetimeTotal = 0;
selectedServices.forEach(service => {
const price = parseInt(service.dataset.price);
const name = service.dataset.name;
const isOneTime = service.dataset.onetime === 'true';
if (isOneTime) {
onetimeTotal += price;
selectedServicesList.innerHTML += `
<div>
<div class="flex justify-between items-start mb-2">
<span class="font-medium">${name}:</span>
<span class="font-medium">‚Ç¨ ${price}</span>
</div>
</div>
`;
} else {
dailyTotal += price;
selectedServicesList.innerHTML += `
<div>
<div class="flex justify-between items-start mb-2">
<span class="font-medium">${name}:</span>
<span class="font-medium">‚Ç¨ ${price * 7}</span>
</div>
<ul class="list-disc ml-4 space-y-1 text-xs">
<li>‚Ç¨${price} x 7 giorni</li>
</ul>
</div>
`;
}
});
servicesTotal = (dailyTotal * 7) + onetimeTotal;
}
const linensElement = document.getElementById('linens-detail-price');
const cleaningFee = linensElement ? parseInt(linensElement.textContent) : 120;

// Verifica finale prima di aggiornare UI
if (servicesTotalElement && totalPriceElement) {
    servicesTotalElement.textContent = `‚Ç¨${servicesTotal}`;
    // Carica configurazione sconto Instagram dinamica
    const config = CatamaranStorage.load();
    const discountConfig = config.pricing && config.pricing.instagramDiscount ? config.pricing.instagramDiscount : {
        enabled: true,
        percentage: 10,
        label: "Sconto Instagram -10%"
    };
    
    const instagramDiscount = discountConfig.enabled ? (currentBasePrice * (discountConfig.percentage / 100)) : 0;
    const finalTotal = currentBasePrice - instagramDiscount + servicesTotal + cleaningFee;
    totalPriceElement.textContent = `‚Ç¨${finalTotal}`;
    
    // Aggiorna display sconto Instagram
    updateInstagramDiscountDisplay(discountConfig, instagramDiscount);
    
    console.log('üìä Calcolo totale completato:', {currentBasePrice, instagramDiscount, servicesTotal, cleaningFee, finalTotal});
} else {
    console.error('‚ùå Impossibile aggiornare totali: elementi mancanti', {
        servicesTotalElement: !!servicesTotalElement,
        totalPriceElement: !!totalPriceElement
    });
}
}
serviceCheckboxes.forEach(checkbox => {
checkbox.addEventListener('change', window.updateTotals);
});
window.updateTotals();
});
</script>
<script id="mobile-menu-script">
document.addEventListener('DOMContentLoaded', function() {
const menuButton = document.querySelector('.ri-menu-line').parentElement;
const nav = document.querySelector('nav');
menuButton.addEventListener('click', function() {
nav.classList.toggle('hidden');
nav.classList.toggle('flex');
nav.classList.toggle('flex-col');
nav.classList.toggle('absolute');
nav.classList.toggle('top-16');
nav.classList.toggle('left-0');
nav.classList.toggle('right-0');
nav.classList.toggle('bg-white');
nav.classList.toggle('shadow-lg');
nav.classList.toggle('p-4');
nav.classList.toggle('z-50');
});
});
</script>

<script id="config-loader">
// Helper function per aggiornare elementi DOM
function updateElement(elementId, content, attribute = null, value = null) {
    try {
        const element = document.getElementById(elementId);
        if (!element) {
            console.warn(`‚ö†Ô∏è Elemento con ID '${elementId}' non trovato`);
            return false;
        }
        
        if (attribute && value !== null) {
            // Aggiorna un attributo (es. src, href)
            element.setAttribute(attribute, value);
            console.log(`‚úÖ Aggiornato ${elementId}.${attribute}: ${value.substring(0, 50)}${value.length > 50 ? '...' : ''}`);
        } else if (content !== null) {
            // Aggiorna il contenuto testuale
            element.textContent = content;
            console.log(`‚úÖ Aggiornato ${elementId}: ${content}`);
        }
        
        return true;
    } catch (error) {
        console.error(`‚ùå Errore aggiornamento ${elementId}:`, error);
        return false;
    }
}

// Caricamento configurazione dinamica
async function loadCatamaranConfiguration() {
    try {
        console.log('üìñ Caricamento configurazione catamarano...');
        
        // üîÑ Prima prova a caricare da Supabase (per browser incognito)
        let newConfig = null;
        
        // Tentativo 1: Carica da Supabase e cerca box1_2
        if (typeof CatamaranStorage !== 'undefined' && CatamaranStorage.forceRefresh) {
            console.log('üì° Tentativo caricamento da Supabase...');
            try {
                const supabaseResult = await CatamaranStorage.forceRefresh();
                console.log('üì° Risultato Supabase refresh:', supabaseResult);
                
                if (supabaseResult.success) {
                    console.log('‚úÖ Configurazione base caricata da Supabase');
                    
                    // Carica la configurazione completa da CatamaranStorage
                    const fullConfig = CatamaranStorage.load();
                    console.log('üìÑ Configurazione completa da CatamaranStorage:', fullConfig);
                    
                    if (fullConfig && fullConfig.box1_2) {
                        newConfig = fullConfig.box1_2;
                        console.log('üì¶ Trovati dati BOX 1-2 in Supabase:', newConfig);
                    } else {
                        console.warn('‚ö†Ô∏è BOX 1-2 non trovati nella configurazione Supabase');
                        console.log('üîç Struttura configurazione:', Object.keys(fullConfig || {}));
                    }
                } else {
                    console.warn('‚ö†Ô∏è Supabase refresh fallito:', supabaseResult.error);
                }
            } catch (error) {
                console.error('‚ùå Errore caricamento Supabase:', error);
            }
        } else {
            console.warn('‚ö†Ô∏è CatamaranStorage o forceRefresh non disponibili');
        }
        
        // Tentativo 2: Se non trovato su Supabase, prova localStorage
        if (!newConfig) {
            const box1_2_config = localStorage.getItem('eliteEscape_config_box1_2');
            if (box1_2_config) {
                newConfig = JSON.parse(box1_2_config);
                console.log('üì¶ Caricando dalla struttura BOX 1-2 localStorage:', newConfig);
            }
        }
        
        // Se abbiamo trovato i dati BOX 1-2, usali
        if (newConfig) {
            
            // BOX 1: Caratteristiche della Pagina
            if (newConfig.box1) {
                const box1 = newConfig.box1;
                
                // Logo
                if (box1.logo && box1.logo.text) {
                    updateElement('site-logo', box1.logo.text);
                }
                
                // Titolo pagina
                if (box1.page && box1.page.title) {
                    updateElement('page-main-title', box1.page.title);
                }
            }
            
            // BOX 2: Caratteristiche dell'Imbarcazione  
            if (newConfig.box2) {
                const box2 = newConfig.box2;
                
                // Immagini
                if (box2.images && box2.images.main) {
                    updateElement('catamaran-main-image', null, 'src', box2.images.main);
                }
                
                // Badge
                if (box2.badge) {
                    updateElement('badge-text', box2.badge.text);
                    updateElement('badge-price', `‚Ç¨${parseInt(box2.badge.startingPrice).toLocaleString()}`);
                    const badgeElement = document.getElementById('price-badge');
                    if (badgeElement) {
                        badgeElement.style.backgroundColor = box2.badge.color;
                    }
                }
                
                // Nome barca e prezzo base
                if (box2.boat) {
                    updateElement('catamaran-name', box2.boat.name);
                    currentBasePrice = parseInt(box2.boat.basePrice) || 3499;
                    updateElement('base-price', `‚Ç¨ ${currentBasePrice.toLocaleString()}`);
                }
                
                // üîß Caratteristiche Tecniche (incluse le 5 NUOVE)
                if (box2.technical) {
                    const tech = box2.technical;
                    updateElement('catamaran-year', `Anno ${tech.year}`);
                    updateElement('catamaran-length', `${tech.length} m`);
                    updateElement('catamaran-cabins', `${tech.cabins} cabine +1 skipper`);
                    updateElement('catamaran-bathrooms', `${tech.bathrooms} bagni +1 skipper`);
                    updateElement('catamaran-engine', `${tech.enginePower} HP`);
                    
                    // üÜï NUOVE CARATTERISTICHE
                    updateElement('catamaran-width', `${tech.width} m larghezza`);
                    updateElement('catamaran-draft', `${tech.draft} m pescaggio`);
                    updateElement('catamaran-displacement', `${tech.displacement} t dislocamento`);
                    updateElement('catamaran-water-tank', `${tech.waterTank} L acqua`);
                    updateElement('catamaran-fuel-tank', `${tech.fuelTank} L gasolio`);
                }
            }
            
            console.log('‚úÖ Configurazione BOX 1-2 caricata con successo');
            console.log('üöÄ Inizializzazione currentBasePrice:', currentBasePrice);
            
            // üéØ Mostra elementi nascosti dopo caricamento configurazione
            showConfigElements();
            
            return; // Esce dalla funzione se ha trovato BOX 1-2
        }
        
        // üì¶ Prova a caricare dal formato pubblico unificato 'data'
        console.log('üìÑ BOX 1-2 non trovato, carico dalla struttura data...');
        const config = CatamaranStorage.load();
        
        if (!config) {
            console.error('‚ùå Configurazione non caricata');
            return;
        }
        
        // üîÑ Controllo nuovo formato unificato
        if (config.data && Object.keys(config.data).length > 0) {
            console.log('üì¶ Caricando dalla struttura unificata DATA:', config.data);
            
            // Aggiorna dal formato unificato
            updateElement('site-logo', config.data.logo?.text || 'Elite Escape');
            updateElement('page-main-title', config.data.page?.title || 'Prenota il tuo Catamarano');
            updateElement('catamaran-main-image', config.data.images?.main || null);
            updateElement('badge-text', config.data.badge?.text || 'A partire da');
            updateElement('badge-price', config.data.badge?.price || '‚Ç¨2.999');
            updateElement('catamaran-name', config.data.boat?.name || 'Violante');
            
            // Prezzo base dal formato unificato
            const priceText = config.data.badge?.price || '‚Ç¨3.499';
            const priceNumber = parseInt(priceText.replace(/[‚Ç¨.,]/g, '')) || 3499;
            currentBasePrice = priceNumber;
            updateElement('base-price', `‚Ç¨ ${currentBasePrice.toLocaleString()}`);
            
            // Dati tecnici
            updateElement('catamaran-year', config.data.technical?.year || 'Anno 2025');
            updateElement('catamaran-length', config.data.technical?.length || '11.8 m');
            updateElement('catamaran-cabins', config.data.technical?.cabins || '4 cabine +1 skipper');
            updateElement('catamaran-bathrooms', config.data.technical?.bathrooms || '4 bagni +1 skipper');
            updateElement('catamaran-engine', config.data.technical?.engine || '60 HP');
            updateElement('catamaran-width', config.data.technical?.width || '7.32 m larghezza');
            updateElement('catamaran-draft', config.data.technical?.draft || '1.15 m pescaggio');
            updateElement('catamaran-displacement', config.data.technical?.displacement || '11.2 t dislocamento');
            updateElement('catamaran-water-tank', config.data.technical?.waterTank || '400 L acqua');
            updateElement('catamaran-fuel-tank', config.data.technical?.fuelTank || '150 L gasolio');
            
            console.log('‚úÖ Configurazione DATA caricata con successo');
            console.log('üöÄ Inizializzazione currentBasePrice:', currentBasePrice);
            
        } else if (config.basic) {
            // Fallback per vecchia struttura
            console.log('üìÑ Fallback: caricando dalla vecchia struttura BASIC');
            updateElement('catamaran-name', config.basic.name);
            
            // Aggiorna prezzo base (inizializza currentBasePrice con il valore dalla configurazione)
            currentBasePrice = config.basic.basePrice || 3499;
            console.log('üöÄ Inizializzazione currentBasePrice:', currentBasePrice);
            updateElement('base-price', `‚Ç¨ ${currentBasePrice.toLocaleString()}`);
        } else {
            console.error('‚ùå Nessun formato di configurazione riconosciuto');
        }
        console.log('üîß Config all\'inizializzazione:', config);
        updateElement('base-price', `‚Ç¨ ${currentBasePrice.toLocaleString()}`);
        
        // Aggiorna anno (vecchia struttura)
        updateElement('catamaran-year', `Anno ${config.basic.year}`);
        
        // Aggiorna prezzo nel riepilogo (usa il currentBasePrice)
        updateElement('summary-base-price', `‚Ç¨ ${currentBasePrice.toLocaleString()}`);
        
        // Aggiorna prezzi pacchetti (usa ID corretti dal DOM)
        updateElement('charter-detail-price', config.mandatoryPackages.charter.price.toString());
        updateElement('fuel-detail-price', config.mandatoryPackages.fuel.price.toString());
        
        // Aggiorna prezzo lenzuola (calcolato per numero ospiti di default)
        const defaultGuests = config.basic.defaultGuests || 6;
        const linensTotal = config.mandatoryPackages.linens.pricePerGuest * defaultGuests;
        updateElement('linens-detail-price', linensTotal.toString());
        
        // Aggiorna prezzo skipper
        updateElement('skipper-price', `‚Ç¨${config.additionalServices.skipper.price}/giorno`);
        
        // Aggiorna data-price del checkbox skipper
        const skipperCheckbox = document.querySelector('.service-checkbox[data-name="Skipper"]');
        if (skipperCheckbox) {
            skipperCheckbox.setAttribute('data-price', config.additionalServices.skipper.price);
            console.log('‚úÖ Skipper checkbox price aggiornato:', config.additionalServices.skipper.price);
        }
        
        // === FASE 3: Aggiorna contenuti dinamici ===
        
        // Aggiorna immagine principale del catamarano
        if (config.images && config.images.main) {
            const mainImage = document.getElementById('catamaran-main-image');
            if (mainImage) {
                mainImage.src = config.images.main;
                console.log('‚úÖ Immagine principale aggiornata');
            }
        }
        
        // Aggiorna descrizione del catamarano
        if (config.description) {
            updateElement('catamaran-description', config.description);
        }
        
        // Aggiorna caratteristiche principali
        if (config.mainFeatures && Array.isArray(config.mainFeatures)) {
            updateMainFeaturesList(config.mainFeatures);
        }
        
        // Aggiorna dotazioni incluse
        if (config.includedEquipment && Array.isArray(config.includedEquipment)) {
            updateIncludedEquipmentList(config.includedEquipment);
        }
        
        console.log('‚úÖ Configurazione catamarano caricata con successo (Fase 3 inclusa)');
        console.log('Dati caricati:', {
            name: config.basic.name,
            price: config.basic.basePrice,
            year: config.basic.year,
            linensPrice: config.mandatoryPackages.linens.pricePerGuest,
            skipperPrice: config.additionalServices.skipper.price,
            hasImage: !!(config.images && config.images.main),
            hasDescription: !!config.description,
            featuresCount: config.mainFeatures ? config.mainFeatures.length : 0,
            equipmentCount: config.includedEquipment ? config.includedEquipment.length : 0
        });
        
        // üéØ Mostra elementi nascosti dopo caricamento configurazione (fallback)
        showConfigElements();
        
    } catch (error) {
        console.error('Errore nel caricare la configurazione:', error);
        // üéØ Mostra elementi anche in caso di errore per evitare pagina vuota
        showConfigElements();
    }
}

// üéØ Funzione per mostrare elementi nascosti dopo caricamento configurazione
function showConfigElements() {
    console.log('üé® Mostrando elementi configurazione...');
    
    // Mostra elementi specifici che erano nascosti per prevenire flash
    const elementsToShow = [
        '#badge-price',
        '#base-price', 
        '#skipper-price',
        '#catamaran-name',
        '#catamaran-year',
        '#catamaran-length',
        '#catamaran-cabins',
        '#catamaran-bathrooms',
        '#catamaran-guests'
    ];
    
    elementsToShow.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
            element.classList.add('config-loaded');
            console.log(`‚úì Elemento mostrato: ${selector}`);
        });
    });
    
    // Mostra anche eventuali elementi con classe price-loading
    document.querySelectorAll('.price-loading').forEach(element => {
        element.classList.remove('price-loading');
        element.classList.add('price-loaded');
    });
    
    console.log('üé® Elementi configurazione mostrati con successo');
}

// Gestione robusta aggiornamenti DOM con fallback
function updateElement(id, content, fallbackValue = null) {
    try {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = content;
            console.log(`‚úÖ Aggiornato ${id}:`, content);
            return true;
        } else {
            console.warn(`‚ö†Ô∏è Elemento non trovato: ${id}`);
            if (fallbackValue !== null) {
                console.log(`üîÑ Applicando fallback per ${id}:`, fallbackValue);
                // Potrebbe essere implementato un fallback alternativo
            }
            return false;
        }
    } catch (error) {
        console.error(`‚ùå Errore aggiornamento elemento ${id}:`, error);
        return false;
    }
}

// === FASE 3: Funzioni helper per aggiornamento contenuti dinamici ===

// Aggiorna lista caratteristiche principali
function updateMainFeaturesList(features) {
    try {
        const featuresList = document.getElementById('main-features-list');
        if (!featuresList) {
            console.warn('‚ö†Ô∏è Lista caratteristiche principali non trovata');
            return false;
        }
        
        // Svuota la lista esistente
        featuresList.innerHTML = '';
        
        // Aggiungi ogni caratteristica
        features.forEach(feature => {
            const li = document.createElement('li');
            li.className = 'flex items-start';
            li.innerHTML = `
                <div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
                    <i class="ri-check-line"></i>
                </div>
                <span class="text-gray-700">${feature}</span>
            `;
            featuresList.appendChild(li);
        });
        
        console.log(`‚úÖ Aggiornate ${features.length} caratteristiche principali`);
        return true;
        
    } catch (error) {
        console.error('‚ùå Errore aggiornamento caratteristiche:', error);
        return false;
    }
}

// Aggiorna lista dotazioni incluse
function updateIncludedEquipmentList(equipment) {
    try {
        const equipmentList = document.getElementById('included-equipment-list');
        if (!equipmentList) {
            console.warn('‚ö†Ô∏è Lista dotazioni incluse non trovata');
            return false;
        }
        
        // Svuota la lista esistente
        equipmentList.innerHTML = '';
        
        // Aggiungi ogni dotazione
        equipment.forEach(item => {
            const li = document.createElement('li');
            li.className = 'flex items-start';
            li.innerHTML = `
                <div class="w-5 h-5 flex items-center justify-center text-primary mr-2 mt-0.5">
                    <i class="ri-check-line"></i>
                </div>
                <span class="text-gray-700">${item}</span>
            `;
            equipmentList.appendChild(li);
        });
        
        console.log(`‚úÖ Aggiornate ${equipment.length} dotazioni incluse`);
        return true;
        
    } catch (error) {
        console.error('‚ùå Errore aggiornamento dotazioni:', error);
        return false;
    }
}

// Verifica stato salute DOM per elementi critici
function checkDOMHealth() {
    const criticalElements = [
        'base-price', 'summary-base-price', 'total-price',
        'linens-detail-price', 'charter-detail-price', 'fuel-detail-price'
    ];
    
    const missing = [];
    const present = [];
    
    criticalElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            present.push(id);
        } else {
            missing.push(id);
        }
    });
    
    console.log('üè• Stato salute DOM:', {
        presenti: present.length,
        mancanti: missing.length,
        elementMancanti: missing
    });
    
    if (missing.length > 0) {
        console.warn('‚ö†Ô∏è Elementi critici mancanti potrebbero causare errori:', missing);
    }
    
    return missing.length === 0;
}

// === GESTIONE DINAMICA SERVIZI AGGIUNTIVI ===

function renderAdditionalServices() {
    try {
        console.log('üõ†Ô∏è Inizializzazione servizi aggiuntivi dinamici...');
        
        const config = CatamaranStorage.load();
        const container = document.getElementById('additional-services-container');
        
        if (!container) {
            console.error('‚ùå Container servizi aggiuntivi non trovato');
            return;
        }
        
        // üîÑ NUOVO: Carica servizi dal BOX 3 (priorit√†) o dal vecchio formato
        let servicesArray = [];
        let skipperConfig = null;
        
        // Controlla prima la nuova struttura BOX 3
        if (config.box1_2?.box3) {
            servicesArray = config.box1_2.box3.services || [];
            skipperConfig = config.box1_2.box3.skipper;
            console.log('üì¶ BOX 3: Caricando da nuova struttura:', servicesArray.length, 'servizi + skipper');
        } else if (config.box3) {
            servicesArray = config.box3.services || [];
            skipperConfig = config.box3.skipper;
            console.log('üì¶ BOX 3: Caricando da box3:', servicesArray.length, 'servizi + skipper');
        } else if (config.additionalServices) {
            // Fallback per vecchio formato
            console.log('üì¶ LEGACY: Caricando servizi da vecchio formato additionalServices');
            const legacyServices = Object.entries(config.additionalServices)
                .filter(([key, service]) => key !== 'skipper')
                .map(([key, service]) => ({ id: key, ...service }));
            servicesArray = legacyServices;
            skipperConfig = config.additionalServices.skipper;
        }
        
        // Aggiorna configurazione Skipper nella sezione dedicata
        if (skipperConfig && skipperConfig.active !== false) {
            updateSkipperFromConfig(skipperConfig);
        }
        
        // Filtra solo servizi attivi
        const activeServices = servicesArray.filter(service => service.active !== false);
        
        if (activeServices.length === 0) {
            console.warn('‚ö†Ô∏è Nessun servizio aggiuntivo attivo');
            container.innerHTML = `
                <div class="col-span-full text-center py-8 text-gray-500">
                    <i class="ri-service-line text-4xl mb-4"></i>
                    <p>Nessun servizio aggiuntivo disponibile</p>
                </div>
            `;
            return;
        }
        
        // üìä ORDINAMENTO STRATEGICO: Raccomandati ‚Üí Normali ‚Üí Obbligatori
        const recommendedServices = activeServices.filter(s => s.recommended && !s.mandatory).sort((a, b) => (a.order || 10) - (b.order || 10));
        const normalServices = activeServices.filter(s => !s.recommended && !s.mandatory).sort((a, b) => (a.order || 10) - (b.order || 10));
        const mandatoryServices = activeServices.filter(s => s.mandatory).sort((a, b) => (a.order || 10) - (b.order || 10));
        
        console.log(`üìã Servizi ordinati: ${recommendedServices.length} raccomandati, ${normalServices.length} normali, ${mandatoryServices.length} obbligatori`);
        
        // Pulisci container
        container.innerHTML = '';
        
        // üåü SEZIONE SERVIZI RACCOMANDATI (stile skipper professionale)
        recommendedServices.forEach(service => {
            container.innerHTML += generateServiceHTML(service, 'recommended');
        });
        
        // üì¶ SEZIONE SERVIZI NORMALI (griglia due colonne)
        normalServices.forEach(service => {
            container.innerHTML += generateServiceHTML(service, 'normal');
        });
        
        // üö® SEZIONE SERVIZI OBBLIGATORI (una colonna, preselezionati)
        mandatoryServices.forEach(service => {
            container.innerHTML += generateServiceHTML(service, 'mandatory');
        });
        
        // Ri-aggancia event listeners per i nuovi servizi
        attachServiceEventListeners();
        
        console.log(`‚úÖ ${activeServices.length} servizi renderizzati con ordinamento strategico`);
        
    } catch (error) {
        console.error('‚ùå Errore nel renderizzare servizi aggiuntivi:', error);
    }
}

// Funzione per aggiornare configurazione Skipper
function updateSkipperFromConfig(skipperConfig) {
    try {
        const skipperPriceElement = document.getElementById('skipper-price');
        const skipperCheckbox = document.querySelector('.service-checkbox[data-name="Skipper"]');
        const skipperSection = skipperCheckbox?.closest('.border-2');
        
        if (skipperPriceElement) {
            skipperPriceElement.textContent = `‚Ç¨${skipperConfig.price}/giorno`;
        }
        
        if (skipperCheckbox) {
            skipperCheckbox.dataset.price = skipperConfig.price;
            skipperCheckbox.dataset.name = skipperConfig.name || "Skipper Professionale";
        }
        
        // Aggiorna descrizione se presente
        if (skipperConfig.description && skipperSection) {
            const descriptionP = skipperSection.querySelector('p.text-sm');
            if (descriptionP) {
                descriptionP.textContent = skipperConfig.description;
            }
        }
        
        // Nasconde/mostra sezione skipper basata su configurazione
        if (skipperSection) {
            if (skipperConfig.active === false) {
                skipperSection.style.display = 'none';
            } else {
                skipperSection.style.display = 'block';
            }
        }
        
        console.log('‚öì Skipper aggiornato da BOX 3:', skipperConfig);
        
    } catch (error) {
        console.error('‚ùå Errore aggiornamento skipper:', error);
    }
}

// Funzione per generare HTML di un servizio
function generateServiceHTML(service, type) {
    const frequencyMapping = {
        'once': 'tantum',
        'daily': 'giorno', 
        'weekly': 'settimana'
    };
    
    const serviceUnit = frequencyMapping[service.frequency] || 'tantum';
    const unitText = serviceUnit === 'giorno' ? '/giorno' : 
                   serviceUnit === 'settimana' ? '/settimana' : 
                   '(una tantum)';
    const isOnetime = serviceUnit === 'tantum';
    
    // Styling basato sul tipo
    let containerClass = '';
    let borderClass = '';
    
    switch(type) {
        case 'recommended':
            containerClass = 'col-span-full mb-6'; // Una colonna con margine come skipper
            borderClass = 'border-2 border-primary rounded-lg p-4 hover:bg-primary hover:bg-opacity-5 transition-colors';
            break;
        case 'mandatory':
            containerClass = 'col-span-full'; // Una colonna
            borderClass = 'border-2 border-red-300 bg-red-50';
            break;
        default: // normal
            containerClass = ''; // Griglia normale (2 colonne)
            borderClass = 'border border-gray-200';
    }
    
    if (type === 'recommended') {
        // Layout tipo skipper per servizi raccomandati
        return `
            <div class="${containerClass}">
                <div class="${borderClass}">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-start">
                            <div class="w-10 h-10 flex items-center justify-center bg-primary bg-opacity-10 rounded-full text-primary mr-3">
                                <i class="${service.icon || 'ri-service-line'}"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900">${service.name}</h4>
                                <p class="text-sm text-gray-600">‚Ç¨${service.price} ${unitText}</p>
                            </div>
                        </div>
                        <label class="custom-switch">
                            <input type="checkbox" class="service-checkbox" 
                                   data-price="${service.price}" 
                                   data-name="${service.name}"
                                   data-key="${service.id || service.name}"
                                   ${isOnetime ? 'data-onetime="true"' : ''}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    ${service.description ? `<p class="text-sm text-gray-600">${service.description}</p>` : ''}
                </div>
            </div>
        `;
    } else {
        // Layout normale per altri servizi
        return `
            <div class="${containerClass}">
                <div class="${borderClass} rounded-lg p-4 hover:border-primary transition-colors">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-start">
                            <div class="w-10 h-10 flex items-center justify-center bg-primary bg-opacity-10 rounded-full text-primary mr-3">
                                <i class="${service.icon || 'ri-service-line'}"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900">${service.name}</h4>
                                <p class="text-sm text-gray-600">‚Ç¨${service.price} ${unitText}</p>
                            </div>
                        </div>
                        <label class="custom-switch">
                            <input type="checkbox" class="service-checkbox" 
                                   data-price="${service.price}" 
                                   data-name="${service.name}"
                                   data-key="${service.id || service.name}"
                                   ${isOnetime ? 'data-onetime="true"' : ''}
                                   ${service.mandatory ? 'checked disabled' : ''}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    ${service.description ? `<p class="text-sm text-gray-600">${service.description}</p>` : ''}
                    ${service.mandatory && type === 'mandatory' ? `
                        <div class="mt-3 pt-3 border-t border-red-200">
                            <p class="text-sm font-medium text-red-700 flex items-center">
                                <i class="ri-alert-line mr-2"></i>
                                Servizio obbligatorio
                            </p>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    }
}

// Funzione per agganciare event listeners
function attachServiceEventListeners() {
    document.querySelectorAll('.service-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if (typeof updateServicesCalculator === 'function') {
                updateServicesCalculator();
            }
        });
    });
}

function updateSkipperService() {
    try {
        const config = CatamaranStorage.load();
        let skipperConfig = null;
        
        // Carica skipper da BOX 3 o fallback
        if (config.box1_2?.box3?.skipper) {
            skipperConfig = config.box1_2.box3.skipper;
        } else if (config.box3?.skipper) {
            skipperConfig = config.box3.skipper;
        } else if (config.additionalServices?.skipper) {
            skipperConfig = config.additionalServices.skipper;
        }
        
        if (skipperConfig) {
            updateSkipperFromConfig(skipperConfig);
        } else {
            console.warn('‚ö†Ô∏è Configurazione Skipper non trovata');
        }
        
    } catch (error) {
        console.error('‚ùå Errore aggiornamento skipper:', error);
    }
}

console.log('‚úÖ Funzioni servizi aggiuntivi caricate con successo');

// === AUTO-REFRESH OGNI 15 SECONDI ===
setInterval(() => {
    console.log('üîÑ Auto-refresh servizi aggiuntivi...');
    renderAdditionalServices();
}, 15000);

// Chiamata iniziale
setTimeout(renderAdditionalServices, 2000); // Delay iniziale per caricamento completo

// === FINE GESTIONE SERVIZI AGGIUNTIVI DINAMICI ===

// Carica la configurazione quando la pagina √® pronta
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Inizializzazione pagina prenotazione...');
    
    // Verifica stato salute DOM prima di procedere
    const domHealthy = checkDOMHealth();
    
    if (domHealthy) {
        console.log('‚úÖ DOM verificato, procedo con caricamento configurazione');
        
        // üö® TIMEOUT DI SICUREZZA - Nasconde loading screen dopo 5 secondi massimo
        const loadingTimeout = setTimeout(() => {
            console.warn('‚ö†Ô∏è TIMEOUT: Nascondimento forzato loading screen dopo 5 secondi');
            updateLoadingText('Caricamento completato');
            
            // Metodo diretto per nascondere loading screen
            const loadingScreen = document.getElementById('loading-screen');
            const mainContent = document.getElementById('main-content');
            
            if (loadingScreen) {
                console.warn('üîß Nascondimento DIRETTO loading screen');
                loadingScreen.style.display = 'none';
                loadingScreen.style.visibility = 'hidden';
                loadingScreen.style.opacity = '0';
                loadingScreen.remove();
            }
            
            if (mainContent) {
                mainContent.style.visibility = 'visible';
                mainContent.style.opacity = '1';
                mainContent.classList.remove('content-hidden');
                mainContent.classList.add('content-visible');
            }
            
            // Anche il metodo normale per sicurezza
            try {
                hideLoadingScreen();
            } catch (error) {
                console.warn('‚ö†Ô∏è hideLoadingScreen() fallita:', error);
            }
        }, 5000);

        // üö® TIMEOUT IMMEDIATO PER TEST - 2 secondi
        const immediateTimeout = setTimeout(() => {
            console.warn('‚ö†Ô∏è TIMEOUT IMMEDIATO: Nascondimento forzato loading screen dopo 2 secondi');
            
            const loadingScreen = document.getElementById('loading-screen');
            const mainContent = document.getElementById('main-content');
            
            if (loadingScreen) {
                console.warn('üîß RIMOZIONE IMMEDIATA loading screen');
                loadingScreen.style.display = 'none';
                loadingScreen.remove();
            }
            
            if (mainContent) {
                mainContent.style.visibility = 'visible';
                mainContent.style.opacity = '1';
            }
        }, 2000);

        // Carica configurazione con sincronizzazione Supabase + Loading Screen
        setTimeout(async () => {
            try {
                console.log('üöÄ Inizio inizializzazione pagina prenotazione');
                
                // Step 1: Sincronizzazione Supabase (con timeout e gestione errori)
                updateLoadingText('Sincronizzazione configurazione');
                
                try {
                    if (typeof CatamaranStorage !== 'undefined' && CatamaranStorage.syncFromSupabase) {
                        console.log('üì° Avvio sincronizzazione Supabase...');
                        const result = await Promise.race([
                            CatamaranStorage.syncFromSupabase(),
                            new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout Supabase sync')), 3000))
                        ]);
                        
                        if (result.success) {
                            console.log('‚úÖ Sincronizzazione Supabase completata');
                        } else {
                            console.log('‚ÑπÔ∏è Sincronizzazione Supabase: nessun aggiornamento');
                        }
                        
                        // Force refresh con timeout
                        if (typeof CatamaranStorage.forceRefresh === 'function') {
                            console.log('üîÑ Force refresh da Supabase...');
                            const refreshResult = await Promise.race([
                                CatamaranStorage.forceRefresh(),
                                new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout force refresh')), 2000))
                            ]);
                            
                            if (refreshResult.success) {
                                console.log('‚úÖ Force refresh completato');
                            } else {
                                console.warn('‚ö†Ô∏è Force refresh fallito:', refreshResult.error);
                            }
                        }
                    } else {
                        console.log('üì± Uso configurazione localStorage (Supabase non disponibile)');
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è Sincronizzazione Supabase fallita:', error.message);
                    // Continua con localStorage
                }
                
                // Step 2: Caricamento configurazione (con fallback)
                updateLoadingText('Caricamento dati catamarano');
                await new Promise(resolve => setTimeout(resolve, 200));
                
                try {
                    console.log('‚ö° Caricamento configurazione finale...');
                    await Promise.race([
                        loadCatamaranConfiguration(),
                        new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout config loading')), 3000))
                    ]);
                } catch (error) {
                    console.warn('‚ö†Ô∏è Errore caricamento configurazione:', error.message);
                    // Continua con configurazione base
                }
                
                // Step 3: Rendering servizi (con gestione errori)
                updateLoadingText('Preparazione servizi');
                
                try {
                    renderAdditionalServices();
                    updateSkipperService();
                } catch (error) {
                    console.warn('‚ö†Ô∏è Errore rendering servizi:', error.message);
                    // Servizi opzionali, continua
                }
                
                // Step 4: Finalizzazione
                updateLoadingText('Completamento caricamento');
                await new Promise(resolve => setTimeout(resolve, 300));
                
                console.log('‚úÖ Inizializzazione completata con successo');
                
                // Cancella timeout di sicurezza (non pi√π necessario)
                clearTimeout(loadingTimeout);
                clearTimeout(immediateTimeout);
                
                // Nascondi loading screen
                updateLoadingText('Caricamento completato');
                hideLoadingScreen();
                
            } catch (error) {
                console.error('‚ùå Errore fatale durante caricamento:', error);
                
                // Cancella timeout di sicurezza per gestire l'errore manualmente
                clearTimeout(loadingTimeout);
                clearTimeout(immediateTimeout);
                
                updateLoadingText('Errore caricamento - uso configurazione base');
                
                try {
                    // Tentativo di caricamento base
                    await loadCatamaranConfiguration();
                    renderAdditionalServices();
                    updateSkipperService();
                    console.log('‚úÖ Configurazione base caricata dopo errore');
                } catch (baseError) {
                    console.error('‚ùå Anche configurazione base fallita:', baseError);
                }
                
                // Nascondi loading dopo errore in ogni caso
                setTimeout(() => {
                    updateLoadingText('Caricamento completato');
                    hideLoadingScreen();
                }, 1000);
            }
        }, 300);
        
    } else {
        console.warn('‚ö†Ô∏è DOM con elementi mancanti, caricamento potrebbe avere problemi');
        
        // Timeout di sicurezza anche per DOM parziale
        const partialLoadingTimeout = setTimeout(() => {
            console.warn('‚ö†Ô∏è TIMEOUT DOM PARZIALE: Nascondimento forzato loading screen');
            updateLoadingText('Caricamento completato');
            hideLoadingScreen();
        }, 6000);
        
        // Carica comunque ma con avviso + Loading Screen
        setTimeout(async () => {
            try {
                updateLoadingText('DOM parziale - sincronizzazione');
                
                // Prima sincronizza da Supabase (con timeout ridotto)
                if (typeof CatamaranStorage !== 'undefined' && CatamaranStorage.syncFromSupabase) {
                    try {
                        console.log('üì° Avvio sincronizzazione Supabase (DOM parziale)...');
                        const result = await Promise.race([
                            CatamaranStorage.syncFromSupabase(),
                            new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout sync parziale')), 2000))
                        ]);
                        
                        if (result.success) {
                            console.log('‚úÖ Sincronizzazione Supabase completata');
                        } else {
                            console.log('‚ÑπÔ∏è Sincronizzazione Supabase: nessun aggiornamento');
                        }
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Sincronizzazione Supabase fallita:', error.message);
                    }
                }
                
                updateLoadingText('Caricamento configurazione base');
                await new Promise(resolve => setTimeout(resolve, 200));
                
                console.log('‚ö° Caricamento configurazione finale (DOM parziale)...');
                await Promise.race([
                    loadCatamaranConfiguration(),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout config parziale')), 2000))
                ]);
                
                try {
                    renderAdditionalServices();
                    updateSkipperService();
                } catch (error) {
                    console.warn('‚ö†Ô∏è Errore rendering servizi DOM parziale:', error.message);
                }
                
                // Cancella timeout e nascondi loading screen
                clearTimeout(partialLoadingTimeout);
                await new Promise(resolve => setTimeout(resolve, 300));
                updateLoadingText('Caricamento completato');
                hideLoadingScreen();
                
            } catch (error) {
                console.error('‚ùå Errore caricamento DOM parziale:', error);
                
                clearTimeout(partialLoadingTimeout);
                updateLoadingText('Errore - caricamento base');
                
                try {
                    await loadCatamaranConfiguration();
                    renderAdditionalServices();
                    updateSkipperService();
                } catch (baseError) {
                    console.error('‚ùå Errore configurazione base DOM parziale:', baseError);
                }
                
                setTimeout(() => {
                    updateLoadingText('Caricamento completato');
                    hideLoadingScreen();
                }, 1000);
            }
        }, 300);
    }
    
    // üîÑ CACHE BUSTING - Check versione leggero invece di polling pesante
    let currentVersion = 0;
    
    // Funzione async per inizializzare cache busting
    async function initializeCacheBusting() {
        // Carica versione iniziale
        if (typeof window.SupabaseManager !== 'undefined' && window.SupabaseManager.checkVersion) {
            try {
                const versionResult = await window.SupabaseManager.checkVersion();
                if (versionResult.success) {
                    currentVersion = versionResult.version || 0;
                    console.log(`üè∑Ô∏è Versione iniziale: ${currentVersion}`);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Errore caricamento versione iniziale:', error);
            }
        }
    }
    
    // Inizializza cache busting
    initializeCacheBusting();
    
    // Check versione ogni 30 secondi (invece di 15)
    setInterval(async () => {
        try {
            if (typeof window.SupabaseManager !== 'undefined' && window.SupabaseManager.checkVersion) {
                const versionResult = await window.SupabaseManager.checkVersion();
                
                if (versionResult.success) {
                    const serverVersion = versionResult.version || 0;
                    
                    // Solo se versione diversa, aggiorna configurazione
                    if (serverVersion !== currentVersion) {
                        console.log(`üîÑ Nuova versione rilevata: ${serverVersion} (attuale: ${currentVersion})`);
                        currentVersion = serverVersion;
                        
                        // Ricarica configurazione completa solo quando necessario
                        if (typeof CatamaranStorage !== 'undefined' && CatamaranStorage.forceRefresh) {
                            const refreshResult = await CatamaranStorage.forceRefresh();
                            if (refreshResult.success) {
                                console.log('‚úÖ Configurazione aggiornata da nuova versione');
                                await loadCatamaranConfiguration();
                                renderAdditionalServices();
                                updateSkipperService();
                            }
                        }
                    } else {
                        console.log(`üì° Version check OK: ${serverVersion} (nessun aggiornamento)`);
                    }
                }
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Errore version check:', error);
        }
    }, 30000); // Ogni 30 secondi invece di 15, e solo check versione
});

// === GESTIONE LOADING SCREEN ===
function hideLoadingScreen() {
    const loadingScreen = document.getElementById('loading-screen');
    const mainContent = document.getElementById('main-content');
    
    if (loadingScreen && mainContent) {
        // Nascondi loading screen
        loadingScreen.classList.add('hidden');
        
        // Mostra contenuto principale
        mainContent.classList.remove('content-hidden');
        mainContent.classList.add('content-visible');
        
        console.log('‚ú® Loading screen nascosto - contenuto visibile');
        
        // Rimuovi loading screen dal DOM dopo l'animazione
        setTimeout(() => {
            if (loadingScreen.parentNode) {
                loadingScreen.parentNode.removeChild(loadingScreen);
            }
        }, 500);
    }
}

// Funzione per aggiornare testo loading
function updateLoadingText(text) {
    const loadingText = document.querySelector('.loading-text');
    if (loadingText) {
        loadingText.innerHTML = text + '<span class="loading-dots"></span>';
    }
}
</script>

</div> <!-- Chiude main-content -->

</body>
</html>